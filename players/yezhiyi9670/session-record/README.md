## 14. ğŸª é«˜é¢‘ç‡æ˜Ÿçƒ

### å°è¯•ä¸è§£å†³

> å…³é”®è¯ï¼šæ–‡æœ¬å¤„ç†ã€ç»ˆç«¯æ§åˆ¶åºåˆ—

é¦–å…ˆä¸‹è½½ `asciinema_restore.rec`ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ã€‚

```plain
{"version": 2, "width": 150, "height": 50, "timestamp": 1697951135, "env": {"SHELL": "/bin/zsh", "TERM": "xterm-256color"}}
[0.032562, "o", "\u001b[1m\u001b[7m%\u001b[27m\u001b[1m\u001b[0m                                                                                                                                                     \r \r"]
[0.033128, "o", "\r\u001b[0m\u001b[27m\u001b[24m\u001b[Jstage % \u001b[K\u001b[?2004h"]
...
```

æ¥ä¸‹æ¥æˆ‘ä»¬å®‰è£… asciinema æ¥æ’­æ”¾è¿™ä¸€æ–‡ä»¶ã€‚è¿™ä¸€æ¬¡ç»ˆç«¯ä¼šè¯å…ˆæ‰§è¡Œäº† `sha256sum flag.js`ï¼Œè¿™ä¸€å‘½ä»¤çš„è¾“å‡ºå¯ä»¥å¸®åŠ©é€‰æ‰‹æ£€æŸ¥è‡ªå·±è¿˜åŸå‡ºçš„ `flag.js` æ˜¯å¦ä¸åŸæ–‡ä¸€è‡´ã€‚æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œäº† `less flag.js`ï¼Œè¿™ä¸€å‘½ä»¤çš„ä½œç”¨æ˜¯åœ¨ç»ˆç«¯ä¸­åˆ†é¡µæµè§ˆæ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶æ»šåŠ¨åœ°éå¸¸å¿«ï¼Œå¾ˆéš¾çœ‹åˆ°å…·ä½“å†…å®¹ã€‚

ä¸éš¾å‘ç°æ–‡ä»¶æ˜¯ä¸€é¡µä¸€é¡µæ»šåŠ¨çš„ï¼Œé€šè¿‡â€œç›¯å¸§â€æ¥é‡æ„æ–‡ä»¶æ˜¯å¯èƒ½çš„ï¼Œä½†æ˜¯æ–‡ä»¶éå¸¸é•¿ï¼Œæ‰‹åŠ¨æ“ä½œè‚¯å®šè¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œä¸”å®¹æ˜“å‡ºé”™ï¼›è‡ªåŠ¨åŒ–æ“ä½œç›¸å½“éº»çƒ¦ã€‚ä¸å¦‚æ¥ç ”ç©¶ä¸€ä¸‹ `asciinema_restore.rec` æœ¬èº«ã€‚åæ­£è¿™æ˜¯ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¤„ç†èµ·æ¥è‚¯å®šç›¸å½“å®¹æ˜“ã€‚

è§‚å¯Ÿä¸éš¾å‘ç°ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯åŒ…å«ä¸‰ä¸ªå€¼çš„ä¸‰å…ƒç»„ã€‚ç¬¬ä¸€ä¸ªæ˜¾ç„¶æ˜¯è¡¨ç¤ºæ—¶é—´ï¼›ç¬¬äºŒä¸ªæ°¸è¿œæ˜¯ `"o"`ï¼Œæˆ–è®¸è¡¨ç¤º `output`ï¼›ç¬¬ä¸‰ä¸ªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå…·ä½“å†…å®¹ã€‚ä¸å¦¨å°è¯•æŠŠæ¯ä¸€è¡Œçš„å†…å®¹éƒ½æ‹¼æ¥èµ·æ¥ï¼Œçœ‹çœ‹ä¼šå¾—åˆ°ä»€ä¹ˆã€‚

```js
// === recover-record.js ===
const fs = require('fs')

const content = fs.readFileSync('./asciinema_restore.rec').toString()

const lines = content.split('\n')

let result = ''

for(const line of lines) {
  if(line[0] == '[') {
    const obj = JSON.parse(line)
    if(obj[1] != 'o') {
      throw new Error(`Unknown action ${obj[1]}, line ${line}`)
    }
    result += obj[2]
  }
}

console.log(result)
```

è¿è¡Œå¹¶å°†è¾“å‡ºå¯¼å‡ºåˆ° `dump.txt`ã€‚ä¸éš¾å‘ç°ï¼Œ`dump.txt` ä¸­åŒ…å«äº†å‡ ä¹å®Œæ•´çš„ `flag.js` å†…å®¹ï¼Œä½†æ˜¯å…¶ä¸­æ¯éš”ä¸€æ®µéƒ½æœ‰ä¸€å¨å¥‡æ€ªçš„å­—ç¬¦ã€‚è¿™ä¸€å¨ä¸œè¥¿å…¶å®æ˜¯ç»ˆç«¯æ§åˆ¶åºåˆ—ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å‡ºå¯ä»¥ç”¨æ¥æ¸…ç©ºå±å¹•å¹¶æ‰“å°ä¸‹ä¸€é¡µå†…å®¹ã€‚

```plain
    "W7VdMvffFW",
    "k8kRwmoNWQC",
:[K
[K [KESCESC[K[[[K66[K~~
[K    "W58/WOqNW6i",
    "pSodCKdcGW",
    "W5W2W6frWQi",
```

ç¡®å®å¯ä»¥å†™ä¸€ä¸ªç¨‹åºæ ¹æ®ç»ˆç«¯æ§åˆ¶åºåˆ—è¯­æ³•æ¥ç§»é™¤å®ƒä»¬ï¼Œä½†æ˜¯ï¼Œä¸éš¾æ³¨æ„åˆ°ï¼Œ`flag.js` å†…å®¹ä¸­çš„æ¯ä¸€å¨æ§åˆ¶åºåˆ—éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œé™¤äº†ç¬¬ä¸€å¤„ã€‚ä¸å¦¨æŠŠè¿™ä¸€æ®µç›¸åŒçš„ä¸œè¥¿å¤åˆ¶å‡ºæ¥ï¼Œå­˜ä¸º `strip.txt`ï¼Œå¦å¤–å†™ä¸€ä¸ªç¨‹åºå°†è¿™äº›ä¸œè¥¿ç§»é™¤ã€‚

```js
// === strip.js ===
const fs = require('fs')

let dumpContent = fs.readFileSync('dump.txt').toString()
const stripContent = fs.readFileSync('strip.txt').toString()

while(true) {
  let next = dumpContent.replace(stripContent.trim(), '')
  if(next == dumpContent) {
    break
  }
  dumpContent = next
}

console.log(dumpContent)
```

è¿è¡Œå¹¶å°†è¾“å‡ºå¯¼å‘åˆ° `stripped.txt`ï¼Œç„¶åå¤åˆ¶å‡º `flag.js` å†…å®¹å¹¶æ‰‹åŠ¨åˆ å»ç¬¬ä¸€å¨æ§åˆ¶åºåˆ—ã€‚

```plain
    "W5nepCkkaG",
    "CCoyWQFcPSoe",
[7mflag.js[27m[K
[K [KESCESC[K[[[K66[K~~
[K    "eqtdJYnV",
    "omk+y2JcSq",
    "v8o+ashcKG",
```

å°†ç»“æœå¦å­˜ä¸º `flag.js`ï¼Œè¿è¡Œï¼Œå³å¾—åˆ° flagã€‚

### Flag

```plain
flag{y0u_cAn_ReSTorE_C0de_fr0m_asc11nema_3db2da1063300e5dabf826e40ffd016101458df23a371}
```
